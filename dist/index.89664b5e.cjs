"use strict";var U=Object.defineProperty;var M=(d,n,t)=>n in d?U(d,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[n]=t;var x=(d,n,t)=>(M(d,typeof n!="symbol"?n+"":n,t),t);const e=require("vue"),_=require("./revoke.800898d2.cjs");class T{constructor(){x(this,"components",{});x(this,"componentConfigs",{});x(this,"schemaGroup",[{title:"\u57FA\u7840\u7EC4\u4EF6",list:["input"]}]);x(this,"viewsContainers",{activitybars:[],rightSidebars:[]});x(this,"publicMethods",{test:{describe:"\u6D4B\u8BD5\u51FD\u6570",methodName:"test",method:()=>{alert("\u6D4B\u8BD5\u51FD\u6570\u5F39\u51FA")}}})}component(n,t){if(this.components[n])return console.warn(`${n}\u7EC4\u4EF6\u5DF2\u5728pluginManager\u4E2D\u6CE8\u518C`),!1;typeof t=="function"&&(t=_.loadAsyncComponent(t)),this.components[n]=t}registerComponent(n){this.component(n.defaultSchema.type,n.component),this.componentConfigs[n.defaultSchema.type]=n}getComponents(){return this.components}getComponent(n){return this.components[n]}registerActivitybar(n){typeof n.component=="function"&&(n.component=_.loadAsyncComponent(n.component)),this.viewsContainers.activitybars.push(n)}getActivitybars(){return this.viewsContainers.activitybars}registerRightSidebar(n){typeof n.component=="function"&&(n.component=_.loadAsyncComponent(n.component)),this.viewsContainers.rightSidebars.push(n)}getRightSidebars(){return this.viewsContainers.rightSidebars}getComponentConfings(){return this.componentConfigs}getComponentConfingByType(n){return this.componentConfigs[n]}setSchemaGroup(n){this.schemaGroup=n}addSchemaGroup(n){this.schemaGroup.push(n)}getSchemaByGroup(){return this.schemaGroup.map(t=>{const v=t.list.map(m=>{var i;const f=(i=this.componentConfigs[m])==null?void 0:i.defaultSchema;return f?{...f,id:_.getUUID()}:(console.warn(`${m} \u7EC4\u4EF6\u672A\u6CE8\u518C\u5230pluginManager\u4E2D`),!1)}).filter(m=>m);return{...t,list:v}})}addPublicMethod(n){this.publicMethods[n.methodName]=n}}const E=new T;function $(){const d=e.ref({}),n=e.ref({});function t(u){return d.value[u]}function v(u,r){return d.value[u]=r}function m(u){new Function(`${u}`).bind({getComponent:t,defineExpose:f})()}function f(u){u&&(n.value=u)}function i(u){u==null||u.forEach(r=>{var l,o;const c=r.componentId&&t(r.componentId);if(c&&typeof c[r.methodName]=="function"){c[r.methodName](r.args),console.log(c[r.methodName]);return}(o=(l=n.value)[r.methodName])==null||o.call(l,r.args)})}return{componentInstances:d,funcs:n,getComponentInstance:t,addComponentInstance:v,setMethods:m,doActions:i}}const P=e.defineComponent({__name:"KNode",props:{record:{type:Object,required:!0},modelValue:{}},emits:["update:modelValue","change"],setup(d,{emit:n}){const t=d,v=e.inject("formData",{}),m=e.inject("slots",{}),f=e.inject("pageManager",{}),i=E.getComponent("form-item"),u=e.ref(null);t.record.field&&e.watch(()=>t.modelValue,s=>{v[t.record.field]=s},{immediate:!0}),e.watch(()=>u.value,s=>{t.record.id&&f.addComponentInstance(t.record.id,s)});const r=e.shallowRef(null),c=e.shallowRef({}),l=e.reactive({}),o=e.computed(()=>{var s,g,N,B;return(s=t.record.componentProps)!=null&&s.hidden?!1:typeof t.record.show=="boolean"?t.record.show:(B=(N=(g=t.record).show)==null?void 0:N.call(g,{values:v}))!=null?B:!0}),C=e.computed(()=>{var s;return{...t.record,rules:o.value&&((s=t.record.rules)==null?void 0:s.map(g=>({...g,validator:g.validator&&f.funcs.value[g.validator]})))}});async function p(){var B,A,F,k,b,V,K;if((B=t.record.componentProps)!=null&&B.defaultValue&&a((A=t.record.componentProps)==null?void 0:A.defaultValue),(F=t.record.dataSource)!=null&&F.api&&h((k=t.record.dataSource)==null?void 0:k.api,t.record),t.record.type==="slot"){const w=t.record.slotName;return w&&e.watch(()=>v[t.record.field],()=>{var I;r.value=e.h("div",null,(I=m[w])==null?void 0:I.call(m,{record:t.record,model:v}))},{immediate:!0}),!1}const s=E.getComponent(t.record.type);if(!s)return console.error(`\u7EC4\u4EF6${t.record.type}\u672A\u6CE8\u518C`),!1;const g=(V=(b=E.getComponentConfingByType(t.record.type))==null?void 0:b.bindModel)!=null?V:"modelValue";if(typeof s=="function"){const w=await s();r.value=(K=w.default)!=null?K:w}else r.value=s;const N={};t.record.on&&Object.keys(t.record.on).forEach(w=>{N[`on${_.capitalizeFirstLetter(w)}`]=()=>f.doActions(t.record.on[w])}),c.value={record:t.record,bindModel:g,[`onUpdate:${g}`]:a,...N}}function h(s,g){var A;const N=(A=g.dataSource.dataField)!=null?A:"options";async function B(){typeof s=="function"&&(l[N]=await s())}B()}function a(s){n("update:modelValue",s),n("change",s),t.record.field&&(v[t.record.field]=s)}let y=null;return e.watch(()=>t.record,s=>{const g=JSON.stringify({...s,children:void 0});if(g===y)return!1;y=g,p()},{immediate:!0,deep:!0}),(s,g)=>{const N=e.resolveComponent("KNode",!0);return t.record.isInput&&e.unref(r)&&e.unref(o)?(e.openBlock(),e.createBlock(e.unref(i),e.normalizeProps(e.mergeProps({key:0},e.unref(C))),{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r)),e.mergeProps({ref_key:"componentInstance",ref:u},{...e.unref(c),...t.record.componentProps,...l,[e.unref(c).bindModel]:e.unref(v)[t.record.field]}),{node:e.withCtx(B=>[e.createVNode(N,e.normalizeProps(e.guardReactiveProps(B)),null,16)]),"edit-node":e.withCtx(()=>[e.renderSlot(s.$slots,"edit-node")]),_:3},16))]),_:3},16)):e.unref(r)&&e.unref(o)?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r)),e.mergeProps({key:1,model:e.unref(v),ref_key:"componentInstance",ref:u},{...e.unref(c),...t.record.componentProps,...l,[e.unref(c).bindModel]:e.unref(v)[t.record.field]||d.modelValue}),{node:e.withCtx(B=>[e.createVNode(N,e.normalizeProps(e.guardReactiveProps(B)),null,16)]),"edit-node":e.withCtx(()=>[e.renderSlot(s.$slots,"edit-node")]),_:3},16,["model"])):e.createCommentVNode("",!0)}}}),L={class:"loading-box"},S=e.defineComponent({__name:"KBuilder",props:{schemas:{type:Array},script:{type:String,default:""}},emits:["ready"],setup(d,{expose:n,emit:t}){const v=d,m=_.loadAsyncComponent(()=>Promise.resolve().then(()=>require("./revoke.800898d2.cjs")).then(p=>p.KAsyncLoader)),f=$(),i=e.reactive({}),u=e.useSlots(),r=e.ref({});e.provide("formData",i),e.provide("slots",u),e.provide("pageManager",f),e.provide("forms",r),e.watch(()=>v.script,p=>{f.setMethods(p)},{immediate:!0});async function c(p="default"){var a;return((a=r.value)==null?void 0:a[p])?i:(console.error(`\u8868\u5355 [name=${p}] \u4E0D\u5B58\u5728`),!1)}async function l(p="default"){var a;const h=(a=r.value)==null?void 0:a[p];return h?(await(h==null?void 0:h.validate()),i):(console.error(`\u8868\u5355 [name=${p}] \u4E0D\u5B58\u5728`),!1)}function o(p){Object.assign(i,p)}function C(){e.nextTick(()=>{t("ready",{pageManager:f})})}return n({getData:c,setData:o,validate:l}),(p,h)=>(e.openBlock(),e.createBlock(e.Suspense,{onResolve:C},{default:e.withCtx(()=>[e.createElementVNode("div",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.schemas,(a,y)=>(e.openBlock(),e.createBlock(e.unref(P),{ref_for:!0,ref:"Knode",key:y,record:a},null,8,["record"]))),128))])]),fallback:e.withCtx(()=>[e.createElementVNode("div",L,[e.createVNode(e.unref(m))])]),_:1}))}}),R={class:"k-designer-main"},q={class:"k-split-view-container"},O={class:"loading-box"},j=e.defineComponent({__name:"KDesigner",emits:["ready","save"],setup(d,{expose:n,emit:t}){const v=_.loadAsyncComponent(()=>Promise.resolve().then(()=>require("./KHeader.ebd0248d.cjs"))),m=_.loadAsyncComponent(()=>Promise.resolve().then(()=>require("./KActionBar.24d96a4b.cjs"))),f=_.loadAsyncComponent(()=>Promise.resolve().then(()=>require("./KEditContainer.5e2bf478.cjs"))),i=_.loadAsyncComponent(()=>Promise.resolve().then(()=>require("./KRightSidebar.e7e0c3f6.cjs"))),u=_.loadAsyncComponent(()=>Promise.resolve().then(()=>require("./KFooter.882a74be.cjs"))),r=_.loadAsyncComponent(()=>Promise.resolve().then(()=>require("./revoke.800898d2.cjs")).then(V=>V.KAsyncLoader)),c=$(),l=e.reactive({checkedNode:null,hoverNode:null,disableHover:!1,matched:[]}),o=e.ref([]),C=e.ref(""),p=e.reactive({});e.watch(()=>C.value,V=>{c.setMethods(V)});const h=[{type:"page",id:"root",children:[],componentProps:{style:{padding:"16px"}}}],a=`const { defineExpose, getComponent } = this;

function test (){
    console.log('test')
}

// \u901A\u8FC7defineExpose\u66B4\u9732\u7684\u51FD\u6570\u6216\u8005\u5C5E\u6027
defineExpose({
 test 
})`;C.value=a,e.provide("schemas",o),e.provide("script",C),e.provide("formData",p),e.provide("pageManager",c);function y(){o.value=_.deepClone(h),s(o.value[0]),_.revoke.push(o.value,"\u521D\u59CB\u5316\u64A4\u9500\u529F\u80FD")}e.provide("designer",{setCheckedNode:s,setHoverNode:g,setDisableHover:B,state:l});async function s(V=o.value[0]){l.checkedNode=V,l.matched=_.getMatchedById(o.value,V.id)}async function g(V=null){var K;if(!V||l.disableHover)return l.hoverNode=null,!1;if((V==null?void 0:V.id)===((K=l.hoverNode)==null?void 0:K.id))return!1;l.hoverNode=V}function N(){e.nextTick(()=>{t("ready",{pageManager:c})})}async function B(V=!1){l.disableHover=V}function A(V){_.deepCompareAndModify(o.value,V.schemas),C.value=V.script}function F(){return{schemas:e.toRaw(o.value),script:C.value}}function k(){_.deepCompareAndModify(o.value,h),C.value=a,s(o.value[0]),_.revoke.push(o.value,"\u91CD\u7F6E\u64CD\u4F5C")}function b(){t("save",{schemas:e.toRaw(o.value),script:C.value})}return y(),n({setData:A,getData:F,reset:k}),(V,K)=>(e.openBlock(),e.createBlock(e.Suspense,{onResolve:N},{default:e.withCtx(()=>[e.createElementVNode("div",R,[e.createVNode(e.unref(v),{onSave:b}),e.createElementVNode("div",q,[e.createVNode(e.unref(m)),e.createVNode(e.unref(f)),e.createVNode(e.unref(i))]),e.createVNode(e.unref(u))])]),fallback:e.withCtx(()=>[e.createElementVNode("div",O,[e.createVNode(e.unref(r))])]),_:1}))}}),G={component:()=>Promise.resolve().then(()=>require("./monacoEditor.b99ea066.cjs")).then(d=>d.monacoEditor),defaultSchema:{label:"\u4EE3\u7801\u7F16\u8F91\u5668",type:"monacoEditor",field:"monacoEditor",icon:"icon-write",isInput:!0},config:{attribute:[{label:"\u5B57\u6BB5\u540D",type:"input",field:"field"},{label:"\u6807\u9898",type:"input",field:"label"},{label:"\u9ED8\u8BA4\u503C",type:"monacoEditor",field:"componentProps.defaultValue"}]},bindModel:"value"},z={component:()=>Promise.resolve().then(()=>require("./KPage.1d284647.cjs")),defaultSchema:{label:"\u9875\u9762",type:"page",componentProps:{},children:[]},config:{attribute:[{label:"\u9875\u9762\u540D\u79F0",type:"input",field:"name"}]}},H={key:0,class:"del-btn"},J=["onClick"],Q=e.createElementVNode("span",{class:"iconfont icon-shanchu"},null,-1),W=[Q],X=e.defineComponent({__name:"KColEditor",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(d,{emit:n}){const t=d,v=E.getComponent("number"),m=e.computed({get(){return t.modelValue},set(u){n("update:modelValue",u)}});function f(){const u={type:"col",children:[],componentProps:{span:12},id:_.getUUID()};m.value.push(u)}function i(u){m.value=m.value.filter((r,c)=>u!==c)}return(u,r)=>(e.openBlock(),e.createElementBlock("div",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(c,l)=>(e.openBlock(),e.createElementBlock("div",{class:"k-col-editor-item",key:l},[e.createVNode(e.unref(v),{style:{width:"100%"},value:c.componentProps.span,"onUpdate:value":o=>c.componentProps.span=o,modelValue:c.componentProps.span,"onUpdate:modelValue":o=>c.componentProps.span=o,min:1,max:24},null,8,["value","onUpdate:value","modelValue","onUpdate:modelValue"]),e.unref(m).length>1?(e.openBlock(),e.createElementBlock("div",H,[e.createElementVNode("span",{onClick:o=>i(l)},W,8,J)])):e.createCommentVNode("",!0)]))),128)),e.createElementVNode("div",{class:"add-btn",onClick:f},"\u6DFB\u52A0")]))}}),Y={key:0,class:"del-btn"},Z=["onClick"],ee=e.createElementVNode("span",{class:"iconfont icon-shanchu"},null,-1),te=[ee],ne=e.defineComponent({__name:"KTabPaneEditor",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(d,{emit:n}){const t=d,v=E.getComponent("input"),m=e.computed({get(){return t.modelValue},set(u){n("update:modelValue",u)}});function f(){const u={label:"\u6807\u7B7E\u9875",type:"tab-pane",children:[],id:_.getUUID()};m.value.push(u)}function i(u){m.value=m.value.filter((r,c)=>u!==c)}return(u,r)=>(e.openBlock(),e.createElementBlock("div",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(c,l)=>(e.openBlock(),e.createElementBlock("div",{class:"k-col-editor-item",key:l},[e.createVNode(e.unref(v),{style:{width:"100%"},value:c.label,"onUpdate:value":o=>c.label=o,modelValue:c.label,"onUpdate:modelValue":o=>c.label=o},null,8,["value","onUpdate:value","modelValue","onUpdate:modelValue"]),e.unref(m).length>1?(e.openBlock(),e.createElementBlock("div",Y,[e.createElementVNode("span",{onClick:o=>i(l)},te,8,Z)])):e.createCommentVNode("",!0)]))),128)),e.createElementVNode("div",{class:"add-btn",onClick:f},"\u6DFB\u52A0")]))}}),oe=e.defineComponent({__name:"index",props:{modelValue:{type:String,default:null}},emits:["update:modelValue"],setup(d,{emit:n}){const t=d,v=E.getComponent("input"),m=E.getComponent("select"),f=e.ref(null),i=e.ref("px"),u=[{label:"px",value:"px"},{label:"%",value:"%"},{label:"vw",value:"vw"},{label:"vh",value:"vh"},{label:"rem",value:"rem"},{label:"em",value:"em"},{label:"pt",value:"pt"}];e.watch(()=>t.modelValue,c=>{const l=parseFloat(c);if(!l)return f.value=null,!1;f.value=String(l),i.value=c.substring(f.value.length)},{immediate:!0});function r(){n("update:modelValue",f.value?f.value+i.value:void 0)}return(c,l)=>(e.openBlock(),e.createBlock(e.unref(v),{modelValue:f.value,"onUpdate:modelValue":l[2]||(l[2]=o=>f.value=o),value:f.value,"onUpdate:value":l[3]||(l[3]=o=>f.value=o),type:"number",min:"0",onInput:r},{append:e.withCtx(()=>[e.createVNode(e.unref(m),{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=o=>i.value=o),style:{width:"68px"},onChange:r,options:u},null,8,["modelValue"])]),addonAfter:e.withCtx(()=>[e.createVNode(e.unref(m),{value:i.value,"onUpdate:value":l[1]||(l[1]=o=>i.value=o),style:{width:"68px"},onChange:r,options:u},null,8,["value"])]),_:1},8,["modelValue","value"]))}}),le={class:"event-info"},ae=["title"],re={class:"event-btn"},ce=["onClick"],se={class:"k-action-editor-main"},ue={class:"del-btn"},de=["onClick"],ie=e.createElementVNode("span",{class:"iconfont icon-shanchu"},null,-1),pe=[ie],me=e.defineComponent({__name:"KActionEditorItem",props:{modelValue:{type:Object,default:()=>({})},itemEvents:{type:Array},allEvents:{type:Array},events:{type:Object}},emits:["update:modelValue","add"],setup(d,{emit:n}){const t=d,v=e.inject("schemas");function m(r){n("add",r)}function f(r){const{schema:c}=_.findSchemaById(v.value,r);return c.label}function i(r,c){var o;const l=u(c);l[c]=t.events[c].value.filter((C,p)=>r!==p),(o=l[c].length)!=null||delete l[c],n("update:modelValue",l)}function u(r){const c={};return t.allEvents.forEach(l=>{if(!t.events[l.type].value.length||l.type===r)return!1;c[l.type]=t.events[l.type].value}),c}return(r,c)=>(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.itemEvents,l=>{var o;return e.openBlock(),e.createElementBlock("div",{class:"event-item",key:l.type},[e.createElementVNode("div",le,[e.createElementVNode("div",{class:"event-label",title:l.describe},e.toDisplayString(l.describe),9,ae),e.createElementVNode("div",re,[e.createElementVNode("span",{onClick:C=>m(l.type),class:"iconfont icon-tianjia1"},null,8,ce)])]),e.createElementVNode("div",se,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((o=t.events[l.type])==null?void 0:o.value,(C,p)=>(e.openBlock(),e.createElementBlock("div",{class:"k-editor-item",key:p},[e.createTextVNode(e.toDisplayString(C.componentId&&f(C.componentId))+" "+e.toDisplayString(C.methodName)+" ",1),e.createElementVNode("div",ue,[e.createElementVNode("span",{onClick:h=>i(p,l.type)},pe,8,de)])]))),128))])])}),128))}}),fe={class:"k-tree-node"},ve=e.createElementVNode("span",{class:"iconfont icon-zhankai"},null,-1),he=[ve],Ce=e.defineComponent({__name:"KTreeNode",props:{record:{type:Object,required:!0}},setup(d){const n=d,t=e.inject("slots",{}),v=e.inject("expandedKeys"),m=e.inject("treeProps"),f=e.inject("handleSelect"),i=e.computed(()=>{var o;return v.value.includes((o=n.record.id)!=null?o:"")}),u=e.computed(()=>{var o;return(o=m.selectedKeys.value)!=null?o:m.selectedKeys}),r=e.defineComponent({setup(){return()=>{var o,C,p;return e.h("span",{class:{text:!0,hover:m.hoverKey===n.record.id,checked:u.value.includes(n.record.id)},onClick:()=>f(n.record.id,n.record)},(p=(o=t["tree-node"])==null?void 0:o.call(t,n))!=null?p:e.h("span",{class:{"text-padding":!0}},(C=E.getComponentConfingByType(n.record.type))==null?void 0:C.defaultSchema.label))}}});function c(){const o=n.record.id;if(!o)return!1;v.value.includes(o)?v.value=v.value.filter(C=>C!==o):v.value.push(o)}function l(){var C;const o=n.record.id;if(!o||!((C=n.record.children)!=null&&C.length))return!1;v.value.push(o)}return l(),(o,C)=>{var h,a;const p=e.resolveComponent("KTreeNode",!0);return e.openBlock(),e.createElementBlock("li",fe,[e.createElementVNode("a",null,[(h=n.record.children)!=null&&h.length?(e.openBlock(),e.createElementBlock("span",{key:0,onClick:c,class:e.normalizeClass(["icon-expanded",{expanded:e.unref(i)}])},he,2)):e.createCommentVNode("",!0),e.createVNode(e.unref(r))]),(a=n.record.children)!=null&&a.length?(e.openBlock(),e.createElementBlock("ul",{key:0,class:e.normalizeClass(["k-tree-sublist",{expanded:e.unref(i)}])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.record.children,y=>(e.openBlock(),e.createBlock(p,{record:y,key:y.id},null,8,["record"]))),128))],2)):e.createCommentVNode("",!0)])}}}),ye={class:"k-tree-main"},D=e.defineComponent({__name:"KTree",props:{options:{type:Array},selectedKeys:{type:Array},hoverKey:{type:String}},emits:["update:selectedKeys","node-click"],setup(d,{emit:n}){const t=d,v=e.useSlots();e.provide("slots",v);const m=e.ref([]);function f(i,u){n("update:selectedKeys",[i]),n("node-click",{id:i,record:u})}return e.provide("expandedKeys",m),e.provide("treeProps",t),e.provide("handleSelect",f),(i,u)=>(e.openBlock(),e.createElementBlock("ul",ye,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.options,r=>(e.openBlock(),e.createBlock(Ce,{record:r,key:r.id},null,8,["record"]))),128))]))}}),ke={class:"k-script-edit"},ge={class:"k-script-left-panel"},_e={class:"k-tree-select"},Ee={class:"tree-node-item"},Ve=["onClick"],be={class:"k-action-select"},Ne=["onClick"],Be={class:"k-script-right-panel"},Fe=e.defineComponent({__name:"KScriptEdit",setup(d){const n=E.getComponent("monacoEditor"),t={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1}},v=e.ref(null),m=e.inject("pageManager",{}),f=e.inject("schemas"),i=e.inject("script"),u=e.ref([]),r=e.ref(null),c=e.computed(()=>{var p;return r.value?(p=E.getComponentConfings()[r.value.type].config.action)==null?void 0:p.map(h=>({label:h.describe,value:h.type})):Object.entries(m.funcs.value).filter(([h,a])=>typeof a=="function").map(([h])=>({label:h,value:h}))});function l(p){r.value=p.record}function o(p){var h;(h=v.value)==null||h.insertText(`getComponent('${p.id}')`)}function C(p){var h;(h=v.value)==null||h.insertText(`getComponent('${r.value.id}').${p.value}()`)}return(p,h)=>(e.openBlock(),e.createElementBlock("div",ke,[e.createElementVNode("div",ge,[e.createElementVNode("div",_e,[e.createVNode(e.unref(D),{options:e.unref(f),selectedKeys:u.value,"onUpdate:selectedKeys":h[0]||(h[0]=a=>u.value=a),onNodeClick:l},{"tree-node":e.withCtx(({record:a})=>{var y;return[e.createElementVNode("div",Ee,[e.createElementVNode("span",null,e.toDisplayString((y=e.unref(E).getComponentConfingByType(a.type))==null?void 0:y.defaultSchema.label),1),e.createElementVNode("span",{class:"action",onClick:s=>o(a)},"get",8,Ve)])]}),_:1},8,["options","selectedKeys"])]),e.createElementVNode("div",be,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),a=>(e.openBlock(),e.createElementBlock("div",{class:"action-item",key:a.value},[e.createElementVNode("span",null,e.toDisplayString(a.label),1),e.createElementVNode("span",{class:"action",onClick:y=>C(a)},"get",8,Ne)]))),128))])]),e.createElementVNode("div",Be,[e.createVNode(e.unref(n),{ref_key:"monacoEditorRef",ref:v,class:"editor",config:t,language:"javascript",modelValue:e.unref(i),"onUpdate:modelValue":h[1]||(h[1]=a=>e.isRef(i)?i.value=a:null)},null,8,["modelValue"])])]))}}),Ae={class:"k-modal-action-main"},we={class:"k-modal-left-panel"},Ke={class:"k-modal-right-panel"},xe={class:"select-box"},$e=e.createElementVNode("span",null,"\u52A8\u4F5C\u9009\u62E9",-1),De={class:"k-modal-footer"},Ie=e.defineComponent({__name:"KActionModal",emits:["add"],setup(d,{expose:n,emit:t}){const v=E.getComponent("Modal"),m=E.getComponent("select"),f=E.getComponent("button"),i=E.getComponent("Tabs"),u=E.getComponent("TabPane"),r=e.inject("schemas"),c=e.inject("pageManager",{}),l=e.ref(!1),o=e.ref([]),C=e.ref(null),p=e.ref("\u52A8\u4F5C\u914D\u7F6E"),h=e.computed(()=>{var F;return C.value?(F=E.getComponentConfings()[C.value.type].config.action)==null?void 0:F.map(k=>({label:k.describe,value:k.type})):Object.entries(c.funcs.value).filter(([k,b])=>typeof b=="function").map(([k])=>({label:k,value:k}))}),a=e.reactive({actionItem:{methodName:null,componentId:null}});function y(){l.value=!0,e.nextTick(()=>{a.actionItem.methodName=null,a.actionItem.componentId=null,C.value=null})}function s(){if(!a.actionItem.methodName){alert("\u8BF7\u5148\u9009\u62E9\u52A8\u4F5C\u65B9\u6CD5");return}t("add",_.deepClone(e.toRaw(a.actionItem))),g()}function g(){l.value=!1,o.value=[]}function N(){a.actionItem.componentId=null,a.actionItem.methodName=null,C.value=null,o.value=[]}function B(F){a.actionItem.componentId=F.id,C.value=F.record,a.actionItem.methodName=null}function A(){p.value="\u811A\u672C\u7F16\u8F91"}return n({handleOpen:y}),(F,k)=>(e.openBlock(),e.createBlock(e.unref(v),{visible:l.value,"onUpdate:visible":k[5]||(k[5]=b=>l.value=b),modelValue:l.value,"onUpdate:modelValue":k[6]||(k[6]=b=>l.value=b),width:"850px",footer:null},{default:e.withCtx(()=>[e.createVNode(e.unref(i),{modelValue:p.value,"onUpdate:modelValue":k[3]||(k[3]=b=>p.value=b),activeKey:p.value,"onUpdate:activeKey":k[4]||(k[4]=b=>p.value=b)},{default:e.withCtx(()=>[e.createVNode(e.unref(u),{title:"\u52A8\u4F5C\u914D\u7F6E",tab:"\u52A8\u4F5C\u914D\u7F6E",key:"\u52A8\u4F5C\u914D\u7F6E",label:"\u52A8\u4F5C\u914D\u7F6E",name:"\u52A8\u4F5C\u914D\u7F6E"},{default:e.withCtx(()=>[e.createElementVNode("div",Ae,[e.createElementVNode("div",we,[e.createElementVNode("div",{class:e.normalizeClass(["fun-btn",{checked:a.actionItem.componentId===null}]),onClick:N},"\u51FD\u6570 ",2),e.createTextVNode(" \u7EC4\u4EF6 "),e.createVNode(e.unref(D),{options:e.unref(r),selectedKeys:o.value,"onUpdate:selectedKeys":k[0]||(k[0]=b=>o.value=b),onNodeClick:B},null,8,["options","selectedKeys"])]),e.createElementVNode("div",Ke,[e.createElementVNode("div",xe,[$e,e.createVNode(e.unref(m),{class:"action-select",modelValue:a.actionItem.methodName,"onUpdate:modelValue":k[1]||(k[1]=b=>a.actionItem.methodName=b),value:a.actionItem.methodName,"onUpdate:value":k[2]||(k[2]=b=>a.actionItem.methodName=b),placeholder:"\u8BF7\u9009\u62E9\u52A8\u4F5C",options:e.unref(h)},null,8,["modelValue","value","options"]),a.actionItem.componentId===null?(e.openBlock(),e.createBlock(e.unref(f),{key:0,onClick:A},{default:e.withCtx(()=>[e.createTextVNode("\u7F16\u8F91\u51FD\u6570")]),_:1})):e.createCommentVNode("",!0)])])])]),_:1}),e.createVNode(e.unref(u),{title:"\u811A\u672C\u7F16\u8F91",tab:"\u811A\u672C\u7F16\u8F91",key:"\u811A\u672C\u7F16\u8F91",label:"\u811A\u672C\u7F16\u8F91",name:"\u811A\u672C\u7F16\u8F91"},{default:e.withCtx(()=>[e.createVNode(Fe)]),_:1})]),_:1},8,["modelValue","activeKey"]),e.createElementVNode("div",De,[e.createVNode(e.unref(f),{onClick:g},{default:e.withCtx(()=>[e.createTextVNode("\u5173\u95ED")]),_:1}),e.createVNode(e.unref(f),{type:"primary",disabled:!a.actionItem.methodName,onClick:s},{default:e.withCtx(()=>[e.createTextVNode("\u4FDD\u5B58")]),_:1},8,["disabled"])])]),_:1},8,["visible","modelValue"]))}}),Pe=e.defineComponent({__name:"KActionEditor",props:{modelValue:{type:Object,default:()=>({})},eventList:{type:Array}},emits:["update:modelValue"],setup(d,{emit:n}){const t=d,v=E.getComponent("Collapse"),m=E.getComponent("CollapseItem"),f=e.ref(null),i=e.ref(["\u7EC4\u4EF6\u4E8B\u4EF6"]),u=e.computed(()=>t.eventList.filter(a=>a.events.length));e.watch(()=>u.value,a=>{a.length&&(i.value=a[0].title)},{immediate:!0});const r=e.computed(()=>t.eventList.map(a=>a.events).flat()),c=e.computed({get(){return t.modelValue},set(a){n("update:modelValue",a)}}),l={};r.value.forEach(a=>{l[a.type]=e.computed(()=>{var y,s;return(s=(y=t.modelValue)==null?void 0:y[a.type])!=null?s:[]})});let o="";function C(a){var y;(y=f.value)==null||y.handleOpen(),o=a}function p(a){var s;const y=h(o);y[o]=[...(s=l[o])==null?void 0:s.value,a],n("update:modelValue",y)}function h(a){const y={};return r.value.forEach(s=>{var g,N;if(!((N=(g=l[s.type])==null?void 0:g.value)!=null&&N.length)||s.type===a)return!1;y[s.type]=l[s.type].value}),y}return(a,y)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(e.unref(v),{modelValue:i.value,"onUpdate:modelValue":y[1]||(y[1]=s=>i.value=s),activeKey:i.value,"onUpdate:activeKey":y[2]||(y[2]=s=>i.value=s)},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(u),s=>(e.openBlock(),e.createBlock(e.unref(m),{title:s.title,header:s.title,name:s.title,key:s.title},{default:e.withCtx(()=>[e.createVNode(me,{onAdd:C,itemEvents:s.events,allEvents:e.unref(r),events:l,modelValue:e.unref(c),"onUpdate:modelValue":y[0]||(y[0]=g=>e.isRef(c)?c.value=g:null)},null,8,["itemEvents","allEvents","modelValue"])]),_:2},1032,["title","header","name"]))),128))]),_:1},8,["modelValue","activeKey"]),e.createVNode(Ie,{ref_key:"KActionModalRef",ref:f,onAdd:p},null,512)],64))}});function Se(d){d.component("k-tab-pane-editor",ne),d.component("k-input-size",oe),d.component("k-col-editor",X),d.component("k-action-editor",Pe),d.component("k-rule-editor",()=>Promise.resolve().then(()=>require("./KRuleEditor.dabe8b24.cjs"))),d.registerActivitybar({title:"\u7EC4\u4EF6",icon:"icon-mokuai_1",component:()=>Promise.resolve().then(()=>require("./KComponentView.734edf40.cjs"))}),d.registerActivitybar({title:"\u6E90\u7801",icon:"icon-daima1",component:()=>Promise.resolve().then(()=>require("./KSoundCode.518071ba.cjs"))}),d.registerActivitybar({title:"\u5927\u7EB2",icon:"icon-juxingkaobei",component:()=>Promise.resolve().then(()=>require("./KOutline.e8587d11.cjs"))}),d.registerRightSidebar({title:"\u5C5E\u6027",component:()=>Promise.resolve().then(()=>require("./KAttributeView.55f85c6a.cjs"))}),d.registerRightSidebar({title:"\u6837\u5F0F",component:()=>Promise.resolve().then(()=>require("./KStyleView.3c9ea1ee.cjs"))}),d.registerRightSidebar({title:"\u4E8B\u4EF6",component:()=>Promise.resolve().then(()=>require("./KEventView.3df28e9f.cjs"))}),[G,z].forEach(t=>{d.registerComponent(t)})}Se(E);const je=[S,j],Ue={install(d){je.forEach(n=>{d.component(n.__name,n)})},pluginManager:E,usePageManager:$};exports.KDesignr=Ue;exports._sfc_main=S;exports._sfc_main$1=P;exports._sfc_main$2=D;exports._sfc_main$3=j;exports.pluginManager=E;exports.usePageManager=$;
