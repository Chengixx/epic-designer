"use strict";var me=Object.defineProperty;var he=(n,t,e)=>t in n?me(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var A=(n,t,e)=>(he(n,typeof t!="symbol"?t+"":t,e),e);const r=require("vue");const O=(n,t)=>r.defineAsyncComponent({loader:n,loadingComponent:t,delay:80});function G(n=10){return Math.random().toString(36).substring(2,2+n)}function te(n){return n.charAt(0).toUpperCase()+n.slice(1)}function V(n,t=new WeakMap){if(typeof n!="object"||n===null)return n;if(t.has(n))return t.get(n);if(Array.isArray(n)){const o=n.map(s=>V(s,t));return t.set(n,o),o}const e={};return t.set(n,e),Object.keys(n).forEach(o=>{e[o]=V(n[o],t)}),e}function ve(n){const[t]=oe([V(n)],e=>{const o={...e,id:`${e.type}_${G(8)}`};return(o.field||o.input)&&(o.field=o.id),o});return t}function N(n,t){for(const[e,o]of Object.entries(t)){const s=n==null?void 0:n[e];s&&o&&typeof s=="object"&&typeof o=="object"?N(s,o):n[e]=o}Object.keys(n).reverse().forEach(e=>{t.hasOwnProperty(e)||(Array.isArray(t)?n.splice(e,1):delete n[e])})}function J(n,t,e=[],o=new WeakMap){const s=a=>{if(Array.isArray(a))return a.map(s);if(typeof a=="object"&&a!==null){if(o.has(a))return"[Circular]";o.set(a,!0);const i=Object.keys(a).sort(),l={};return i.forEach(u=>{e.includes(u)||(l[u]=s(a[u]))}),o.delete(a),l}else return a};return JSON.stringify(s(n))===JSON.stringify(s(t))}function ne(n,t){const e=[];let o=!1;function s(a){if(e.push(a),a.id===t&&(o=!0),!o&&a.children!=null&&a.children.length>0)for(let i=0;i<a.children.length&&(s(a.children[i]),!o);i++);if(!o&&a.slots)for(let i in a.slots)for(let l=0;l<a.slots[i].length&&(s(a.slots[i][l]),!o);l++);o||e.pop()}return n.forEach(s),o||console.error(`没有查询到id为${t}的节点`),e}function ye(n,t){const e=n.split(".");let o=t;for(let s=0;s<e.length;s++)if(o=o[e[s]],typeof o>"u")return;return o}function ge(n,t,e){const o=t.split(".");let s=e;o.forEach((a,i)=>{if(i===o.length-1){s[a]=n;return}s=s[a]??(s[a]={})})}function we(n,t="default"){const e=F(n,s=>{var a;return s.type==="form"&&(((a=s.componentProps)==null?void 0:a.name)??s.name===t)},!0);return F((e==null?void 0:e.children)??[],s=>!!s.input,!1,s=>s.type!=="subform").map(s=>s.field)}function F(n,t,e=!1,o){const s=[],a=[...n];for(;a.length;){const i=a.pop();if(i!=null&&i.children&&(!o||o(i))&&a.push(...i.children),i!=null&&i.slots&&(!o||o(i)))for(let l in i.slots)a.push(...i.slots[l]);if(t(i)&&(s.push(i),e))return i}return e?!1:s}function oe(n,t,e){const o=[...n];for(;o.length;){const s=o.pop();if(s!=null&&s.children&&(!e||e(s))&&o.push(...s.children),s!=null&&s.slots&&(!e||e(s)))for(let a in s.slots)o.push(...s.slots[a]);N(s,t(s))}return n}function Se(n,t){const e=F(n,o=>o.id===t,!0);if(!e)throw new Error(`没有查询到id为${t}的节点`);return e}function be(n,t){const e=[{type:"",children:n}];let o=0,s=null;if(F(e,a=>{if(s=a.children??null,!s){if(a!=null&&a.slots)for(let i in a.slots){s=a.slots[i];for(let l=0;l<s.length;l++)if(s[l].id===t)return o=l,!0}return!1}for(let i=0;i<s.length;i++)if(s[i].id===t)return o=i,!0;return!1},!0),!s)throw new Error(`没有查询到id为${t}的节点`);return{list:s,schema:s[o],index:o}}function Ce(n){const t={schemas:[{type:"page",id:"root",label:"页面",children:[{label:"表单",type:"form",icon:"epic-icon-daibanshixiang",labelWidth:n.config.labelWidth||100,name:"default",componentProps:{layout:n.config.layout||"horizontal",labelWidth:n.config.labelWidth||100,labelLayout:n.config.labelLayout==="flex"?"fixed":"flex",labelCol:n.config.labelCol||{span:5},wrapperCol:n.config.wrapperCol||{span:19},hideRequiredMark:n.config.hideRequiredMark||!1,colon:n.config.colon||!0,labelAlign:n.config.labelAlign||"right",size:n.config.size||"middle"},children:[],id:"form_"+G()}],componentProps:{style:{padding:"16px"}}}],script:n.script||""};return t.schemas[0].children[0].children=B(n.list),t}function B(n,t){return n.map(e=>{var u,f,d;let o=e.type??"";const s=e.options??{},a=(p,c)=>{o===p&&(o=c,s.defaultValue&&(s.defaultValue=JSON.parse(s.defaultValue)))};if(a("uploadImg","upload-image"),a("uploadFile","upload-file"),o==="date"&&s.range&&(s.type="daterange",delete s.range),(o==="date"||o==="time")&&(s.valueFormat=s.format),o==="textarea"){const{minRows:p,maxRows:c}=s;s.autoSize={minRows:p,maxRows:c},delete s.minRows,delete s.maxRows}o==="number"&&!s.precision&&delete s.precision,s.width&&(s.style={width:s.width},delete s.width),o==="grid"&&(o="row",e.childImmovable=!0),t&&t.type==="grid"&&(o="col",s.span=e.span,e.key=G());const i={label:e.label,type:o,icon:e.icon||"",field:e.model,componentProps:s,childImmovable:e.childImmovable,id:e.key};return(s.noFormItem||!s.showLabel)&&(i.noFormItem=!0,delete s.noFormItem,delete s.showLabel),s.clearable&&(s.allowClear=!0,delete s.clearable),["input","textarea","number","password","select","cascader","checkbox","radio","date","time","slider","switch","color-picker","upload-file","upload-image"].includes(o)&&(i.input=!0,((f=(u=e.rules)==null?void 0:u[0])==null?void 0:f.required)===!1&&e.rules.shift(),((d=e.rules)==null?void 0:d.length)>0&&(i.rules=e.rules)),e.list&&(i.children=B(e.list,e)),e.columns&&(i.children=B(e.columns,e)),e.trs&&(i.children=B(e.trs,e)),e.tds&&(i.children=B(e.tds,e)),i})}function K(n){return r.getCurrentScope()?(r.onScopeDispose(n),!0):!1}function Pe(n){let t=0,e,o;const s=()=>{t-=1,o&&t<=0&&(o.stop(),e=void 0,o=void 0)};return(...a)=>(t+=1,e||(o=r.effectScope(!0),e=o.run(()=>n(...a))),K(s),e)}function Z(n){return typeof n=="function"?n():r.unref(n)}const _e=typeof window<"u",Ee=()=>{};function xe(n,t,e){const o=r.watch(n,(...s)=>(r.nextTick(()=>o()),t(...s)),e)}function R(n){var t;const e=Z(n);return(t=e==null?void 0:e.$el)!=null?t:e}const z=_e?window:void 0;function Ie(...n){let t,e,o,s;if(typeof n[0]=="string"||Array.isArray(n[0])?([e,o,s]=n,t=z):[t,e,o,s]=n,!t)return Ee;Array.isArray(e)||(e=[e]),Array.isArray(o)||(o=[o]);const a=[],i=()=>{a.forEach(d=>d()),a.length=0},l=(d,p,c,y)=>(d.addEventListener(p,c,y),()=>d.removeEventListener(p,c,y)),u=r.watch(()=>[R(t),Z(s)],([d,p])=>{i(),d&&a.push(...e.flatMap(c=>o.map(y=>l(d,c,y,p))))},{immediate:!0,flush:"post"}),f=()=>{u(),i()};return K(f),f}var ke=Object.defineProperty,Ae=Object.defineProperties,Oe=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,Ve=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable,j=(n,t,e)=>t in n?ke(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,re=(n,t)=>{for(var e in t||(t={}))Ve.call(t,e)&&j(n,e,t[e]);if(Y)for(var e of Y(t))De.call(t,e)&&j(n,e,t[e]);return n},se=(n,t)=>Ae(n,Oe(t));function $e(n){return typeof n=="function"?n:typeof n=="string"?t=>t.key===n:Array.isArray(n)?t=>n.includes(t.key):()=>!0}function ie(...n){let t,e,o={};n.length===3?(t=n[0],e=n[1],o=n[2]):n.length===2?typeof n[1]=="object"?(t=!0,e=n[0],o=n[1]):(t=n[0],e=n[1]):(t=!0,e=n[0]);const{target:s=z,eventName:a="keydown",passive:i=!1,dedupe:l=!1}=o,u=$e(t);return Ie(s,a,d=>{d.repeat&&Z(l)||u(d)&&e(d)},i)}function L(n,t,e={}){return ie(n,t,se(re({},e),{eventName:"keydown"}))}function U(n,t,e={}){return ie(n,t,se(re({},e),{eventName:"keyup"}))}function Me(){const n=r.ref(!1);return r.getCurrentInstance()&&r.onMounted(()=>{n.value=!0}),n}function Ne(n){const t=Me();return r.computed(()=>(t.value,!!n()))}var ee=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable,qe=(n,t)=>{var e={};for(var o in n)Be.call(n,o)&&t.indexOf(o)<0&&(e[o]=n[o]);if(n!=null&&ee)for(var o of ee(n))t.indexOf(o)<0&&Re.call(n,o)&&(e[o]=n[o]);return e};function ae(n,t,e={}){const o=e,{window:s=z}=o,a=qe(o,["window"]);let i;const l=Ne(()=>s&&"ResizeObserver"in s),u=()=>{i&&(i.disconnect(),i=void 0)},f=r.computed(()=>Array.isArray(n)?n.map(c=>R(c)):[R(n)]),d=r.watch(f,c=>{if(u(),l.value&&s){i=new ResizeObserver(t);for(const y of c)y&&i.observe(y,a)}},{immediate:!0,flush:"post",deep:!0}),p=()=>{u(),d()};return K(p),{isSupported:l,stop:p}}function Fe(n,t={width:0,height:0},e={}){const{window:o=z,box:s="content-box"}=e,a=r.computed(()=>{var u,f;return(f=(u=R(n))==null?void 0:u.namespaceURI)==null?void 0:f.includes("svg")}),i=r.ref(t.width),l=r.ref(t.height);return ae(n,([u])=>{const f=s==="border-box"?u.borderBoxSize:s==="content-box"?u.contentBoxSize:u.devicePixelContentBoxSize;if(o&&a.value){const d=R(n);if(d){const p=o.getComputedStyle(d);i.value=Number.parseFloat(p.width),l.value=Number.parseFloat(p.height)}}else if(f){const d=Array.isArray(f)?f:[f];i.value=d.reduce((p,{inlineSize:c})=>p+c,0),l.value=d.reduce((p,{blockSize:c})=>p+c,0)}else i.value=u.contentRect.width,l.value=u.contentRect.height},e),r.watch(()=>R(n),u=>{i.value=u?t.width:0,l.value=u?t.height:0}),{width:i,height:l}}function le(){const n=r.ref(1),t=r.ref(!1),{pressSpace:e,pressShift:o,pressCtrl:s}=ce();return{canvasScale:n,pressSpace:e,pressShift:o,pressCtrl:s,disabledZoom:t}}const T=Pe(le);function ce(){const n=r.ref(!1),t=r.ref(!1),e=r.ref(!1);return L(" ",o=>{var s=o.target;["INPUT","TEXTAREA"].includes(s.tagName)||o.preventDefault(),n.value=!0}),U(" ",()=>{n.value=!1}),L("Shift",o=>{o.preventDefault(),t.value=!0}),U("Shift",()=>{t.value=!1}),L("Control",o=>{o.preventDefault(),e.value=!0}),U("Control",()=>{e.value=!1}),{pressSpace:n,pressShift:t,pressCtrl:e}}function Ge(n){const{pressSpace:t}=T();let e=0,o=0;function s(l){var u;e=l.x,o=l.y,(u=l.dataTransfer)==null||u.setDragImage(document.createElement("div"),0,0)}function a(l){if(l.preventDefault(),!l.x||!l.y||!t.value)return;const u=l.x-e,f=l.y-o;e=l.x,o=l.y,n.value&&(n.value.scrollTop-=f,n.value.scrollLeft-=u)}function i(){t.value=!1}return{handleElementDragStart:s,handleElementDrag:a,handleElementDragEnd:i}}function ze(n){const{pressCtrl:t,canvasScale:e,disabledZoom:o}=T();function s(a){if(!t.value||o.value)return;a.preventDefault();let i=0;a.deltaY<0?i=e.value+.05:i=e.value-.05,!(i>150||i<.5)&&(e.value=i)}return r.watch(()=>e.value,a=>{n.value&&!o.value&&(n.value.style.transform=`scale(${a})`)}),{handleZoom:s,canvasScale:e}}function Te(n,t=16.66){let e;function o(){s(),e=window.setInterval(n,t)}function s(){window.clearInterval(e)}return{startTimedQuery:o,stopTimedQuery:s}}function Le(n,t){let e=null;return(...o)=>{e&&clearTimeout(e),e=setTimeout(()=>{n.apply(this,o)},t)}}class ue{constructor(){A(this,"initialized",r.ref(!1));A(this,"components",{});A(this,"componentConfigs",{});A(this,"componentSchemaGroups",r.ref([]));A(this,"hiddenComponents",[]);A(this,"componentGroupNameMap",{});A(this,"sortedGroups",["表单","布局"]);A(this,"viewsContainers",{activitybars:[],rightSidebars:[]});A(this,"publicMethods",{})}component(t,e){typeof e=="function"&&(e=O(e)),this.components[t]=e}registerComponent(t){this.component(t.defaultSchema.type,t.component),t.defaultSchema.input&&(t.config.action||(t.config.action=[]),t.config.action.unshift({type:"setValue",describe:"设置值",argsConfigs:[{...t.defaultSchema,label:"设置数据",field:"0"}]},{type:"getValue",describe:"获取值"})),this.componentConfigs[t.defaultSchema.type]=t,this.computedComponentSchemaGroups()}getComponents(){return this.components}getComponent(t){return this.components[t]}registerActivitybar(t){typeof t.component=="function"&&(t.component=O(t.component));const e=this.viewsContainers.activitybars.findIndex(o=>o.id===t.id);e!==-1?this.viewsContainers.activitybars[e]=t:this.viewsContainers.activitybars.push(t)}getActivitybars(){return this.viewsContainers.activitybars}registerRightSidebar(t){typeof t.component=="function"&&(t.component=O(t.component));const e=this.viewsContainers.rightSidebars.findIndex(o=>o.id===t.id);e!==-1?this.viewsContainers.rightSidebars[e]=t:this.viewsContainers.rightSidebars.push(t)}getRightSidebars(){return this.viewsContainers.rightSidebars}getComponentConfings(){return this.componentConfigs}getComponentConfingByType(t){return this.componentConfigs[t]}computedComponentSchemaGroups(){const t=[];Object.values(this.componentConfigs).forEach(e=>{if(!this.hiddenComponents.includes(e.defaultSchema.type)&&e.groupName){const o=this.componentGroupNameMap[e.groupName]??e.groupName;let s=t.findIndex(i=>i.title===o);s===-1&&(t.push({title:o,list:[]}),s=t.length-1);let a=t[s].list.findIndex(i=>i.type===e.defaultSchema.type);a!==-1?t[s].list[a]=e.defaultSchema:t[s].list.push(e.defaultSchema)}}),t.sort((e,o)=>{const s=this.sortedGroups.indexOf(e.title),a=this.sortedGroups.indexOf(o.title);return s===-1?1:a===-1?-1:s-a}),this.componentSchemaGroups.value=t}getComponentSchemaGroups(){return this.componentSchemaGroups}setComponentGroupNameMap(t,e){this.componentGroupNameMap[t]=e}clearComponentGroupNameMap(){this.componentGroupNameMap={}}setSortedGroups(t){this.sortedGroups=t,this.computedComponentSchemaGroups()}clearSortedGroups(){this.sortedGroups=[],this.computedComponentSchemaGroups()}hideComponent(t){this.hiddenComponents.push(t),this.computedComponentSchemaGroups()}showComponent(t){this.hiddenComponents=this.hiddenComponents.filter(e=>e!==t),this.computedComponentSchemaGroups()}setHideComponents(t){this.hiddenComponents=t,this.computedComponentSchemaGroups()}setInitialized(t){this.initialized.value=t}addPublicMethod(t){this.publicMethods[t.methodName]=t}removePublicMethod(t){delete this.publicMethods[t]}}const $=new ue;function Q(){const n=r.ref({}),t=r.ref({}),e=r.ref(!1);function o(d){return n.value[d]}function s(d,p){n.value[d]=p}function a(d){delete n.value[d]}function i(d){const p=Object.entries($.publicMethods).reduce((c,[y,E])=>(c[y]=E.method,c),{});new Function(`const epic = this;${d}`).bind({...p,getComponent:o,find:o,defineExpose:l,publicMethods:p})()}function l(d){d!=null&&(t.value=d)}function u(d,...p){d==null||d.forEach(c=>{var y,E,_;if(c.type==="public"&&((y=$.publicMethods[c.methodName])==null||y.method(...p)),c.type==="custom"&&((_=(E=t.value)[c.methodName])==null||_.call(E,...p)),c.type==="component"){(c.componentId!=null&&o(c.componentId))[c.methodName](...c.args?JSON.parse(c.args):p);return}})}function f(d=!0){e.value=d}return{componentInstances:n,funcs:t,isDesignMode:e,getComponentInstance:o,find:o,addComponentInstance:s,removeComponentInstance:a,setMethods:i,doActions:u,setDesignMode:f}}function de(){const n=r.ref([]),t=r.ref([]),e=r.ref(null);let o=0;function s(l,u="插入组件"){const f=Date.now();o+150>f||(o=f,e.value!=null&&(n.value.push(e.value),t.value.splice(0,t.value.length)),e.value={type:u,componentSchema:JSON.stringify(l)},n.value.length>20&&n.value.unshift())}function a(){if(n.value.length===0)return!1;const l=n.value.pop();return e.value!=null&&t.value.push(e.value),e.value=l,JSON.parse(l.componentSchema)}function i(){if(t.value.length===0)return!1;const l=t.value.pop();return e.value!=null&&n.value.push(e.value),e.value=l,JSON.parse(l.componentSchema)}return{recordList:n,undoList:t,currentRecord:e,push:s,undo:a,redo:i}}const W=de(),pe=r.defineComponent({name:"ENode",__name:"node",props:{componentSchema:{},modelValue:{},ruleField:{},resetFormData:{},name:{}},emits:["update:modelValue","change"],setup(n,{emit:t}){const e=n;let o=r.reactive(V(e.componentSchema));r.watch(()=>e.componentSchema,m=>{J(o,m,["children"])||N(o,V(m))},{deep:!0});let s=r.inject("formData",{});const a=r.inject("slots",{}),i=r.inject("pageManager",{}),l=r.inject("disabled",{value:!1}),u=r.inject("ruleFieldPrefix",null),f=r.inject("resetFormData",!1);(e.resetFormData||f)&&(s={});const d=t,p=$.getComponent("form-item"),c=r.ref(),y=r.ref(),E=r.useAttrs();Object.keys(E).length&&r.provide("nodeAttrs",E);const _=r.shallowRef(null),D=r.reactive({}),v=r.computed(()=>{var m,w;return(m=o.componentProps)!=null&&m.hidden?!1:typeof o.show=="boolean"?o.show:((w=o.show)==null?void 0:w.call(o,{values:s}))??!0}),C=r.computed(()=>{var k;const m=v.value&&((k=o.rules)==null?void 0:k.map(b=>({...b,validator:b.validator&&i.funcs.value[b.validator]})));let w=o.field;e.ruleField?w=e.ruleField:u&&o.field&&(w=V(u),w.push(o.field));const I={...o,rules:m,rule:m,field:w};return I.children&&delete I.children,I}),S=r.computed(()=>{var I,k;const m=((I=g.value)==null?void 0:I.bindModel)??"modelValue",w={};return o.on&&Object.keys(o.on).forEach(b=>{w[`on${te(b)}`]=(...fe)=>i.doActions(o.on[b],...fe)}),{...e,...o.componentProps,disabled:(l==null?void 0:l.value)||((k=o.componentProps)==null?void 0:k.disabled),bindModel:m,[`onUpdate:${m}`]:M,...w}}),g=r.computed(()=>$.getComponentConfingByType(o.type)??null),x=()=>s[o.field??""]??e.modelValue;r.watch(()=>c.value,()=>{P()});function P(){var m;o.id&&c.value&&(o.input&&(c.value.setValue=M,c.value.getValue=()=>s[o.field]||e.modelValue),c.value.setAttr=(w,I)=>o.componentProps[w]=I,c.value.getAttr=w=>o.componentProps[w],i.addComponentInstance(o.id,c.value),(m=g.value)!=null&&m.defaultSchema.input&&o.noFormItem!==!0&&y.value&&i.addComponentInstance(o.id+"formItem",y.value))}function q(){var m;o.id&&(i.removeComponentInstance(o.id),(m=g.value)!=null&&m.defaultSchema.input&&o.noFormItem!==!0&&i.removeComponentInstance(o.id+"formItem"))}async function h(){var w,I,k;if(typeof((w=o.componentProps)==null?void 0:w.defaultValue)<"u"){const b=i.isDesignMode.value?(I=o.componentProps)==null?void 0:I.defaultValue:s[o.field]??((k=o.componentProps)==null?void 0:k.defaultValue);M(V(b))}if(o.type==="slot"){const b=o.slotName;if(!b)return;_.value=r.defineComponent({setup(){return()=>r.renderSlot(a,b,{componentSchema:o,model:s})}});return}const m=$.getComponent(o.type);if(!m){console.error(`组件${o.type}未注册`);return}if(typeof m=="function"){const b=await m();_.value=b.default??b}else _.value=m}function M(m){d("update:modelValue",m),d("change",m),o.field&&(s[o.field]=m)}let X=null;return r.watch(()=>o,m=>{const w=JSON.stringify({...m,children:void 0});if(w===X)return!1;X=w,h()},{immediate:!0,deep:!0}),r.onUnmounted(q),(m,w)=>{var k;const I=r.resolveComponent("ENode");return r.unref(o).noFormItem!==!0&&((k=g.value)!=null&&k.defaultSchema.input)&&_.value&&v.value?(r.openBlock(),r.createBlock(r.unref(p),r.mergeProps({key:0,ref_key:"formItemRef",ref:y},C.value),{default:r.withCtx(()=>[(r.openBlock(),r.createBlock(r.resolveDynamicComponent(_.value),r.mergeProps({ref_key:"componentInstance",ref:c,onVnodeMounted:P},{...S.value,...D,[S.value.bindModel]:x()}),{node:r.withCtx(b=>[r.createVNode(I,r.normalizeProps(r.guardReactiveProps(b)),null,16)]),"edit-node":r.withCtx(()=>[r.renderSlot(m.$slots,"edit-node")]),_:3},16))]),_:3},16)):_.value&&v.value?(r.openBlock(),r.createBlock(r.resolveDynamicComponent(_.value),r.mergeProps({key:1,onVnodeMounted:P,ref_key:"componentInstance",ref:c,model:r.unref(s)},{...S.value,...D,[S.value.bindModel]:x()}),{node:r.withCtx(b=>[r.createVNode(I,r.normalizeProps(r.guardReactiveProps(b)),null,16)]),"edit-node":r.withCtx(()=>[r.renderSlot(m.$slots,"edit-node")]),_:3},16,["model"])):r.createCommentVNode("",!0)}}}),Ue={key:0,class:"loading-box"},He={class:"epic-builder-main"},We={class:"loading-box"},Je=r.defineComponent({__name:"builder",props:{pageSchema:{},disabled:{type:Boolean}},emits:["ready"],setup(n,{expose:t,emit:e}){const o=O(()=>Promise.resolve().then(()=>require("./index-beb5ee23.cjs"))),s=Q(),a=e,i=r.useSlots(),l=r.ref({}),u=r.ref(!1),f=n,d=r.reactive({schemas:[]});r.watch(()=>f.pageSchema,v=>{N(d,v)},{immediate:!0,deep:!0}),r.watch(()=>d.script,v=>{v&&v!==""&&s.setMethods(v)},{immediate:!0}),r.provide("slots",i),r.provide("pageManager",s),r.provide("forms",l),r.provide("pageSchema",d),r.provide("disabled",r.computed(()=>f.disabled));function p(v="default"){return new Promise(async(C,S)=>{var P;if(!u.value){const q=r.watch(u,async()=>{q(),C(await p(v))});return}const g=(P=l.value)==null?void 0:P[v];if(!g)return S(`表单 [name=${v}] 不存在`),!1;const x=V(await g.getData());C(x)})}function c(v="default"){return new Promise(async(C,S)=>{var x;if(!u.value){const P=r.watch(u,async()=>{P(),C(await c(v))});return}const g=(x=l.value)==null?void 0:x[v];if(!g)return S(`表单 [name=${v}] 不存在`),!1;try{await g.validate();const P=await g.getData();C(P)}catch(P){S(P)}})}function y(v,C="default"){var g;if(!u.value){const x=r.watch(u,()=>{x(),y(v,C)});return}const S=(g=l.value)==null?void 0:g[C];if(!S)return console.error(`表单 [name=${C}] 不存在`),!1;S.setData(v)}function E(v="default"){return new Promise(async(C,S)=>{var x;if(!u.value){const P=r.watch(u,async()=>{P(),C(await E(v))});return}const g=(x=l.value)==null?void 0:x[v];if(!g)return S(`表单 [name=${v}] 不存在`),!1;C(g)})}const{proxy:_}=r.getCurrentInstance();function D(){r.nextTick(()=>{u.value=!0,a("ready",s),_&&s.addComponentInstance("builder",_)})}return t({ready:u,getData:p,setData:y,validate:c,getFormInstance:E}),(v,C)=>r.unref($).initialized.value?(r.openBlock(),r.createBlock(r.Suspense,{key:1,onResolve:D},{default:r.withCtx(()=>[r.createElementVNode("div",He,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(d.schemas,(S,g)=>(r.openBlock(),r.createBlock(r.unref(pe),{key:g,componentSchema:S},null,8,["componentSchema"]))),128))])]),fallback:r.withCtx(()=>[r.createElementVNode("div",We,[r.createVNode(r.unref(o))])]),_:1})):(r.openBlock(),r.createElementBlock("div",Ue))}}),Ke={key:0,class:"loading-box"},Ze={class:"epic-designer-main"},Qe={class:"epic-header-container"},Xe={class:"loading-box"},H=`const { defineExpose, find } = epic;

function test (){
    console.log('test')
}

// 通过defineExpose暴露的函数或者属性
defineExpose({
 test 
})`,Ye=r.defineComponent({__name:"designer",props:{disabledZoom:{type:Boolean,default:!1},hiddenHeader:{type:Boolean,default:!1}},emits:["ready","save"],setup(n,{expose:t,emit:e}){const o=O(()=>Promise.resolve().then(()=>require("./index-69bb9485.cjs"))),s=O(()=>Promise.resolve().then(()=>require("./index-c8f18f00.cjs"))),a=O(()=>Promise.resolve().then(()=>require("./index-1bb1040d.cjs"))),i=O(()=>Promise.resolve().then(()=>require("./index-e0cf0a64.cjs"))),l=O(()=>Promise.resolve().then(()=>require("./index-beb5ee23.cjs"))),u=Q();u.setDesignMode();const f=n,d=e,p=r.reactive({checkedNode:null,hoverNode:null,disableHover:!1,matched:[]}),c=r.reactive({schemas:[],script:""}),{disabledZoom:y}=T();r.watch(()=>f.disabledZoom,h=>{y.value=h},{immediate:!0}),r.watch(()=>c.script,h=>{h&&h!==""&&u.setMethods(h)});const E=[{type:"page",id:"root",label:"页面",children:[],componentProps:{style:{padding:"16px"}}}];c.script=H,r.provide("pageSchema",c),r.provide("pageManager",u),r.provide("designerProps",f),r.provide("designer",{setCheckedNode:D,setHoverNode:v,setDisableHover:S,reset:P,state:p});function _(){c.schemas=V(E),D(c.schemas[0]),W.push(c.schemas,"初始化撤销功能")}async function D(h=c.schemas[0]){p.checkedNode=h,p.matched=ne(c.schemas,h.id)}async function v(h=null){var M;if(!h||p.disableHover)return p.hoverNode=null,!1;if((h==null?void 0:h.id)===((M=p.hoverNode)==null?void 0:M.id))return!1;p.hoverNode=h}function C(){r.nextTick(()=>{d("ready",{pageManager:u})})}async function S(h=!1){p.disableHover=h}function g(h){N(c,h)}function x(){return r.toRaw(c)}function P(){J(c.schemas,E)&&c.script===H||(N(c.schemas,E),c.script=H,D(c.schemas[0]),W.push(c.schemas,"重置操作"))}function q(){d("save",r.toRaw(c))}return _(),t({setData:g,getData:x,reset:P}),(h,M)=>r.unref($).initialized.value?(r.openBlock(),r.createBlock(r.Suspense,{key:1,onResolve:C},{default:r.withCtx(()=>[r.createElementVNode("div",Ze,[r.createElementVNode("div",Qe,[r.renderSlot(h.$slots,"header",{},()=>[f.hiddenHeader?r.createCommentVNode("",!0):(r.openBlock(),r.createBlock(r.unref(o),{key:0,onSave:q},{header:r.withCtx(()=>[r.renderSlot(h.$slots,"header-prefix")]),prefix:r.withCtx(()=>[r.renderSlot(h.$slots,"header-prefix")]),title:r.withCtx(()=>[r.renderSlot(h.$slots,"header-title")]),"right-prefix":r.withCtx(()=>[r.renderSlot(h.$slots,"header-right-prefix")]),"right-action":r.withCtx(()=>[r.renderSlot(h.$slots,"header-right-action")]),"right-suffix":r.withCtx(()=>[r.renderSlot(h.$slots,"header-right-suffix")]),_:3}))])]),r.createElementVNode("div",{class:r.normalizeClass(["epic-split-view-container",{"hidden-header":h.hiddenHeader}])},[r.createVNode(r.unref(s)),r.createVNode(r.unref(a)),r.createVNode(r.unref(i))],2)])]),fallback:r.withCtx(()=>[r.createElementVNode("div",Xe,[r.createVNode(r.unref(l))])]),_:3})):(r.openBlock(),r.createElementBlock("div",Ke))}}),je={component:async()=>await Promise.resolve().then(()=>require("./index-bdd12a2d.cjs")),defaultSchema:{label:"代码编辑器",type:"monacoEditor",field:"monacoEditor",icon:"epic-icon-write",input:!0},config:{attribute:[{label:"字段名",type:"input",field:"field"},{label:"标题",type:"input",field:"label"},{label:"默认值",type:"monacoEditor",field:"componentProps.defaultValue"}]},bindModel:"model-value"},et={component:async()=>await Promise.resolve().then(()=>require("./index-3476dbf2.cjs")),defaultSchema:{label:"页面",type:"page",componentProps:{},children:[]},config:{attribute:[{label:"页面名称",type:"input",componentProps:{placeholder:"请输入"},field:"name"}]}};function tt(n){n.component("ETabPaneEditor",async()=>await Promise.resolve().then(()=>require("./index-e6b08ad1.cjs"))),n.component("EInputSize",async()=>await Promise.resolve().then(()=>require("./index-3772d960.cjs"))),n.component("EColEditor",async()=>await Promise.resolve().then(()=>require("./index-4f29d48a.cjs"))),n.component("EActionEditor",async()=>await Promise.resolve().then(()=>require("./index-e144c25a.cjs"))),n.component("ERuleEditor",async()=>await Promise.resolve().then(()=>require("./index-f8e616b4.cjs"))),n.component("EOptionsEditor",async()=>await Promise.resolve().then(()=>require("./index-27d76f9d.cjs"))),n.component("ENode",async()=>await Promise.resolve().then(()=>require("./index-2913d93e.cjs"))),n.registerActivitybar({id:"component_view",title:"组件",icon:"epic-icon-mokuai_1",component:async()=>await Promise.resolve().then(()=>require("./index-8ad24572.cjs"))}),n.registerActivitybar({id:"sound_code_view",title:"源码",icon:"epic-icon-daima1",component:async()=>await Promise.resolve().then(()=>require("./index-35678f5c.cjs"))}),n.registerActivitybar({id:"outline_view",title:"大纲",icon:"epic-icon-juxingkaobei",component:async()=>await Promise.resolve().then(()=>require("./outline-038120d7.cjs"))}),n.registerRightSidebar({id:"attribute_view",title:"属性",component:async()=>await Promise.resolve().then(()=>require("./attributeView-a1b05a30.cjs"))}),n.registerRightSidebar({id:"style_view",title:"样式",component:async()=>await Promise.resolve().then(()=>require("./styleView-ddf6e54e.cjs"))}),n.registerRightSidebar({id:"event_view",title:"事件",component:async()=>await Promise.resolve().then(()=>require("./eventView-012a72c9.cjs"))}),[je,et].forEach(e=>{n.registerComponent(e)})}tt($);exports.PluginManager=ue;exports._sfc_main=Je;exports._sfc_main$1=pe;exports._sfc_main$2=Ye;exports.capitalizeFirstLetter=te;exports.convertKFormData=Ce;exports.debounce=Le;exports.deepClone=V;exports.deepCompareAndModify=N;exports.deepEqual=J;exports.findSchemaById=Se;exports.findSchemaInfoById=be;exports.findSchemas=F;exports.generateNewSchema=ve;exports.getAttributeValue=ye;exports.getFormFields=we;exports.getMatchedById=ne;exports.getUUID=G;exports.loadAsyncComponent=O;exports.mapSchemas=oe;exports.pluginManager=$;exports.recursionConvertedNode=B;exports.revoke=W;exports.setAttributeValue=ge;exports.useElementDrag=Ge;exports.useElementSize=Fe;exports.useElementZoom=ze;exports.useKeyPress=ce;exports.usePageManager=Q;exports.useResizeObserver=ae;exports.useRevoke=de;exports.useShareStore=T;exports.useStore=le;exports.useTimedQuery=Te;exports.watchOnce=xe;
