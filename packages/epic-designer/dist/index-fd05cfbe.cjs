"use strict";var he=Object.defineProperty;var ve=(n,e,t)=>e in n?he(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var O=(n,e,t)=>(ve(n,typeof e!="symbol"?e+"":e,t),t);const r=require("vue");const V=(n,e)=>r.defineAsyncComponent({loader:n,loadingComponent:e,delay:80});function G(n=10){return Math.random().toString(36).substring(2,2+n)}function ne(n){return n.charAt(0).toUpperCase()+n.slice(1)}function D(n,e=new WeakMap){if(typeof n!="object"||n===null)return n;if(e.has(n))return e.get(n);if(Array.isArray(n)){const s=n.map(o=>D(o,e));return e.set(n,s),s}const t={};return e.set(n,t),Object.keys(n).forEach(s=>{t[s]=D(n[s],e)}),t}function ye(n){const[e]=re([D(n)],t=>{const s={...t,id:`${t.type}_${G(8)}`};return(s.field||s.input)&&(s.field=s.id),s});return e}function N(n,e){for(const[t,s]of Object.entries(e)){const o=n==null?void 0:n[t];o&&s&&typeof o=="object"&&typeof s=="object"?N(o,s):n[t]=s}Object.keys(n).reverse().forEach(t=>{e.hasOwnProperty(t)||(Array.isArray(e)?n.splice(t,1):delete n[t])})}function K(n,e,t=[],s=new WeakMap){const o=i=>{if(Array.isArray(i))return i.map(o);if(typeof i=="object"&&i!==null){if(s.has(i))return"[Circular]";s.set(i,!0);const a=Object.keys(i).sort(),l={};return a.forEach(c=>{t.includes(c)||(l[c]=o(i[c]))}),s.delete(i),l}else return i};return JSON.stringify(o(n))===JSON.stringify(o(e))}function oe(n,e){const t=[];let s=!1;function o(i){if(t.push(i),i.id===e&&(s=!0),!s&&i.children!=null&&i.children.length>0)for(let a=0;a<i.children.length&&(o(i.children[a]),!s);a++);if(!s&&i.slots)for(let a in i.slots)for(let l=0;l<i.slots[a].length&&(o(i.slots[a][l]),!s);l++);s||t.pop()}return n.forEach(o),s||console.error(`没有查询到id为${e}的节点`),t}function ge(n,e){const t=n.split(".");let s=e;for(let o=0;o<t.length;o++)if(s=s[t[o]],typeof s>"u")return;return s}function we(n,e,t){const s=e.split(".");let o=t;s.forEach((i,a)=>{if(a===s.length-1){o[i]=n;return}o=o[i]??(o[i]={})})}function Se(n,e="default"){const t=F(n,o=>{var i;return o.type==="form"&&(((i=o.componentProps)==null?void 0:i.name)??o.name===e)},!0);return F((t==null?void 0:t.children)??[],o=>!!o.input,!1,o=>o.type!=="subform").map(o=>o.field)}function F(n,e,t=!1,s){const o=[],i=[...n];for(;i.length;){const a=i.pop();if(a!=null&&a.children&&(!s||s(a))&&i.push(...a.children),a!=null&&a.slots&&(!s||s(a)))for(let l in a.slots)i.push(...a.slots[l]);if(e(a)&&(o.push(a),t))return a}return t?!1:o}function re(n,e,t){const s=[...n];for(;s.length;){const o=s.pop();if(o!=null&&o.children&&(!t||t(o))&&s.push(...o.children),o!=null&&o.slots&&(!t||t(o)))for(let i in o.slots)s.push(...o.slots[i]);N(o,e(o))}return n}function be(n,e){const t=F(n,s=>s.id===e,!0);if(!t)throw new Error(`没有查询到id为${e}的节点`);return t}function Ce(n,e){const t=[{type:"",children:n}];let s=0,o=null;if(F(t,i=>{if(o=i.children??null,!o){if(i!=null&&i.slots)for(let a in i.slots){o=i.slots[a];for(let l=0;l<o.length;l++)if(o[l].id===e)return s=l,!0}return!1}for(let a=0;a<o.length;a++)if(o[a].id===e)return s=a,!0;return!1},!0),!o)throw new Error(`没有查询到id为${e}的节点`);return{list:o,schema:o[s],index:s}}function Pe(n){const e={schemas:[{type:"page",id:"root",label:"页面",children:[{label:"表单",type:"form",icon:"epic-icon-daibanshixiang",labelWidth:n.config.labelWidth||100,name:"default",componentProps:{layout:n.config.layout||"horizontal",labelWidth:n.config.labelWidth||100,labelLayout:n.config.labelLayout==="flex"?"fixed":"flex",labelCol:n.config.labelCol||{span:5},wrapperCol:n.config.wrapperCol||{span:19},hideRequiredMark:n.config.hideRequiredMark||!1,colon:n.config.colon||!0,labelAlign:n.config.labelAlign||"right",size:n.config.size||"middle"},children:[],id:"form_"+G()}],componentProps:{style:{padding:"16px"}}}],script:n.script||""};return e.schemas[0].children[0].children=B(n.list),e}function B(n,e){return n.map(t=>{var c,m,d;let s=t.type??"";const o=t.options??{},i=(p,u)=>{s===p&&(s=u,o.defaultValue&&(o.defaultValue=JSON.parse(o.defaultValue)))};if(i("uploadImg","upload-image"),i("uploadFile","upload-file"),s==="date"&&o.range&&(o.type="daterange",delete o.range),(s==="date"||s==="time")&&(o.valueFormat=o.format),s==="textarea"){const{minRows:p,maxRows:u}=o;o.autoSize={minRows:p,maxRows:u},delete o.minRows,delete o.maxRows}s==="number"&&!o.precision&&delete o.precision,o.width&&(o.style={width:o.width},delete o.width),s==="grid"&&(s="row",t.childImmovable=!0),e&&e.type==="grid"&&(s="col",o.span=t.span,t.key=G());const a={label:t.label,type:s,icon:t.icon||"",field:t.model,componentProps:o,childImmovable:t.childImmovable,id:t.key};return(o.noFormItem||!o.showLabel)&&(a.noFormItem=!0,delete o.noFormItem,delete o.showLabel),o.clearable&&(o.allowClear=!0,delete o.clearable),["input","textarea","number","password","select","cascader","checkbox","radio","date","time","slider","switch","color-picker","upload-file","upload-image"].includes(s)&&(a.input=!0,((m=(c=t.rules)==null?void 0:c[0])==null?void 0:m.required)===!1&&t.rules.shift(),((d=t.rules)==null?void 0:d.length)>0&&(a.rules=t.rules)),t.list&&(a.children=B(t.list,t)),t.columns&&(a.children=B(t.columns,t)),t.trs&&(a.children=B(t.trs,t)),t.tds&&(a.children=B(t.tds,t)),a})}function Z(n){return r.getCurrentScope()?(r.onScopeDispose(n),!0):!1}function _e(n){let e=0,t,s;const o=()=>{e-=1,s&&e<=0&&(s.stop(),t=void 0,s=void 0)};return(...i)=>(e+=1,t||(s=r.effectScope(!0),t=s.run(()=>n(...i))),Z(o),t)}function Q(n){return typeof n=="function"?n():r.unref(n)}const Ee=typeof window<"u",xe=()=>{};function Ie(n,e,t){const s=r.watch(n,(...o)=>(r.nextTick(()=>s()),e(...o)),t)}function R(n){var e;const t=Q(n);return(e=t==null?void 0:t.$el)!=null?e:t}const z=Ee?window:void 0;function ke(...n){let e,t,s,o;if(typeof n[0]=="string"||Array.isArray(n[0])?([t,s,o]=n,e=z):[e,t,s,o]=n,!e)return xe;Array.isArray(t)||(t=[t]),Array.isArray(s)||(s=[s]);const i=[],a=()=>{i.forEach(d=>d()),i.length=0},l=(d,p,u,y)=>(d.addEventListener(p,u,y),()=>d.removeEventListener(p,u,y)),c=r.watch(()=>[R(e),Q(o)],([d,p])=>{a(),d&&i.push(...t.flatMap(u=>s.map(y=>l(d,u,y,p))))},{immediate:!0,flush:"post"}),m=()=>{c(),a()};return Z(m),m}var Ae=Object.defineProperty,Oe=Object.defineProperties,Ve=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,De=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable,ee=(n,e,t)=>e in n?Ae(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,se=(n,e)=>{for(var t in e||(e={}))De.call(e,t)&&ee(n,t,e[t]);if(j)for(var t of j(e))$e.call(e,t)&&ee(n,t,e[t]);return n},ie=(n,e)=>Oe(n,Ve(e));function Me(n){return typeof n=="function"?n:typeof n=="string"?e=>e.key===n:Array.isArray(n)?e=>n.includes(e.key):()=>!0}function ae(...n){let e,t,s={};n.length===3?(e=n[0],t=n[1],s=n[2]):n.length===2?typeof n[1]=="object"?(e=!0,t=n[0],s=n[1]):(e=n[0],t=n[1]):(e=!0,t=n[0]);const{target:o=z,eventName:i="keydown",passive:a=!1,dedupe:l=!1}=s,c=Me(e);return ke(o,i,d=>{d.repeat&&Q(l)||c(d)&&t(d)},a)}function U(n,e,t={}){return ae(n,e,ie(se({},t),{eventName:"keydown"}))}function H(n,e,t={}){return ae(n,e,ie(se({},t),{eventName:"keyup"}))}function Ne(){const n=r.ref(!1);return r.getCurrentInstance()&&r.onMounted(()=>{n.value=!0}),n}function Be(n){const e=Ne();return r.computed(()=>(e.value,!!n()))}var te=Object.getOwnPropertySymbols,Re=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable,Fe=(n,e)=>{var t={};for(var s in n)Re.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&te)for(var s of te(n))e.indexOf(s)<0&&qe.call(n,s)&&(t[s]=n[s]);return t};function le(n,e,t={}){const s=t,{window:o=z}=s,i=Fe(s,["window"]);let a;const l=Be(()=>o&&"ResizeObserver"in o),c=()=>{a&&(a.disconnect(),a=void 0)},m=r.computed(()=>Array.isArray(n)?n.map(u=>R(u)):[R(n)]),d=r.watch(m,u=>{if(c(),l.value&&o){a=new ResizeObserver(e);for(const y of u)y&&a.observe(y,i)}},{immediate:!0,flush:"post",deep:!0}),p=()=>{c(),d()};return Z(p),{isSupported:l,stop:p}}function Ge(n,e={width:0,height:0},t={}){const{window:s=z,box:o="content-box"}=t,i=r.computed(()=>{var c,m;return(m=(c=R(n))==null?void 0:c.namespaceURI)==null?void 0:m.includes("svg")}),a=r.ref(e.width),l=r.ref(e.height);return le(n,([c])=>{const m=o==="border-box"?c.borderBoxSize:o==="content-box"?c.contentBoxSize:c.devicePixelContentBoxSize;if(s&&i.value){const d=R(n);if(d){const p=s.getComputedStyle(d);a.value=Number.parseFloat(p.width),l.value=Number.parseFloat(p.height)}}else if(m){const d=Array.isArray(m)?m:[m];a.value=d.reduce((p,{inlineSize:u})=>p+u,0),l.value=d.reduce((p,{blockSize:u})=>p+u,0)}else a.value=c.contentRect.width,l.value=c.contentRect.height},t),r.watch(()=>R(n),c=>{a.value=c?e.width:0,l.value=c?e.height:0}),{width:a,height:l}}function ce(){const n=r.ref(1),e=r.ref(!1),{pressSpace:t,pressShift:s,pressCtrl:o}=ue();return{canvasScale:n,pressSpace:t,pressShift:s,pressCtrl:o,disabledZoom:e}}const T=_e(ce);function ue(){const n=r.ref(!1),e=r.ref(!1),t=r.ref(!1);return U(" ",s=>{var o=s.target;["INPUT","TEXTAREA"].includes(o.tagName)||s.preventDefault(),n.value=!0}),H(" ",()=>{n.value=!1}),U("Shift",s=>{s.preventDefault(),e.value=!0}),H("Shift",()=>{e.value=!1}),U("Control",s=>{s.preventDefault(),t.value=!0}),H("Control",()=>{t.value=!1}),{pressSpace:n,pressShift:e,pressCtrl:t}}function ze(n){const{pressSpace:e}=T();let t=0,s=0;function o(l){var c;t=l.x,s=l.y,(c=l.dataTransfer)==null||c.setDragImage(document.createElement("div"),0,0)}function i(l){if(l.preventDefault(),!l.x||!l.y||!e.value)return;const c=l.x-t,m=l.y-s;t=l.x,s=l.y,n.value&&(n.value.scrollTop-=m,n.value.scrollLeft-=c)}function a(){e.value=!1}return{handleElementDragStart:o,handleElementDrag:i,handleElementDragEnd:a}}function Te(n){const{pressCtrl:e,canvasScale:t,disabledZoom:s}=T();function o(i){if(!e.value||s.value)return;i.preventDefault();let a=0;i.deltaY<0?a=t.value+.05:a=t.value-.05,!(a>150||a<.5)&&(t.value=a)}return r.watch(()=>t.value,i=>{n.value&&!s.value&&(n.value.style.transform=`scale(${i})`)}),{handleZoom:o,canvasScale:t}}function Le(n,e=16.66){let t;function s(){o(),t=window.setInterval(n,e)}function o(){window.clearInterval(t)}return{startTimedQuery:s,stopTimedQuery:o}}function Ue(n,e){let t=null;return(...s)=>{t&&clearTimeout(t),t=setTimeout(()=>{n.apply(this,s)},e)}}class de{constructor(){O(this,"initialized",r.ref(!1));O(this,"components",{});O(this,"componentConfigs",{});O(this,"componentSchemaGroups",r.ref([]));O(this,"hiddenComponents",[]);O(this,"componentGroupNameMap",{});O(this,"sortedGroups",["表单","布局"]);O(this,"viewsContainers",{activitybars:[],rightSidebars:[]});O(this,"publicMethods",{})}component(e,t){typeof t=="function"&&(t=V(t)),this.components[e]=t}registerComponent(e){this.component(e.defaultSchema.type,e.component),e.defaultSchema.input&&(e.config.action||(e.config.action=[]),e.config.action.unshift({type:"setValue",describe:"设置值",argsConfigs:[{...e.defaultSchema,label:"设置数据",field:"0"}]},{type:"getValue",describe:"获取值"})),this.componentConfigs[e.defaultSchema.type]=e,this.computedComponentSchemaGroups()}getComponents(){return this.components}getComponent(e){return this.components[e]}registerActivitybar(e){typeof e.component=="function"&&(e.component=V(e.component));const t=this.viewsContainers.activitybars.findIndex(s=>s.id===e.id);t!==-1?this.viewsContainers.activitybars[t]=e:this.viewsContainers.activitybars.push(e)}getActivitybars(){return this.viewsContainers.activitybars}registerRightSidebar(e){typeof e.component=="function"&&(e.component=V(e.component));const t=this.viewsContainers.rightSidebars.findIndex(s=>s.id===e.id);t!==-1?this.viewsContainers.rightSidebars[t]=e:this.viewsContainers.rightSidebars.push(e)}getRightSidebars(){return this.viewsContainers.rightSidebars}getComponentConfings(){return this.componentConfigs}getComponentConfingByType(e){return this.componentConfigs[e]}computedComponentSchemaGroups(){const e=[];Object.values(this.componentConfigs).forEach(t=>{if(!this.hiddenComponents.includes(t.defaultSchema.type)&&t.groupName){const s=this.componentGroupNameMap[t.groupName]??t.groupName;let o=e.findIndex(a=>a.title===s);o===-1&&(e.push({title:s,list:[]}),o=e.length-1);let i=e[o].list.findIndex(a=>a.type===t.defaultSchema.type);i!==-1?e[o].list[i]=t.defaultSchema:e[o].list.push(t.defaultSchema)}}),e.sort((t,s)=>{const o=this.sortedGroups.indexOf(t.title),i=this.sortedGroups.indexOf(s.title);return o===-1?1:i===-1?-1:o-i}),this.componentSchemaGroups.value=e}getComponentSchemaGroups(){return this.componentSchemaGroups}setComponentGroupNameMap(e,t){this.componentGroupNameMap[e]=t}clearComponentGroupNameMap(){this.componentGroupNameMap={}}setSortedGroups(e){this.sortedGroups=e,this.computedComponentSchemaGroups()}clearSortedGroups(){this.sortedGroups=[],this.computedComponentSchemaGroups()}hideComponent(e){this.hiddenComponents.push(e),this.computedComponentSchemaGroups()}showComponent(e){this.hiddenComponents=this.hiddenComponents.filter(t=>t!==e),this.computedComponentSchemaGroups()}setHideComponents(e){this.hiddenComponents=e,this.computedComponentSchemaGroups()}setInitialized(e){this.initialized.value=e}addPublicMethod(e){this.publicMethods[e.methodName]=e}removePublicMethod(e){delete this.publicMethods[e]}}const $=new de;function X(){const n=r.ref({}),e=r.ref({}),t=r.ref(!1);function s(d){return n.value[d]}function o(d,p){n.value[d]=p}function i(d){delete n.value[d]}function a(d,p=!1){const u=Object.entries($.publicMethods).reduce((y,[E,A])=>(y[E]=A.method,y),{});try{new Function(`const epic = this;${d}`).bind({...u,getComponent:s,find:s,defineExpose:l,publicMethods:u,pluginManager:$})()}catch(y){p&&console.error("[epic-desinger：自定义函数]异常：",y)}}function l(d){d!=null&&(e.value=d)}function c(d,...p){d==null||d.forEach(u=>{var y,E,A;if(u.type==="public"&&((y=$.publicMethods[u.methodName])==null||y.method(...p)),u.type==="custom"&&((A=(E=e.value)[u.methodName])==null||A.call(E,...p)),u.type==="component"){(u.componentId!=null&&s(u.componentId))[u.methodName](...u.args?JSON.parse(u.args):p);return}})}function m(d=!0){t.value=d}return{componentInstances:n,funcs:e,isDesignMode:t,getComponentInstance:s,find:s,addComponentInstance:o,removeComponentInstance:i,setMethods:a,doActions:c,setDesignMode:m}}function pe(){const n=r.ref([]),e=r.ref([]),t=r.ref(null);let s=0;function o(l,c="插入组件"){const m=Date.now();s+150>m||(s=m,t.value!=null&&(n.value.push(t.value),e.value.splice(0,e.value.length)),t.value={type:c,componentSchema:JSON.stringify(l)},n.value.length>20&&n.value.unshift())}function i(){if(n.value.length===0)return!1;const l=n.value.pop();return t.value!=null&&e.value.push(t.value),t.value=l,JSON.parse(l.componentSchema)}function a(){if(e.value.length===0)return!1;const l=e.value.pop();return t.value!=null&&n.value.push(t.value),t.value=l,JSON.parse(l.componentSchema)}return{recordList:n,undoList:e,currentRecord:t,push:o,undo:i,redo:a}}const J=pe(),fe=r.defineComponent({name:"ENode",__name:"node",props:{componentSchema:{},modelValue:{},ruleField:{},resetFormData:{},name:{}},emits:["update:modelValue","change"],setup(n,{emit:e}){const{proxy:t}=r.getCurrentInstance(),s=n;let o=r.reactive(D(s.componentSchema));r.watch(()=>s.componentSchema,f=>{K(o,f,["children"])||N(o,D(f))},{deep:!0});let i=r.inject("formData",{});const a=r.inject("slots",{}),l=r.inject("pageManager",{}),c=r.inject("disabled",{value:!1}),m=r.inject("ruleFieldPrefix",null),d=r.inject("resetFormData",!1);(s.resetFormData||d)&&(i={});const p=e,u=$.getComponent("form-item"),y=r.ref(),E=r.ref(),A=r.useAttrs();Object.keys(A).length&&r.provide("nodeAttrs",A);const I=r.shallowRef(null),v=r.reactive({}),S=r.computed(()=>{var f,w;return(f=o.componentProps)!=null&&f.hidden?!1:typeof o.show=="boolean"?o.show:((w=o.show)==null?void 0:w.call(o,{values:i}))??!0}),x=r.computed(()=>{var k;const f=S.value&&((k=o.rules)==null?void 0:k.map(b=>({...b,validator:b.validator&&l.funcs.value[b.validator]})));let w=o.field;s.ruleField?w=s.ruleField:m&&o.field&&(w=D(m),w.push(o.field));const _={...o,rules:f,rule:f,field:w};return _.children&&delete _.children,_}),g=r.computed(()=>{var _,k;const f=((_=C.value)==null?void 0:_.bindModel)??"modelValue",w={};return o.on&&Object.keys(o.on).forEach(b=>{w[`on${ne(b)}`]=(...me)=>l.doActions(o.on[b],...me)}),{...s,...o.componentProps,disabled:(c==null?void 0:c.value)||((k=o.componentProps)==null?void 0:k.disabled),bindModel:f,[`onUpdate:${f}`]:L,...w}}),C=r.computed(()=>$.getComponentConfingByType(o.type)??null),P=()=>i[o.field??""]??s.modelValue;r.watch(()=>y.value,()=>{M()},{immediate:!0});function M(){var w;const f=y.value||t;o.id&&f&&(o.input&&(f.setValue=L,f.getValue=()=>i[o.field]||s.modelValue),f.setAttr=(_,k)=>o.componentProps[_]=k,f.getAttr=_=>o.componentProps[_],l.addComponentInstance(o.id,f),(w=C.value)!=null&&w.defaultSchema.input&&o.noFormItem!==!0&&E.value&&l.addComponentInstance(o.id+"formItem",E.value))}function h(){var f;o.id&&(l.removeComponentInstance(o.id),(f=C.value)!=null&&f.defaultSchema.input&&o.noFormItem!==!0&&l.removeComponentInstance(o.id+"formItem"))}async function q(){var w,_,k;if(typeof((w=o.componentProps)==null?void 0:w.defaultValue)<"u"){const b=l.isDesignMode.value?(_=o.componentProps)==null?void 0:_.defaultValue:i[o.field]??((k=o.componentProps)==null?void 0:k.defaultValue);L(D(b))}if(o.type==="slot"){const b=o.slotName;if(!b)return;I.value=r.defineComponent({setup(){return()=>r.renderSlot(a,b,{componentSchema:o,model:i})}});return}const f=$.getComponent(o.type);if(!f){console.error(`组件${o.type}未注册`);return}if(typeof f=="function"){const b=await f();I.value=b.default??b}else I.value=f}function L(f){p("update:modelValue",f),p("change",f),o.field&&(i[o.field]=f)}let Y=null;return r.watch(()=>o,f=>{const w=JSON.stringify({...f,children:void 0});if(w===Y)return!1;Y=w,q()},{immediate:!0,deep:!0}),r.onUnmounted(h),(f,w)=>{var k;const _=r.resolveComponent("ENode");return r.unref(o).noFormItem!==!0&&((k=C.value)!=null&&k.defaultSchema.input)&&I.value&&S.value?(r.openBlock(),r.createBlock(r.unref(u),r.mergeProps({key:0,ref_key:"formItemRef",ref:E},x.value),{default:r.withCtx(()=>[(r.openBlock(),r.createBlock(r.resolveDynamicComponent(I.value),r.mergeProps({ref_key:"componentInstance",ref:y,onVnodeMounted:M},{...g.value,...v,[g.value.bindModel]:P()}),{node:r.withCtx(b=>[r.createVNode(_,r.normalizeProps(r.guardReactiveProps(b)),null,16)]),"edit-node":r.withCtx(()=>[r.renderSlot(f.$slots,"edit-node")]),_:3},16))]),_:3},16)):I.value&&S.value?(r.openBlock(),r.createBlock(r.resolveDynamicComponent(I.value),r.mergeProps({key:1,onVnodeMounted:M,ref_key:"componentInstance",ref:y,model:r.unref(i)},{...g.value,...v,[g.value.bindModel]:P()}),{node:r.withCtx(b=>[r.createVNode(_,r.normalizeProps(r.guardReactiveProps(b)),null,16)]),"edit-node":r.withCtx(()=>[r.renderSlot(f.$slots,"edit-node")]),_:3},16,["model"])):r.createCommentVNode("",!0)}}}),He={key:0,class:"loading-box"},We={class:"epic-builder-main"},Je={class:"loading-box"},Ke=r.defineComponent({__name:"builder",props:{pageSchema:{},disabled:{type:Boolean}},emits:["ready"],setup(n,{expose:e,emit:t}){const s=V(()=>Promise.resolve().then(()=>require("./index-beb5ee23.cjs"))),o=X(),i=t,a=r.useSlots(),l=r.ref({}),c=r.ref(!1),m=n,d=r.reactive({schemas:[]});r.watch(()=>m.pageSchema,v=>{N(d,v)},{immediate:!0,deep:!0}),r.watch(()=>d.script,v=>{v&&v!==""&&o.setMethods(v,!0)},{immediate:!0}),r.provide("slots",a),r.provide("pageManager",o),r.provide("forms",l),r.provide("pageSchema",d),r.provide("disabled",r.computed(()=>m.disabled));function p(v="default"){return new Promise(async(S,x)=>{var P;if(!c.value){const M=r.watch(c,async()=>{M(),S(await p(v))});return}const g=(P=l.value)==null?void 0:P[v];if(!g)return x(`表单 [name=${v}] 不存在`),!1;const C=D(await g.getData());S(C)})}function u(v="default"){return new Promise(async(S,x)=>{var C;if(!c.value){const P=r.watch(c,async()=>{P(),S(await u(v))});return}const g=(C=l.value)==null?void 0:C[v];if(!g)return x(`表单 [name=${v}] 不存在`),!1;try{await g.validate();const P=await g.getData();S(P)}catch(P){x(P)}})}function y(v,S="default"){var g;if(!c.value){const C=r.watch(c,()=>{C(),y(v,S)});return}const x=(g=l.value)==null?void 0:g[S];if(!x)return console.error(`表单 [name=${S}] 不存在`),!1;x.setData(v)}function E(v="default"){return new Promise(async(S,x)=>{var C;if(!c.value){const P=r.watch(c,async()=>{P(),S(await E(v))});return}const g=(C=l.value)==null?void 0:C[v];if(!g)return x(`表单 [name=${v}] 不存在`),!1;S(g)})}const{proxy:A}=r.getCurrentInstance();function I(){r.nextTick(()=>{c.value=!0,i("ready",o),A&&o.addComponentInstance("builder",A)})}return e({ready:c,getData:p,setData:y,validate:u,getFormInstance:E}),(v,S)=>r.unref($).initialized.value?(r.openBlock(),r.createBlock(r.Suspense,{key:1,onResolve:I},{default:r.withCtx(()=>[r.createElementVNode("div",We,[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(d.schemas,(x,g)=>(r.openBlock(),r.createBlock(r.unref(fe),{key:g,componentSchema:x},null,8,["componentSchema"]))),128))])]),fallback:r.withCtx(()=>[r.createElementVNode("div",Je,[r.createVNode(r.unref(s))])]),_:1})):(r.openBlock(),r.createElementBlock("div",He))}}),Ze={key:0,class:"loading-box"},Qe={class:"epic-designer-main"},Xe={class:"epic-header-container"},Ye={class:"loading-box"},W=`const { defineExpose, find } = epic;

function test (){
    console.log('test')
}

// 通过defineExpose暴露的函数或者属性
defineExpose({
 test 
})`,je=r.defineComponent({__name:"designer",props:{disabledZoom:{type:Boolean,default:!1},hiddenHeader:{type:Boolean,default:!1}},emits:["ready","save"],setup(n,{expose:e,emit:t}){const s=V(()=>Promise.resolve().then(()=>require("./index-8d79bd3b.cjs"))),o=V(()=>Promise.resolve().then(()=>require("./index-979894da.cjs"))),i=V(()=>Promise.resolve().then(()=>require("./index-1b7c65b5.cjs"))),a=V(()=>Promise.resolve().then(()=>require("./index-7af3f378.cjs"))),l=V(()=>Promise.resolve().then(()=>require("./index-beb5ee23.cjs"))),c=X();c.setDesignMode();const m=n,d=t,p=r.reactive({checkedNode:null,hoverNode:null,disableHover:!1,matched:[]}),u=r.reactive({schemas:[],script:""}),{disabledZoom:y}=T();r.watch(()=>m.disabledZoom,h=>{y.value=h},{immediate:!0}),r.watch(()=>u.script,h=>{h&&h!==""&&c.setMethods(h)});const E=[{type:"page",id:"root",label:"页面",children:[],componentProps:{style:{padding:"16px"}}}];u.script=W,r.provide("pageSchema",u),r.provide("pageManager",c),r.provide("designerProps",m),r.provide("designer",{setCheckedNode:I,setHoverNode:v,setDisableHover:x,reset:P,state:p});function A(){u.schemas=D(E),I(u.schemas[0]),J.push(u.schemas,"初始化撤销功能")}async function I(h=u.schemas[0]){p.checkedNode=h,p.matched=oe(u.schemas,h.id)}async function v(h=null){var q;if(!h||p.disableHover)return p.hoverNode=null,!1;if((h==null?void 0:h.id)===((q=p.hoverNode)==null?void 0:q.id))return!1;p.hoverNode=h}function S(){r.nextTick(()=>{d("ready",{pageManager:c})})}async function x(h=!1){p.disableHover=h}function g(h){N(u,h)}function C(){return r.toRaw(u)}function P(){K(u.schemas,E)&&u.script===W||(N(u.schemas,E),u.script=W,I(u.schemas[0]),J.push(u.schemas,"重置操作"))}function M(){d("save",r.toRaw(u))}return A(),e({setData:g,getData:C,reset:P}),(h,q)=>r.unref($).initialized.value?(r.openBlock(),r.createBlock(r.Suspense,{key:1,onResolve:S},{default:r.withCtx(()=>[r.createElementVNode("div",Qe,[r.createElementVNode("div",Xe,[r.renderSlot(h.$slots,"header",{},()=>[m.hiddenHeader?r.createCommentVNode("",!0):(r.openBlock(),r.createBlock(r.unref(s),{key:0,onSave:M},{header:r.withCtx(()=>[r.renderSlot(h.$slots,"header-prefix")]),prefix:r.withCtx(()=>[r.renderSlot(h.$slots,"header-prefix")]),title:r.withCtx(()=>[r.renderSlot(h.$slots,"header-title")]),"right-prefix":r.withCtx(()=>[r.renderSlot(h.$slots,"header-right-prefix")]),"right-action":r.withCtx(()=>[r.renderSlot(h.$slots,"header-right-action")]),"right-suffix":r.withCtx(()=>[r.renderSlot(h.$slots,"header-right-suffix")]),_:3}))])]),r.createElementVNode("div",{class:r.normalizeClass(["epic-split-view-container",{"hidden-header":h.hiddenHeader}])},[r.createVNode(r.unref(o)),r.createVNode(r.unref(i)),r.createVNode(r.unref(a))],2)])]),fallback:r.withCtx(()=>[r.createElementVNode("div",Ye,[r.createVNode(r.unref(l))])]),_:3})):(r.openBlock(),r.createElementBlock("div",Ze))}}),et={component:async()=>await Promise.resolve().then(()=>require("./index-bdd12a2d.cjs")),defaultSchema:{label:"代码编辑器",type:"monacoEditor",field:"monacoEditor",icon:"epic-icon-write",input:!0},config:{attribute:[{label:"字段名",type:"input",field:"field"},{label:"标题",type:"input",field:"label"},{label:"默认值",type:"monacoEditor",field:"componentProps.defaultValue"}]},bindModel:"model-value"},tt={component:async()=>await Promise.resolve().then(()=>require("./index-3476dbf2.cjs")),defaultSchema:{label:"页面",type:"page",componentProps:{},children:[]},config:{attribute:[{label:"页面名称",type:"input",componentProps:{placeholder:"请输入"},field:"name"}]}};function nt(n){n.component("ETabPaneEditor",async()=>await Promise.resolve().then(()=>require("./index-7188c436.cjs"))),n.component("EInputSize",async()=>await Promise.resolve().then(()=>require("./index-f295f8d2.cjs"))),n.component("EColEditor",async()=>await Promise.resolve().then(()=>require("./index-7221647f.cjs"))),n.component("EActionEditor",async()=>await Promise.resolve().then(()=>require("./index-730fd5a0.cjs"))),n.component("ERuleEditor",async()=>await Promise.resolve().then(()=>require("./index-a4eee7be.cjs"))),n.component("EOptionsEditor",async()=>await Promise.resolve().then(()=>require("./index-58e40c8c.cjs"))),n.component("ENode",async()=>await Promise.resolve().then(()=>require("./index-dd8faf98.cjs"))),n.registerActivitybar({id:"component_view",title:"组件",icon:"epic-icon-mokuai_1",component:async()=>await Promise.resolve().then(()=>require("./index-a18ea41c.cjs"))}),n.registerActivitybar({id:"sound_code_view",title:"源码",icon:"epic-icon-daima1",component:async()=>await Promise.resolve().then(()=>require("./index-588efd24.cjs"))}),n.registerActivitybar({id:"outline_view",title:"大纲",icon:"epic-icon-juxingkaobei",component:async()=>await Promise.resolve().then(()=>require("./outline-b8950cf2.cjs"))}),n.registerRightSidebar({id:"attribute_view",title:"属性",component:async()=>await Promise.resolve().then(()=>require("./attributeView-9e78cc7f.cjs"))}),n.registerRightSidebar({id:"style_view",title:"样式",component:async()=>await Promise.resolve().then(()=>require("./styleView-5bafc356.cjs"))}),n.registerRightSidebar({id:"event_view",title:"事件",component:async()=>await Promise.resolve().then(()=>require("./eventView-dc0c842a.cjs"))}),[et,tt].forEach(t=>{n.registerComponent(t)})}nt($);exports.PluginManager=de;exports._sfc_main=Ke;exports._sfc_main$1=fe;exports._sfc_main$2=je;exports.capitalizeFirstLetter=ne;exports.convertKFormData=Pe;exports.debounce=Ue;exports.deepClone=D;exports.deepCompareAndModify=N;exports.deepEqual=K;exports.findSchemaById=be;exports.findSchemaInfoById=Ce;exports.findSchemas=F;exports.generateNewSchema=ye;exports.getAttributeValue=ge;exports.getFormFields=Se;exports.getMatchedById=oe;exports.getUUID=G;exports.loadAsyncComponent=V;exports.mapSchemas=re;exports.pluginManager=$;exports.recursionConvertedNode=B;exports.revoke=J;exports.setAttributeValue=we;exports.useElementDrag=ze;exports.useElementSize=Ge;exports.useElementZoom=Te;exports.useKeyPress=ue;exports.usePageManager=X;exports.useResizeObserver=le;exports.useRevoke=pe;exports.useShareStore=T;exports.useStore=ce;exports.useTimedQuery=Le;exports.watchOnce=Ie;
