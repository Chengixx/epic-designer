(function(o,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],a):(o=typeof globalThis<"u"?globalThis:o||self,a(o.index={},o.Vue))})(this,function(o,a){"use strict";var oe=Object.defineProperty;var ie=(o,a,m)=>a in o?oe(o,a,{enumerable:!0,configurable:!0,writable:!0,value:m}):o[a]=m;var v=(o,a,m)=>(ie(o,typeof a!="symbol"?a+"":a,m),m);function m(t=10){return Number(`${Math.random().toString().substring(3,t)}${Date.now()}`).toString(36)}function k(t){return t.charAt(0).toUpperCase()+t.slice(1)}function S(t,e=new WeakMap){if(typeof t!="object"||t===null)return t;if(e.has(t))return e.get(t);if(Array.isArray(t)){const r=t.map(u=>S(u,e));return e.set(t,r),r}const n={};return e.set(t,n),Object.keys(t).forEach(r=>{n[r]=S(t[r],e)}),n}function O(t,e){for(const[n,r]of Object.entries(e)){const u=t==null?void 0:t[n];u&&r&&typeof u=="object"&&typeof r=="object"?O(u,r):t[n]=r}Object.keys(t).reverse().forEach(n=>{e.hasOwnProperty(n)||(Array.isArray(e)?t.splice(n,1):delete t[n])})}function K(t,e,n=new WeakMap){const r=u=>{if(Array.isArray(u))return u.map(r);if(typeof u=="object"&&u!==null){if(n.has(u))return"[Circular]";n.set(u,!0);const s=Object.keys(u).sort(),l={};return s.forEach(i=>{l[i]=r(u[i])}),n.delete(u),l}else return u};return JSON.stringify(r(t))===JSON.stringify(r(e))}const g=(t,e)=>a.defineAsyncComponent({loader:t,loadingComponent:e,delay:80});function U(t,e){var r;const n=[{type:"root",children:t}];for(;n.length>0;){const u=n.pop(),s=u==null?void 0:u.children;if(s!=null)for(let l=0;l<s.length;l++){if(s[l].id===e)return{list:(r=u==null?void 0:u.children)!=null?r:[],schema:s[l],index:l};n.push(...s)}}throw new Error(`\u6CA1\u6709\u67E5\u8BE2\u5230id\u4E3A${e}\u7684\u8282\u70B9`)}function V(t,e){const n=[];let r=!1;function u(s){if(n.push(s),s.id===e&&(r=!0),!r&&s.children!=null&&s.children.length>0)for(let l=0;l<s.children.length&&(u(s.children[l]),!r);l++);r||n.pop()}return t.forEach(u),r||console.error(`\u6CA1\u6709\u67E5\u8BE2\u5230id\u4E3A${e}\u7684\u8282\u70B9`),n}function J(t,e){const n=t.split(".");let r=e;for(let u=0;u<n.length;u++)if(r=r[n[u]],r==null&&r!==!1&&r!==0)return;return r}function z(t,e,n){const r=e.split(".");let u=n;r.forEach((s,l)=>{var i;if(l===r.length-1){u[s]=t;return}u=(i=u[s])!=null?i:u[s]={}})}class P{constructor(){v(this,"components",{});v(this,"componentConfigs",{});v(this,"schemaGroup",[]);v(this,"schemaGroupList",a.ref([]));v(this,"viewsContainers",{activitybars:[],rightSidebars:[]});v(this,"publicMethods",{test:{describe:"\u6D4B\u8BD5\u51FD\u6570",methodName:"test",method:()=>{alert("\u6D4B\u8BD5\u51FD\u6570\u5F39\u51FA")}}})}component(e,n){typeof n=="function"&&(n=g(n)),this.components[e]=n}registerComponent(e){this.component(e.defaultSchema.type,e.component),this.componentConfigs[e.defaultSchema.type]=e}getComponents(){return this.components}getComponent(e){return this.components[e]}registerActivitybar(e){typeof e.component=="function"&&(e.component=g(e.component));const n=this.viewsContainers.activitybars.findIndex(r=>r.id===e.id);n!==-1?this.viewsContainers.activitybars[n]=e:this.viewsContainers.activitybars.push(e)}getActivitybars(){return this.viewsContainers.activitybars}registerRightSidebar(e){typeof e.component=="function"&&(e.component=g(e.component));const n=this.viewsContainers.rightSidebars.findIndex(r=>r.id===e.id);n!==-1?this.viewsContainers.rightSidebars[n]=e:this.viewsContainers.rightSidebars.push(e)}getRightSidebars(){return this.viewsContainers.rightSidebars}getComponentConfings(){return this.componentConfigs}getComponentConfingByType(e){return this.componentConfigs[e]}setSchemaGroup(e){this.schemaGroup=e,this.computedSchemaGroupList()}addSchemaGroup(e){this.schemaGroup.push(e),this.computedSchemaGroupList()}computedSchemaGroupList(){const e=this.schemaGroup.map(n=>{const r=n.list.map(u=>{var l;const s=(l=this.componentConfigs[u])==null?void 0:l.defaultSchema;return s==null?(console.warn(`${u} \u7EC4\u4EF6\u672A\u6CE8\u518C\u5230pluginManager\u4E2D`),!1):{...s,id:m()}}).filter(u=>u);return{...n,list:r}});this.schemaGroupList.value=e}getSchemaByGroup(){return this.schemaGroupList}addPublicMethod(e){this.publicMethods[e.methodName]=e}}const C=new P;function F(){const t=a.ref({}),e=a.ref({});function n(c){return t.value[c]}function r(c,p){t.value[c]=p}function u(c){delete t.value[c]}function s(c){const p=Object.entries(C.publicMethods).reduce((f,[d,h])=>(f[d]=h.method,f),{});new Function(`${c}`).bind({getComponent:n,defineExpose:l,...p})()}function l(c){c!=null&&(e.value=c)}function i(c,...p){c==null||c.forEach(f=>{var d,h,y;if(f.type==="public"&&((d=C.publicMethods[f.methodName])==null||d.method(f.args)),f.type==="custom"&&((y=(h=e.value)[f.methodName])==null||y.call(h,...p)),f.type==="component"){(f.componentId!=null&&n(f.componentId))[f.methodName](...p);return}})}return{componentInstances:t,funcs:e,getComponentInstance:n,addComponentInstance:r,removeComponentInstance:u,setMethods:s,doActions:i}}function Q(){const t=a.ref([]),e=a.ref([]),n=a.ref(null);let r=0;function u(i,c="\u63D2\u5165\u7EC4\u4EF6"){const p=Date.now();r+150>p||(r=p,n.value!=null&&(t.value.push(n.value),e.value.splice(0,e.value.length)),n.value={type:c,record:JSON.stringify(i)},t.value.length>20&&t.value.unshift())}function s(){if(t.value.length===0)return!1;const i=t.value.pop();return n.value!=null&&e.value.push(n.value),n.value=i,JSON.parse(i.record)}function l(){if(e.value.length===0)return!1;const i=e.value.pop();return n.value!=null&&t.value.push(n.value),n.value=i,JSON.parse(i.record)}return{recordList:t,undoList:e,currentRecord:n,push:u,undo:s,redo:l}}const R=Q();function M(t){return a.getCurrentScope()?(a.onScopeDispose(t),!0):!1}function _(t){let e=0,n,r;const u=()=>{e-=1,r&&e<=0&&(r.stop(),n=void 0,r=void 0)};return(...s)=>(e+=1,n||(r=a.effectScope(!0),n=r.run(()=>t(...s))),M(u),n)}function w(t){return typeof t=="function"?t():a.unref(t)}const W=typeof window<"u",q=()=>{};function X(t){var e;const n=w(t);return(e=n==null?void 0:n.$el)!=null?e:n}const I=W?window:void 0;function Y(...t){let e,n,r,u;if(typeof t[0]=="string"||Array.isArray(t[0])?([n,r,u]=t,e=I):[e,n,r,u]=t,!e)return q;Array.isArray(n)||(n=[n]),Array.isArray(r)||(r=[r]);const s=[],l=()=>{s.forEach(f=>f()),s.length=0},i=(f,d,h,y)=>(f.addEventListener(d,h,y),()=>f.removeEventListener(d,h,y)),c=a.watch(()=>[X(e),w(u)],([f,d])=>{l(),f&&s.push(...n.flatMap(h=>r.map(y=>i(f,h,y,d))))},{immediate:!0,flush:"post"}),p=()=>{c(),l()};return M(p),p}var Z=Object.defineProperty,H=Object.defineProperties,x=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable,L=(t,e,n)=>e in t?Z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$=(t,e)=>{for(var n in e||(e={}))j.call(e,n)&&L(t,n,e[n]);if(N)for(var n of N(e))ee.call(e,n)&&L(t,n,e[n]);return t},T=(t,e)=>H(t,x(e));function te(t){return typeof t=="function"?t:typeof t=="string"?e=>e.key===t:Array.isArray(t)?e=>t.includes(e.key):()=>!0}function B(...t){let e,n,r={};t.length===3?(e=t[0],n=t[1],r=t[2]):t.length===2?typeof t[1]=="object"?(e=!0,n=t[0],r=t[1]):(e=t[0],n=t[1]):(e=!0,n=t[0]);const{target:u=I,eventName:s="keydown",passive:l=!1,dedupe:i=!1}=r,c=te(e);return Y(u,s,f=>{f.repeat&&w(i)||c(f)&&n(f)},l)}function E(t,e,n={}){return B(t,e,T($({},n),{eventName:"keydown"}))}function A(t,e,n={}){return B(t,e,T($({},n),{eventName:"keyup"}))}function ne(){const t=a.ref(!1),e=a.ref(!1),n=a.ref(!1);return E(" ",r=>{var u=r.target;["INPUT","TEXTAREA"].includes(u.tagName)||r.preventDefault(),t.value=!0}),A(" ",()=>{t.value=!1}),E("Shift",r=>{r.preventDefault(),e.value=!0}),A("Shift",()=>{e.value=!1}),E("Control",r=>{r.preventDefault(),n.value=!0}),A("Control",()=>{n.value=!1}),{pressSpace:t,pressShift:e,pressCtrl:n}}function G(){return{canvasScale:a.ref(1)}}const b=_(G),D=_(ne);function re(t){const{pressSpace:e}=D();let n=0,r=0;function u(i){var c;n=i.x,r=i.y,(c=i.dataTransfer)==null||c.setDragImage(document.createElement("div"),0,0)}function s(i){if(i.preventDefault(),!i.x||!i.y||!e.value)return;const c=i.x-n,p=i.y-r;n=i.x,r=i.y,t.value&&(t.value.scrollTop-=p,t.value.scrollLeft-=c)}function l(){e.value=!1}return{handleElementDragStart:u,handleElementDrag:s,handleElementDragEnd:l}}function ue(t){const{pressCtrl:e}=D(),{canvasScale:n}=b();function r(u){if(!e.value)return;u.preventDefault();let s=0;u.deltaY<0?s=n.value+.05:s=n.value-.05,!(s>2||s<.2)&&(n.value=s)}return a.watch(()=>n.value,u=>{t.value&&(t.value.style.transform=`scale(${u})`)}),{handleZoom:r,canvasScale:n}}function se(t,e=16.66){let n;function r(){u(),n=window.setInterval(t,e)}function u(){window.clearInterval(n)}return{startTimedQuery:r,stopTimedQuery:u}}o.PluginManager=P,o.capitalizeFirstLetter=k,o.deepClone=S,o.deepCompareAndModify=O,o.deepEqual=K,o.findSchemaById=U,o.getAttributeValue=J,o.getMatchedById=V,o.getUUID=m,o.loadAsyncComponent=g,o.pluginManager=C,o.revoke=R,o.setAttributeValue=z,o.useElementDrag=re,o.useElementZoom=ue,o.usePageManager=F,o.useShareKeyPress=D,o.useShareStore=b,o.useStore=G,o.useTimedQuery=se,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
