(function(t,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(t=typeof globalThis<"u"?globalThis:t||self,e(t["k-form-design"]={},t.Vue))})(this,function(t,e){"use strict";var S=Object.defineProperty;var F=(t,e,d)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:d}):t[e]=d;var y=(t,e,d)=>(F(t,typeof e!="symbol"?e+"":e,d),d);class d{constructor(){y(this,"components",{})}addComponent(c,l,f="value"){this.components[c]={component:l,bindModel:f},console.log(this.components)}getComponents(){return this.components}getComponent(c){return this.components[c]}}const u=new d,C=e.defineComponent({__name:"KNode",props:{record:{type:Object,require:!0},model:{type:Object},modelValue:{}},emits:["update:modelValue"],setup(p,{emit:c}){const l=p,{component:f}=u.getComponent("FormItem"),{record:o}=l;console.log(o,0x650e124ef1c7);const g=u.getComponent(o.component);let s=e.shallowRef(null),m=e.shallowRef(null);async function _(){var a;console.time();const{bindModel:n,component:i}=g;if(typeof i=="function"){const r=await i();s.value=(a=r.default)!=null?a:r,console.log(s.value)}else s.value=i;m.value={record:o,...o.componentProps,is:s,style:"width: 100%;",[n]:l.modelValue,[`onUpdate:${n}`]:h},console.timeEnd()}function h(n){c("update:modelValue",n)}return e.onMounted(()=>{m.defaultValue&&h(m.defaultValue)}),_(),(n,i)=>{const a=e.resolveComponent("KNode",!0);return e.unref(s)&&!e.unref(o).noInput?(e.openBlock(),e.createBlock(e.unref(f),e.mergeProps({key:0},e.unref(o),{name:e.unref(o).field}),{default:e.withCtx(()=>[e.renderSlot(n.$slots,e.unref(o).slot,{value:l.modelValue,model:l.model,record:e.unref(o)},()=>[e.createVNode(e.unref(s),e.normalizeProps(e.guardReactiveProps(e.unref(m))),{node:e.withCtx(r=>[e.createVNode(a,e.normalizeProps(e.guardReactiveProps(r)),null,16)]),_:1},16)])]),_:3},16,["name"])):e.unref(s)?e.renderSlot(n.$slots,e.unref(o).slot,{key:1,value:l.modelValue,model:l.model,record:e.unref(o)},()=>[e.createVNode(e.unref(s),e.normalizeProps(e.guardReactiveProps(e.unref(m))),{node:e.withCtx(r=>[e.createVNode(a,e.normalizeProps(e.guardReactiveProps(r)),null,16)]),_:1},16)]):e.createCommentVNode("",!0)}}}),P=e.defineComponent({__name:"KFormBuild",props:{formSchema:{type:Object}},setup(p,{expose:c}){const l=p,{component:f}=u.getComponent("Form");let o=e.reactive({});const g=e.ref(null),s=e.computed(()=>{var n;return{...(n=l.formSchema)==null?void 0:n.config}});function m(){return new Promise(async(n,i)=>{var a;try{await((a=g.value)==null?void 0:a.validateFields()),n(o)}catch(r){i(r)}})}function _(n){Object.assign(o,n)}function h(n){return n||""}return c({getData:m,setData:_}),(n,i)=>(e.openBlock(),e.createBlock(e.unref(f),e.mergeProps({ref_key:"form",ref:g,model:e.unref(o)},e.unref(s)),{default:e.withCtx(()=>{var a;return[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((a=l.formSchema)==null?void 0:a.nodes,(r,B)=>(e.openBlock(),e.createBlock(C,{modelValue:e.unref(o)[r.field],"onUpdate:modelValue":V=>e.unref(o)[r.field]=V,model:e.unref(o),key:B,record:r},e.createSlots({_:2},[r.slot?{name:h(r.slot),fn:e.withCtx(V=>[e.renderSlot(n.$slots,r.slot,e.normalizeProps(e.guardReactiveProps(V||{})))]),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue","model","record"]))),128))]}),_:3},16,["model"]))}}),k=[P],w={install(p){k.forEach(c=>{p.component(c.__name,c)})}};t.KFormBuild=P,t.default=w,t.pluginManager=u,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
