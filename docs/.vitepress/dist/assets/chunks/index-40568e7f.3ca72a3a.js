import{e as S,r as E,f as w,w as G,o as r,c as f,d as x,s as K,N as U,Y as R,u as y,k as L,h as Y,x as $,b as u,n as D,P as B,t as A,E as F,F as J,$ as P,G as Z,O as q}from"../app.c22c6c8c.js";import{M as O,x as H,b as T,C as Q}from"./index.0d7c8eb8.js";import{p as j}from"./icon.vue_vue_type_script_setup_true_lang-cc078b52.fc49277e.js";import{R as W}from"./vuedraggable.umd-6a5b6da9.404cbac1.js";import{Z as X}from"./tree.vue_vue_type_script_setup_true_lang-4d79a980.c8619c93.js";import"./commonjsHelpers-c5d32002.490f5bf3.js";const ee={class:"event-info"},te=["title"],ae={class:"event-btn"},le={class:"epic-action-editor-main"},ne={class:"epic-editor-item"},oe={class:"w-36px text-lg"},ie={class:"flex-1"},ce={key:0},se={key:1},ue={key:2},de={class:"opr-box"},me=["onClick"],pe=["onClick"],ve=S({__name:"EActionEditorItem",props:{itemEvents:{type:Array,default:()=>[]},allEvents:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>[]},events:{type:Object,default:()=>({})}},emits:["add","edit","update:modelValue"],setup(k,{emit:I}){const p=k,C=L("pageSchema");function h(i){I("add",i)}function b(i){return T(C.schemas,i).label}function v(i,m){var n;const e=a(m);e[m]=p.events[m].filter((N,_)=>i!==_),(n=e[m])!=null&&n.length||delete e[m],I("update:modelValue",e)}function d(i,m,n){I("edit",i,m,n)}function a(i){const m={};return p.allEvents.forEach(n=>{if(!p.events[n.type].length||n.type===i)return!1;m[n.type]=p.events[n.type]}),m}return(i,m)=>(r(!0),f(U,null,R(k.itemEvents,n=>(r(),f("div",{key:n.type,class:"event-item"},[u("div",ee,[u("div",{class:"event-label",title:n.describe},A(n.describe),9,te),u("div",ae,[x(y(j),{name:"icon-tianjia1",onClick:e=>h(n.type)},null,8,["onClick"])])]),u("div",le,[x(y(W),{modelValue:p.events[n.type],"onUpdate:modelValue":e=>p.events[n.type]=e,"item-key":"id","component-data":{type:"transition-group"},group:"option-list",handle:".handle",animation:200},{item:K(({element:e,index:N})=>[u("div",ne,[u("div",oe,[x(y(j),{class:"mr-2 text-lg cursor-move handle",name:"icon-tuozhuai"})]),u("div",ie,[e.type==="component"?(r(),f("div",ce,A(b(e.componentId)),1)):e.type==="custom"?(r(),f("div",se," \u81EA\u5B9A\u4E49\u51FD\u6570 ")):e.type==="public"?(r(),f("div",ue," \u516C\u5171\u51FD\u6570 ")):Z("",!0),B(" "+A(e.methodName),1)]),u("div",de,[u("div",{class:"edit-btn",onClick:_=>d(N,n.type,e)},[x(y(j),{name:"icon-tiaozheng"})],8,me),u("div",{class:"del-btn",onClick:_=>v(N,n.type)},[x(y(j),{name:"icon-shanchu1"})],8,pe)])])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]))),128))}}),re={class:"h-full flex flex-col"},fe=u("div",{class:"pb-2"}," \u81EA\u5B9A\u4E49\u51FD\u6570\u7F16\u8F91 ",-1),ye=S({__name:"EScriptEdit",setup(k){const I=O.getComponent("monacoEditor"),p={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1}},C=E(null),h=L("pageSchema");return(b,v)=>(r(),f("div",re,[fe,x(y(I),{ref_key:"monacoEditorRef",ref:C,modelValue:y(h).script,"onUpdate:modelValue":v[0]||(v[0]=d=>y(h).script=d),class:"editor flex-1",config:p,language:"javascript"},null,8,["modelValue"])]))}}),he={class:"epic-attribute-view"},ge=["title"],Ie={class:"attr-input"},be=S({__name:"EArgsEditor",props:{modelValue:{},actionArgsConfigs:{}},emits:["update:modelValue"],setup(k,{emit:I}){const p=k,C=w(()=>p.modelValue?JSON.parse(p.modelValue):[]);function h(v){var d;return typeof v.show=="boolean"?v.show:typeof v.show=="function"?(d=v.show)==null?void 0:d.call(v,{values:C.value}):!0}function b(v,d){var i;const a=[...JSON.parse((i=p.modelValue)!=null?i:"[]")];a[d]=v,I("update:modelValue",JSON.stringify(a))}return(v,d)=>(r(),f("aside",he,[(r(!0),f(U,null,R(p.actionArgsConfigs,a=>(r(),f("div",{key:a.field+a.type},[F(u("div",{class:D(["attr-item",a.layout])},[u("div",{class:"attr-label",title:a.label},A(a.label),9,ge),u("div",Ie,[x(y(H),{record:{...a,componentProps:{...a.componentProps,input:!1,field:void 0,hidden:!1},show:!0,noFormItem:!0},"model-value":C.value[a.field],"onUpdate:modelValue":i=>b(i,a.field)},null,8,["record","model-value","onUpdate:modelValue"])])],2),[[J,h(a)]])]))),128))]))}}),xe={class:"rounded bg-white epic-modal-action-main"},Ce={class:"epic-modal-left-panel h-full flex flex-col"},Ve={class:"flex-1"},ke={class:"h-360px overflow-auto"},Ee={class:"epic-action-select h-240px flex flex-col"},Ne=u("div",{class:"mb-2"},"\u52A8\u4F5C\u9009\u62E9",-1),_e={class:"flex-1 overflow-auto"},we=["onClick"],Oe={class:"text-center pt-42px text-gray-400"},Ae={class:"epic-modal-right-panel"},Ue={key:1,class:"text-center pt-42px text-gray-400"},Se=S({__name:"EActionModal",emits:["add","edit"],setup(k,{expose:I,emit:p}){const C=O.getComponent("modal"),h=E(!0),b=L("pageSchema"),v=L("pageManager",{}),d=E(!1),a=E([]),i=E(null),m=w(()=>{var l;return e.actionItem.type==="component"?i.value?(l=O.getComponentConfings()[i.value.type].config.action)==null?void 0:l.map(t=>({label:t.describe,value:t.type})):[]:e.actionItem.type==="custom"?Object.entries(v.funcs.value).filter(([t,V])=>typeof V=="function").map(([t])=>({label:t,value:t})):e.actionItem.type==="public"?Object.entries(O.publicMethods).map(([t])=>({label:t,value:t})):[]}),n=w(()=>{var l;if(e.actionItem.type==="component"&&i.value){console.log();const t=O.getComponentConfings()[i.value.type].config.action,V=t==null?void 0:t.find(g=>g.type===e.actionItem.methodName);return(l=V==null?void 0:V.argsConfigs)!=null?l:[]}return[]}),e=Y({actionItem:{type:"custom",methodName:"test",componentId:null},cacheData:{}});function N(){var l;d.value=!0,h.value=!0,e.actionItem.type="custom",e.actionItem.componentId=null,(l=m.value)!=null&&l.length&&s(m.value[0].value)}function _(l){if(d.value=!0,h.value=!1,i.value=null,l.componentId){const t=T(b.schemas,l.componentId);i.value=t,a.value=[l.componentId]}q(()=>{e.actionItem.componentId=l.componentId,e.actionItem.methodName=l.methodName,e.actionItem.type=l.type,e.actionItem.args=l.args})}function z(){if(!e.actionItem.methodName){alert("\u8BF7\u5148\u9009\u62E9\u52A8\u4F5C\u65B9\u6CD5");return}p(h.value?"add":"edit",Q(P(e.actionItem))),M()}function M(){d.value=!1,a.value=[],e.cacheData={}}function c(l){var t;e.actionItem.componentId=null,e.actionItem.type=l,i.value=null,e.actionItem.methodName=null,a.value=[],(t=m.value)!=null&&t.length&&s(m.value[0].value)}function o(l){var t;e.actionItem.args&&(e.cacheData[e.actionItem.componentId+e.actionItem.methodName]=e.actionItem.args),e.actionItem.componentId=l.id,e.actionItem.type="component",e.actionItem.methodName=null,i.value=l.record,(t=m.value)!=null&&t.length&&s(m.value[0].value)}function s(l){e.actionItem.methodName=l,e.actionItem.args=e.cacheData[e.actionItem.componentId+e.actionItem.methodName]}return I({handleOpen:N,handleOpenEdit:_}),(l,t)=>(r(),$(y(C),{modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=V=>d.value=V),class:"w-1200px",width:"1200px",onClose:M,onOk:z,title:"\u52A8\u4F5C\u914D\u7F6E"},{default:K(()=>{var V;return[u("div",xe,[u("div",Ce,[u("div",Ve,[u("div",{class:D(["fun-btn",{checked:e.actionItem.type==="custom"}]),onClick:t[0]||(t[0]=g=>c("custom"))}," \u81EA\u5B9A\u4E49\u51FD\u6570 ",2),u("div",{class:D(["fun-btn",{checked:e.actionItem.type==="public"}]),onClick:t[1]||(t[1]=g=>c("public"))}," \u516C\u5171\u51FD\u6570 ",2),B(" \u7EC4\u4EF6 "),u("div",ke,[x(y(X),{selectedKeys:a.value,"onUpdate:selectedKeys":t[2]||(t[2]=g=>a.value=g),options:y(b).schemas,onNodeClick:o},null,8,["selectedKeys","options"])])]),u("div",Ee,[Ne,u("div",_e,[(r(!0),f(U,null,R(m.value,g=>(r(),f("div",{class:D([{checked:g.value===e.actionItem.methodName},"action-item"]),onClick:Me=>s(g.value),key:g.value},[u("span",null,A(g.label),1)],10,we))),128)),F(u("div",Oe,"\u5F53\u524D\u7EC4\u4EF6\u6682\u65E0\u52A8\u4F5C",512),[[J,!((V=m.value)!=null&&V.length)]])])])]),u("div",Ae,[e.actionItem.type==="custom"?(r(),$(ye,{key:0})):n.value.length===0?(r(),f("div",Ue,"\u6682\u65E0\u914D\u7F6E")):(r(),$(be,{key:2,modelValue:e.actionItem.args,"onUpdate:modelValue":t[3]||(t[3]=g=>e.actionItem.args=g),actionArgsConfigs:n.value},null,8,["modelValue","actionArgsConfigs"]))])])]}),_:1},8,["modelValue"]))}}),ze=S({__name:"index",props:{eventList:{type:Array,default:()=>[]},modelValue:{type:Object}},emits:["update:modelValue"],setup(k,{emit:I}){const p=k,C=O.getComponent("Collapse"),h=O.getComponent("CollapseItem"),b=E(null);let v=0;const d=w({get(){return p.modelValue},set(c){I("update:modelValue",c)}}),a=E(["\u7EC4\u4EF6\u4E8B\u4EF6"]),i=w(()=>p.eventList.filter(c=>c.events.length));G(()=>i.value,c=>{c.length&&(a.value=c[0].title)},{immediate:!0});const m=w(()=>p.eventList.map(c=>c.events).flat()),n=E({});m.value.forEach(c=>{n.value[c.type]=w({get(){var s;var o;return(s=(o=d.value)==null?void 0:o[c.type])!=null?s:[]},set(o){o&&o.length?d.value[c.type]=o.map(s=>P(s)):delete d.value[c.type]}})});let e="";function N(c){var o;(o=b.value)==null||o.handleOpen(),e=c}function _(c,o,s){var l;(l=b.value)==null||l.handleOpenEdit(s),v=c,e=o}function z(c){var o;n.value[e][v]=c,d.value[e]=[...(o=n.value[e])!=null?o:[]]}function M(c){var o,s;if(!d.value){d.value={[e]:[...(o=n.value[e])!=null?o:[],c]};return}d.value[e]=[...(s=n.value[e])!=null?s:[],c]}return(c,o)=>(r(),f(U,null,[x(y(C),{modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=s=>a.value=s),activeEey:a.value,"onUpdate:activeEey":o[2]||(o[2]=s=>a.value=s),"expanded-names":a.value,"onUpdate:expandedNames":o[3]||(o[3]=s=>a.value=s)},{default:K(()=>[(r(!0),f(U,null,R(i.value,s=>(r(),$(y(h),{key:s.title,title:s.title,header:s.title,name:s.title},{default:K(()=>[x(ve,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=l=>d.value=l),"item-events":s.events,"all-events":m.value,events:n.value,onAdd:N,onEdit:_},null,8,["modelValue","item-events","all-events","events"])]),_:2},1032,["title","header","name"]))),128))]),_:1},8,["modelValue","activeEey","expanded-names"]),x(Se,{ref_key:"EActionModalRef",ref:b,onAdd:M,onEdit:z},null,512)],64))}});export{ze as default};
