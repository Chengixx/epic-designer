import{i as W,k as B,m as J,o as T,c as A,e as $,v as te,d as x,O as ae,r as k,w as P,b as ge,P as se,Q as ue,u as r,N as be,G as K,F as G,l as ke,p as we,n as Ce,q as Ne,t as ee,R as Se,E as ce,C as xe,s as _e,H as he,B as Re,y as Ee,T as pe}from"../app.b200646e.js";import{O as de,Y as F,M as re,A as Te,r as Ie,n as Ve,o as $e,t as Oe,s as Be,X as fe,J as je,T as z,h as ie,e as Ue}from"./index.0d4f5749.js";import{m as oe}from"./icon.vue_vue_type_script_setup_true_lang-3f9e4127.6b0b97e0.js";import{R as De}from"./vuedraggable.umd-95bb1123.93b8ed8d.js";const Le={class:"action-item whitespace-nowrap"},Ae=W({__name:"previewWidgets",setup(M){const C=B("pageManager",{}),h=B("pageSchema"),l=B("designer"),w=k(null),o=k(null),i=k(null),y=k(!1),S=k(!1),_=k(!0),n=k("top"),{canvasScale:d,disabledZoom:c}=de();let u=null;const m=J(()=>{var U;var a,v,p,E,g;const f=C.componentInstances.value,N=(a=l.state.checkedNode)==null?void 0:a.id,b=(U=F.getComponentConfingByType((v=l.state.checkedNode)==null?void 0:v.type))!=null?U:null;if(!N||!(f!=null&&f[N]))return null;if(b!=null&&b.defaultSchema.input&&((p=l.state.checkedNode)==null?void 0:p.noFormItem)!==!0)return(E=f[N+"formItem"])==null?void 0:E.$el;const V=f[N];return((g=V==null?void 0:V.$el)==null?void 0:g.nodeName)==="#text"?null:V==null?void 0:V.$el}),R=J(()=>{var V;var a,v,p,E;const g=C.componentInstances.value,f=(a=l.state.hoverNode)==null?void 0:a.id,N=(V=F.getComponentConfingByType((v=l.state.hoverNode)==null?void 0:v.type))!=null?V:null;if(!f||!(g!=null&&g[f]))return null;if(N!=null&&N.defaultSchema.input&&((p=l.state.hoverNode)==null?void 0:p.noFormItem)!==!0)return(E=g[f+"formItem"])==null?void 0:E.$el;const b=g[f];return(b==null?void 0:b.$el.nodeName)==="#text"?null:b==null?void 0:b.$el}),{mutationObserver:j,observerConfig:D}=e(L),{startTimedQuery:O,stopTimedQuery:I}=Be(L);P(()=>m.value,a=>{if(a){y.value=!0,j.observe(a,D);const v=a.parentNode;v&&(v.ondragstart=()=>{_.value=!1,O()},v.ondragend=()=>{_.value=!0,I()}),L()}else y.value=!1});const{mutationObserver:Q,observerConfig:X}=e(t);P(()=>R.value,a=>{a&&(Q.observe(a,X),t())});let H=0;P(()=>{var a;return(a=l.state.hoverNode)==null?void 0:a.id},a=>{if(a){S.value=!0,clearTimeout(H);return}H=setTimeout(()=>{S.value=!1},300)});function L(){var ne,q,Y;const a=m.value;if(!a)return;const{top:v,left:p}=(ne=u==null?void 0:u.getBoundingClientRect())!=null?ne:{top:0,left:0},{top:E,left:g,width:f,height:N}=a.getBoundingClientRect(),b=c.value?1:d.value,V=E-v+((q=u==null?void 0:u.scrollTop)!=null?q:0)*b,U=g-p+((Y=u==null?void 0:u.scrollLeft)!=null?Y:0)*b,le=N/b;w.value&&(w.value.style.width=`${f/b}px`,w.value.style.height=`${le}px`,w.value.style.top=`${V/b}px`,w.value.style.left=`${U/b}px`),i.value&&(V<45&&le<100?(i.value.style.top="",i.value.style.bottom="-30px",i.value.style["border-radius"]="0px 0px 4px 4px",n.value="bottom"):V<45?(i.value.style.top="0px",i.value.style["border-radius"]="0px 0px 4px 0",n.value="center"):(i.value.style.top="-30px",i.value.style["border-radius"]="4px 4px 0px 0px",n.value="top"))}function t(){var q,Y,ve,me;var a,v;const p=R.value;if(!p)return;const{top:E,left:g}=(q=u==null?void 0:u.getBoundingClientRect())!=null?q:{top:0,left:0},{top:f,left:N,width:b,height:V}=(Y=(a=p.getBoundingClientRect)==null?void 0:a.call(p))!=null?Y:(v=p.nextElementSibling)==null?void 0:v.getBoundingClientRect(),U=c.value?1:d.value,le=f-E+((ve=u==null?void 0:u.scrollTop)!=null?ve:0)*U,ne=N-g+((me=u==null?void 0:u.scrollLeft)!=null?me:0)*U;o.value&&(o.value.style.width=`${b/U}px`,o.value.style.height=`${V/U}px`,o.value.style.top=`${le/U}px`,o.value.style.left=`${ne/U}px`)}function e(a){const v=window.MutationObserver,p={childList:!0,attributes:!0,subtree:!0};return{mutationObserver:new v(a),observerConfig:p}}function s(){var N;var a;const v=fe(h.schemas,(N=(a=l.state.checkedNode)==null?void 0:a.id)!=null?N:"root");if(!v)return!1;const{list:p,schema:E,index:g}=v,f=je(E);p.splice(g+1,0,f),l.setCheckedNode(f),z.push(h.schemas,"\u590D\u5236\u7EC4\u4EF6")}function Z(){var f;var a;const v=fe(h.schemas,(f=(a=l.state.checkedNode)==null?void 0:a.id)!=null?f:"root");if(!v)return!1;let{list:p,schema:E,index:g}=v;p.splice(g,1),g===p.length&&g--,l.setCheckedNode(p[g]),z.push(h.schemas,"\u5220\u9664\u7EC4\u4EF6")}return ge(()=>{u=document.querySelector(".epic-edit-range"),u==null||u.addEventListener("scroll",()=>{L()}),re(m,L),re(R,L)}),(a,v)=>{var b;var p,E,g,f,N;return T(),A(G,null,[se(x("div",{ref_key:"selectorRef",ref:w,class:K(["checked-widget absolute pointer-events-none z-20",n.value+" "+(_.value?"transition-all":"")])},[x("div",{class:"action-box",ref_key:"actionBoxRef",ref:i},[x("div",Le,be((E=r(F).getComponentConfingByType((b=(p=r(l).state.checkedNode)==null?void 0:p.type)!=null?b:""))==null?void 0:E.defaultSchema.label),1),x("div",{title:"\u590D\u5236",class:"action-item pointer-events-auto",onClick:s},[$(r(oe),{name:"icon-fuzhi3"})]),x("div",{title:"\u5220\u9664",class:"action-item pointer-events-auto",onClick:Z},[$(r(oe),{name:"icon-shanchu1"})])],512)],2),[[ue,y.value&&((g=r(l).state.checkedNode)==null?void 0:g.id)!=="root"]]),se(x("div",{ref_key:"hoverWidgetRef",ref:o,class:"hover-widget absolute transition-all pointer-events-none z-998"},null,512),[[ue,S.value&&((f=r(l).state.checkedNode)==null?void 0:f.id)!==((N=r(l).state.hoverNode)==null?void 0:N.id)]])],64)}}}),Me=W({name:"EditNodeItem",__name:"editNodeItem",props:{schemas:{}},emits:["update:schemas"],setup(M,{emit:C}){const h=B("designer"),l=B("pageSchema"),w=M,o=C,i=J({get(){return w.schemas},set(n){o("update:schemas",n)}});function y(n){h.setCheckedNode(i.value[n]),h.setDisableHover(!0)}function S(){h.setDisableHover(),z.push(l.schemas,"\u62D6\u62FD\u7EC4\u4EF6")}function _(){z.push(l.schemas,"\u63D2\u5165\u7EC4\u4EF6")}return(n,d)=>(T(),ee(r(De),Ee({modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=c=>i.value=c),"item-key":"id","component-data":{type:"transition-group"},class:"draggable-range"},{animation:200,group:"edit-draggable",handle:".draggable-item",ghostClass:"moveing"},{onStart:d[1]||(d[1]=c=>y(c.oldIndex)),onEnd:d[2]||(d[2]=c=>S()),onAdd:d[3]||(d[3]=c=>{y(c.newIndex),_()})}),{item:te(({element:c,index:u})=>[(T(),A("div",{class:K(["widget-box",{"draggable-item":!c.immovable}]),key:u},[$(ye,{schema:c},null,8,["schema"])],2))]),_:1},16,["modelValue"]))}}),ye=W({name:"ENodeItem",__name:"nodeItem",props:{schema:{},name:{}},setup(M){const C=ke(),h=B("designer"),l=B("pageManager",{}),w=k(null);we("nodeAttrs",C);const o=M,i=J(()=>{var I;var n,d,c,u,m;const R=l.componentInstances.value,j=(n=o.schema)==null?void 0:n.id,D=(I=F.getComponentConfingByType((d=o.schema)==null?void 0:d.type))!=null?I:null;if(!j||!(R!=null&&R[j]))return null;if(D!=null&&D.defaultSchema.input&&((c=o.schema)==null?void 0:c.noFormItem)!==!0)return(u=R[j+"formItem"])==null?void 0:u.$el;const O=R[j];return((m=O==null?void 0:O.$el)==null?void 0:m.nodeName)==="#text"?null:O==null?void 0:O.$el});P(()=>i.value,n=>{n==null||n.addEventListener("click",y,!1),n==null||n.addEventListener("mouseover",S,!1),n==null||n.addEventListener("mouseout",_,!1)}),Ce(()=>{var n,d,c;(n=i.value)==null||n.removeEventListener("click",y,!1),(d=i.value)==null||d.removeEventListener("mouseover",S,!1),(c=i.value)==null||c.removeEventListener("mouseout",_,!1)});function y(n){n.stopPropagation(),h.setCheckedNode(o.schema)}function S(n){o.schema.type!=="page"&&(n.stopPropagation(),h.setHoverNode(o.schema))}function _(n){n.stopPropagation(),h.setHoverNode(null)}return(n,d)=>{var c;const u=Ne("ENodeItem");return T(),ee(r(Te),{ref_key:"nodeRef",ref:w,componentSchema:o.schema},Se({_:2},[(c=o.schema)!=null&&c.childImmovable?{name:"edit-node",fn:te(()=>[(T(!0),A(G,null,ce(o.schema.children,m=>(T(),ee(u,{key:m.id,schema:m},null,8,["schema"]))),128))]),key:"0"}:{name:"edit-node",fn:te(()=>[o.schema.children?(T(),ee(Me,{key:0,schemas:o.schema.children,"onUpdate:schemas":d[0]||(d[0]=m=>o.schema.children=m)},null,8,["schemas"])):xe("",!0)]),key:"1"}]),1032,["componentSchema"])}}}),He={class:"min-w-750px rounded bg-white h-full"},ze=W({__name:"previewJson",setup(M,{expose:C}){const h=F.getComponent("modal"),l=F.getComponent("monacoEditor"),w={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1},readOnly:!0},o=k(null),i=k(!1),y=B("pageSchema");function S(){i.value=!1}function _(){i.value=!0,o.value?o.value.setValue(JSON.stringify(y,null,2)):setTimeout(()=>{_()},300)}function n(d="epic-data.json"){let c="data:text/json;charset=utf-8,";c+=JSON.stringify(y,null,2);var u=encodeURI(c),m=document.createElement("a");m.setAttribute("href",u),m.setAttribute("download",d),m.click()}return C({handleOpen:_}),(d,c)=>(T(),ee(r(h),{modelValue:i.value,"onUpdate:modelValue":c[0]||(c[0]=u=>i.value=u),title:"\u67E5\u770B\u6570\u636E",class:"w-900px",width:"900px",onClose:S,onOk:n,okText:"\u5BFC\u51FA\u6570\u636E"},{default:te(()=>[x("div",He,[$(r(l),{ref_key:"monacoEditorRef",ref:o,class:"editor h-full",config:w,language:"json"},null,512)])]),_:1},8,["modelValue"]))}}),Fe={class:"edit-toolbar flex items-center justify-between px-4 mx-1"},Je={class:"flex-1 h-full flex items-center"},Ze=["title","onClick"],Pe={class:"flex-1 h-full flex items-center justify-center"},We=["title","onClick"],Xe={class:"flex-1 h-full flex items-center justify-end"},Ke={key:0,class:"flex items-center ml-12px"},Qe={class:"pr-8px w-82px cursor-pointer"},qe={class:"w-90px cursor-pointer"},Ye=W({__name:"toolbar",setup(M){const C=F.getComponent("slider"),h=F.getComponent("select"),{canvasScale:l,disabledZoom:w}=de(),o=k("pc"),i=B("pageSchema"),y=B("designer"),S=k(null),_=[{icon:"icon-a-diannaotoubu",title:"pc",key:"pc"},{icon:"icon-a-pingbantoubu",title:"\u5E73\u677F",key:"pad"},{icon:"icon-a-shoujitoubu",title:"\u624B\u673A",key:"mobile"}],n=z.recordList,d=z.undoList,c=J(()=>[{icon:"icon-daima1",title:"\u67E5\u770B\u6570\u636E",on:()=>I()},{icon:"icon-shangchuan1",title:"\u5BFC\u5165\u6570\u636E",on:Q},{icon:"icon-shanchu1",title:"\u6E05\u7A7A",on:O},{icon:"icon-chexiao2x",title:"\u64A4\u9500",on:j,disabled:!n.value.length},{icon:"icon-fanhui2x",title:"\u91CD\u505A",on:D,disabled:!d.value.length}]),u=k(null),m=J({get(){return`${(l.value*100).toFixed(0)}%`},set(t){l.value=Number(t)}}),R=[{label:"60%",value:"0.6"},{label:"80%",value:"0.8"},{label:"100%",value:"1.0"},{label:"120%",value:"1.2"},{label:"140%",value:"1.4"}];function j(){const t=z.undo();t&&(ie(i.schemas,t),y.setCheckedNode(i.schemas[0]))}function D(){const t=z.redo();t&&(ie(i.schemas,t),y.setCheckedNode(i.schemas[0]))}function O(){y.reset()}function I(){S.value.handleOpen()}function Q(){var t;(t=u.value)==null||t.click()}function X(t){var e;const s=(e=t.target.files)==null?void 0:e[0];if(!s)return;t.target.value=null;const Z=new FileReader;Z.readAsText(s),Z.onload=a=>{var v;H((v=a.target)==null?void 0:v.result)}}function H(t){try{let e=JSON.parse(t!=null?t:"");e.schemas||(e=Ue(e)),ie(i,e)}catch(e){console.error(e)}}function L(t){o.value=t;const e={pc:{},pad:{width:"800px"},mobile:{width:"420px"}};i.canvas=e[t]}return(t,e)=>(T(),A(G,null,[x("div",Fe,[x("div",Je,[(T(!0),A(G,null,ce(c.value,(s,Z)=>(T(),A("div",{title:s.title,class:K(["action-item h-90% px-10px flex items-center hover:bg-gray-50 cursor-pointer",{disabled:s.disabled}]),key:Z,onClick:s.on},[$(r(oe),{name:s.icon},null,8,["name"])],10,Ze))),128))]),se(x("input",{type:"file",ref_key:"fileRef",ref:u,accept:".json,.txt",onChange:X},null,544),[[ue,!1]]),x("div",Pe,[(T(),A(G,null,ce(_,s=>x("div",{title:s.title,class:K(["device-item h-90% px-10px flex items-center hover:bg-gray-50 cursor-pointer",{checked:s.key===o.value}]),key:s.key,onClick:Z=>L(s.key)},[$(r(oe),{name:s.icon},null,8,["name"])],10,We)),64))]),x("div",Xe,[r(w)?xe("",!0):(T(),A("div",Ke,[x("div",Qe,[$(r(h),{value:m.value,"onUpdate:value":e[0]||(e[0]=s=>m.value=s),modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=s=>m.value=s),options:R,size:"small"},null,8,["value","modelValue"])]),x("div",qe,[$(r(C),{min:.6,max:1.4,step:.01,tooltip:!1,value:r(l),"onUpdate:value":e[2]||(e[2]=s=>pe(l)?l.value=s:null),modelValue:r(l),"onUpdate:modelValue":e[3]||(e[3]=s=>pe(l)?l.value=s:null)},null,8,["value","modelValue"])])]))])]),$(ze,{ref_key:"previewJson",ref:S},null,512)],64))}}),Ge={class:"h-full flex flex-col relative"},et=["draggable"],tt=W({__name:"editScreenContainer",setup(M){const C=B("pageSchema"),h=k(null),l=k(null),w=k(null),{pressSpace:o,disabledZoom:i}=de(),{handleElementDragStart:y,handleElementDrag:S,handleElementDragEnd:_}=Ie(h),{width:n,height:d}=Ve(h),{canvasScale:c,handleZoom:u}=$e(l);let m=0,R=0;const j=k({}),D=k({}),O=k({}),I=_e({width:0,height:0});P(()=>{var t,e;return{width:(t=C.canvas)==null?void 0:t.width,height:(e=C.canvas)==null?void 0:e.height}},X),P(O,()=>{he(Q)}),ge(()=>{var t,e;X({width:(t=C.canvas)==null?void 0:t.width,height:(e=C.canvas)==null?void 0:e.height})});function Q(){const t=r(w);t&&(I.value={width:t.clientWidth,height:t.clientHeight})}function X({width:t,height:e}){O.value={width:t!=null?t:"0",height:e!=null?e:"0"}}Oe(n,H),P(I,H);function H(){if(i.value){D.value={width:m+"px",height:R+"px",transform:"translate(0px, 20px)"};return}let t=I.value.width||m,e=I.value.height||R;j.value={width:n.value+t+"px",height:d.value+e+"px"},D.value={width:t+"px",height:e+"px"},L()}function L(){he(()=>{let t=I.value.width||m;const e=(I.value.height||R)/2,s=t/2;h.value.scrollTo(s,e)})}return re(h,([{contentRect:t}])=>{if(m=t.width-60,R=t.height-80,!i.value){const e=(t.width-20)/I.value.width;e<1.2&&(c.value=e)}H()}),(t,e)=>(T(),A("div",Ge,[$(Ye),x("div",{ref_key:"editScreenContainerRef",ref:h,class:K(["flex-1 overflow-auto overflow-y-hidden epic-edit-screen-container",{"cursor-grab":r(o)}]),draggable:r(o),onWheel:e[0]||(e[0]=(...s)=>r(u)&&r(u)(...s)),onDragstart:e[1]||(e[1]=(...s)=>r(y)&&r(y)(...s)),onDragend:e[2]||(e[2]=(...s)=>r(_)&&r(_)(...s)),onDrag:e[3]||(e[3]=(...s)=>r(S)&&r(S)(...s))},[x("div",{id:"canvasContainer",class:"flex items-center justify-center",style:ae(j.value)},[x("div",{ref_key:"draggableElRef",ref:l,class:"transition-all"},[x("div",{class:K({"pointer-events-none":r(o)}),style:ae(D.value)},[Re(t.$slots,"default")],6)],512)],4)],42,et),x("div",{ref_key:"sizeBoxRef",ref:w,class:"absolute op-0 pointer-events-none",style:ae(O.value)},null,4)]))}}),lt={class:"epic-edit-canvas"},st=W({__name:"index",setup(M){const C=B("pageSchema"),h=J(()=>C.schemas[0]),l=J(()=>({width:"100%",height:"100%"}));return(w,o)=>(T(),A("section",lt,[$(tt,null,{default:te(()=>[x("div",{class:"epic-edit-range rounded-md overflow-auto relative",style:ae(l.value)},[$(ye,{schema:h.value},null,8,["schema"]),$(Ae)],4)]),_:1})]))}});export{st as default};
