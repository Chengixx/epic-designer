import{i as P,r as b,k as D,m as U,b as ye,o as $,c as F,e as B,v as le,d as y,a3 as oe,w as A,aa as re,ab as ce,u as r,a4 as we,G,F as Y,l as Ce,p as Ne,n as Se,q as _e,t as ee,af as Re,E as de,C as be,s as Ie,H as fe,B as Ee,y as $e,ae as ge}from"../app.c1700df1.js";import{c8 as me,z as M,c9 as Ve,ca as Te,cb as Be,cc as je,cd as De,ce as ve,cf as Le,cg as xe,ch as Oe,ci as J,cj as ue,ck as Fe}from"./index.52d9511d.js";import{m as ie}from"./icon.vue_vue_type_script_setup_true_lang-3f9e4127.b898144b.js";import{R as He}from"./vuedraggable.umd-6a5b6da9.96e89de6.js";const Je={class:"action-item whitespace-nowrap"},Me=P({__name:"previewWidgets",setup(H,{expose:C}){const h=D("pageManager",{}),m=D("pageSchema"),d=D("designer"),a=b(null),o=b(null),v=b(null),S=b(!1),_=b(!1),n=b(!0),c=b("top"),{canvasScale:u,disabledZoom:k}=me();let t=null;const R=U(()=>{var L;var s,p,f,E,x;const g=h.componentInstances.value,N=(s=d.state.checkedNode)==null?void 0:s.id,w=(L=M.getComponentConfingByType((p=d.state.checkedNode)==null?void 0:p.type))!=null?L:null;if(!N||!(g!=null&&g[N]))return null;if(w!=null&&w.defaultSchema.input&&((f=d.state.checkedNode)==null?void 0:f.noFormItem)!==!0)return(E=g[N+"formItem"])==null?void 0:E.$el;const T=g[N];return((x=T==null?void 0:T.$el)==null?void 0:x.nodeName)==="#text"?null:T==null?void 0:T.$el}),V=U(()=>{var T;var s,p,f,E;const x=h.componentInstances.value,g=(s=d.state.hoverNode)==null?void 0:s.id,N=(T=M.getComponentConfingByType((p=d.state.hoverNode)==null?void 0:p.type))!=null?T:null;if(!g||!(x!=null&&x[g]))return null;if(N!=null&&N.defaultSchema.input&&((f=d.state.hoverNode)==null?void 0:f.noFormItem)!==!0)return(E=x[g+"formItem"])==null?void 0:E.$el;const w=x[g];return(w==null?void 0:w.$el.nodeName)==="#text"?null:w==null?void 0:w.$el}),{mutationObserver:O,observerConfig:j}=i(e),{startTimedQuery:I,stopTimedQuery:Q}=Le(e);A(()=>R.value,s=>{if(s){S.value=!0,O.observe(s,j);const p=s.parentNode;p&&(p.ondragstart=()=>{n.value=!1,I()},p.ondragend=()=>{n.value=!0,Q()}),e()}else S.value=!1});const{mutationObserver:W,observerConfig:z}=i(l);A(()=>V.value,s=>{s&&(W.observe(s,z),l())});let K=0;A(()=>{var s;return(s=d.state.hoverNode)==null?void 0:s.id},s=>{if(s){_.value=!0,clearTimeout(K);return}K=setTimeout(()=>{_.value=!1},300)});function e(){var ae,X,q;const s=R.value;if(!s)return;const{top:p,left:f}=(ae=t==null?void 0:t.getBoundingClientRect())!=null?ae:{top:0,left:0},{top:E,left:x,width:g,height:N}=s.getBoundingClientRect(),w=k.value?1:u.value,T=E-p+((X=t==null?void 0:t.scrollTop)!=null?X:0)*w,L=x-f+((q=t==null?void 0:t.scrollLeft)!=null?q:0)*w,ne=N/w;a.value&&(a.value.style.width=`${g/w}px`,a.value.style.height=`${ne}px`,a.value.style.top=`${T/w}px`,a.value.style.left=`${L/w}px`),v.value&&(T<45&&ne<100?(v.value.style.top="",v.value.style.bottom="-30px",v.value.style["border-radius"]="0px 0px 4px 4px",c.value="bottom"):T<45?(v.value.style.top="0px",v.value.style["border-radius"]="0px 0px 4px 0",c.value="center"):(v.value.style.top="-30px",v.value.style["border-radius"]="4px 4px 0px 0px",c.value="top"))}function l(){var X,q,he,pe;var s,p;const f=V.value;if(!f)return;const{top:E,left:x}=(X=t==null?void 0:t.getBoundingClientRect())!=null?X:{top:0,left:0},{top:g,left:N,width:w,height:T}=(q=(s=f.getBoundingClientRect)==null?void 0:s.call(f))!=null?q:(p=f.nextElementSibling)==null?void 0:p.getBoundingClientRect(),L=k.value?1:u.value,ne=g-E+((he=t==null?void 0:t.scrollTop)!=null?he:0)*L,ae=N-x+((pe=t==null?void 0:t.scrollLeft)!=null?pe:0)*L;o.value&&(o.value.style.width=`${w/L}px`,o.value.style.height=`${T/L}px`,o.value.style.top=`${ne/L}px`,o.value.style.left=`${ae/L}px`)}function i(s){const p=window.MutationObserver,f={childList:!0,attributes:!0,subtree:!0};return{mutationObserver:new p(s),observerConfig:f}}function Z(){var N;var s;const p=xe(m.schemas,(N=(s=d.state.checkedNode)==null?void 0:s.id)!=null?N:"root");if(!p)return!1;const{list:f,schema:E,index:x}=p,g=Oe(E);f.splice(x+1,0,g),d.setCheckedNode(g),J.push(m.schemas,"\u590D\u5236\u7EC4\u4EF6")}function se(){var g;var s;const p=xe(m.schemas,(g=(s=d.state.checkedNode)==null?void 0:s.id)!=null?g:"root");if(!p)return!1;let{list:f,schema:E,index:x}=p;f.splice(x,1),x===f.length&&x--,d.setCheckedNode(f[x]),J.push(m.schemas,"\u5220\u9664\u7EC4\u4EF6")}function te(s){t=s,t==null||t.addEventListener("scroll",()=>{e()}),ve(R,e),ve(V,e)}return C({handleInit:te}),(s,p)=>{var w;var f,E,x,g,N;return $(),F(Y,null,[re(y("div",{ref_key:"selectorRef",ref:a,class:G(["checked-widget absolute pointer-events-none z-20",c.value+" "+(n.value?"transition-all":"")])},[y("div",{class:"action-box",ref_key:"actionBoxRef",ref:v},[y("div",Je,we((E=r(M).getComponentConfingByType((w=(f=r(d).state.checkedNode)==null?void 0:f.type)!=null?w:""))==null?void 0:E.defaultSchema.label),1),y("div",{title:"\u590D\u5236",class:"action-item pointer-events-auto",onClick:Z},[B(r(ie),{name:"icon-fuzhi3"})]),y("div",{title:"\u5220\u9664",class:"action-item pointer-events-auto",onClick:se},[B(r(ie),{name:"icon-shanchu1"})])],512)],2),[[ce,S.value&&((x=r(d).state.checkedNode)==null?void 0:x.id)!=="root"]]),re(y("div",{ref_key:"hoverWidgetRef",ref:o,class:"hover-widget absolute transition-all pointer-events-none z-998"},null,512),[[ce,_.value&&((g=r(d).state.checkedNode)==null?void 0:g.id)!==((N=r(d).state.hoverNode)==null?void 0:N.id)]])],64)}}}),Ue=P({name:"EditNodeItem",__name:"editNodeItem",props:{schemas:{}},emits:["update:schemas"],setup(H,{emit:C}){const h=D("designer"),m=D("pageSchema"),d=H,a=C,o=U({get(){return d.schemas},set(n){a("update:schemas",n)}});function v(n){h.setCheckedNode(o.value[n]),h.setDisableHover(!0)}function S(){h.setDisableHover(),J.push(m.schemas,"\u62D6\u62FD\u7EC4\u4EF6")}function _(){J.push(m.schemas,"\u63D2\u5165\u7EC4\u4EF6")}return(n,c)=>($(),ee(r(He),$e({modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=u=>o.value=u),"item-key":"id","component-data":{type:"transition-group"},class:"draggable-range"},{animation:200,group:"edit-draggable",handle:".draggable-item",ghostClass:"moveing"},{onStart:c[1]||(c[1]=u=>v(u.oldIndex)),onEnd:c[2]||(c[2]=u=>S()),onAdd:c[3]||(c[3]=u=>{v(u.newIndex),_()})}),{item:le(({element:u,index:k})=>[($(),F("div",{class:G(["widget-box",{"draggable-item":!u.immovable}]),key:k},[B(ke,{schema:u},null,8,["schema"])],2))]),_:1},16,["modelValue"]))}}),ke=P({name:"ENodeItem",__name:"nodeItem",props:{schema:{},name:{}},setup(H){const C=Ce(),h=D("designer"),m=D("pageManager",{}),d=b(null);Ne("nodeAttrs",C);const a=H,o=U(()=>{var I;var n,c,u,k,t;const R=m.componentInstances.value,V=(n=a.schema)==null?void 0:n.id,O=(I=M.getComponentConfingByType((c=a.schema)==null?void 0:c.type))!=null?I:null;if(!V||!(R!=null&&R[V]))return null;if(O!=null&&O.defaultSchema.input&&((u=a.schema)==null?void 0:u.noFormItem)!==!0)return(k=R[V+"formItem"])==null?void 0:k.$el;const j=R[V];return((t=j==null?void 0:j.$el)==null?void 0:t.nodeName)==="#text"?null:j==null?void 0:j.$el});A(()=>o.value,n=>{n==null||n.addEventListener("click",v,!1),n==null||n.addEventListener("mouseover",S,!1),n==null||n.addEventListener("mouseout",_,!1)}),Se(()=>{var n,c,u;(n=o.value)==null||n.removeEventListener("click",v,!1),(c=o.value)==null||c.removeEventListener("mouseover",S,!1),(u=o.value)==null||u.removeEventListener("mouseout",_,!1)});function v(n){n.stopPropagation(),h.setCheckedNode(a.schema)}function S(n){a.schema.type!=="page"&&(n.stopPropagation(),h.setHoverNode(a.schema))}function _(n){n.stopPropagation(),h.setHoverNode(null)}return(n,c)=>{var u;const k=_e("ENodeItem");return $(),ee(r(Ve),{ref_key:"nodeRef",ref:d,componentSchema:a.schema},Re({_:2},[(u=a.schema)!=null&&u.childImmovable?{name:"edit-node",fn:le(()=>[($(!0),F(Y,null,de(a.schema.children,t=>($(),ee(k,{key:t.id,schema:t},null,8,["schema"]))),128))]),key:"0"}:{name:"edit-node",fn:le(()=>[a.schema.children?($(),ee(Ue,{key:0,schemas:a.schema.children,"onUpdate:schemas":c[0]||(c[0]=t=>a.schema.children=t)},null,8,["schemas"])):be("",!0)]),key:"1"}]),1032,["componentSchema"])}}}),ze={class:"min-w-750px rounded bg-white h-full"},Ze=P({__name:"previewJson",setup(H,{expose:C}){const h=M.getComponent("modal"),m=M.getComponent("monacoEditor"),d={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1},readOnly:!0},a=b(null),o=b(!1),v=D("pageSchema");function S(){o.value=!1}function _(){o.value=!0,a.value?a.value.setValue(JSON.stringify(v,null,2)):setTimeout(()=>{_()},300)}function n(c="epic-data.json"){let u="data:text/json;charset=utf-8,";u+=JSON.stringify(v,null,2);var k=encodeURI(u),t=document.createElement("a");t.setAttribute("href",k),t.setAttribute("download",c),t.click()}return C({handleOpen:_}),(c,u)=>($(),ee(r(h),{modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=k=>o.value=k),title:"\u67E5\u770B\u6570\u636E",class:"w-900px",width:"900px",onClose:S,onOk:n,okText:"\u5BFC\u51FA\u6570\u636E"},{default:le(()=>[y("div",ze,[B(r(m),{ref_key:"monacoEditorRef",ref:a,class:"editor h-full",config:d,language:"json"},null,512)])]),_:1},8,["modelValue"]))}}),Ae={class:"edit-toolbar flex items-center justify-between px-4 mx-1"},Pe={class:"flex-1 h-full flex items-center"},We=["title","onClick"],Ke={class:"flex-1 h-full flex items-center justify-center"},Ge=["title","onClick"],Qe={class:"flex-1 h-full flex items-center justify-end"},Xe={key:0,class:"flex items-center ml-12px"},qe={class:"pr-8px w-82px cursor-pointer"},Ye={class:"w-90px cursor-pointer"},el=P({__name:"toolbar",setup(H){const C=M.getComponent("slider"),h=M.getComponent("select"),{canvasScale:m,disabledZoom:d}=me(),a=b("pc"),o=D("pageSchema"),v=D("designer"),S=b(null),_=[{icon:"icon-a-diannaotoubu",title:"pc",key:"pc"},{icon:"icon-a-pingbantoubu",title:"\u5E73\u677F",key:"pad"},{icon:"icon-a-shoujitoubu",title:"\u624B\u673A",key:"mobile"}],n=J.recordList,c=J.undoList,u=U(()=>[{icon:"icon-daima1",title:"\u67E5\u770B\u6570\u636E",on:()=>I()},{icon:"icon-shangchuan1",title:"\u5BFC\u5165\u6570\u636E",on:Q},{icon:"icon-shanchu1",title:"\u6E05\u7A7A",on:j},{icon:"icon-chexiao2x",title:"\u64A4\u9500",on:V,disabled:!n.value.length},{icon:"icon-fanhui2x",title:"\u91CD\u505A",on:O,disabled:!c.value.length}]),k=b(null),t=U({get(){return`${(m.value*100).toFixed(0)}%`},set(e){m.value=Number(e)}}),R=[{label:"60%",value:"0.6"},{label:"80%",value:"0.8"},{label:"100%",value:"1.0"},{label:"120%",value:"1.2"},{label:"140%",value:"1.4"}];function V(){const e=J.undo();e&&(ue(o.schemas,e),v.setCheckedNode(o.schemas[0]))}function O(){const e=J.redo();e&&(ue(o.schemas,e),v.setCheckedNode(o.schemas[0]))}function j(){v.reset()}function I(){S.value.handleOpen()}function Q(){var e;(e=k.value)==null||e.click()}function W(e){var l;const i=(l=e.target.files)==null?void 0:l[0];if(!i)return;e.target.value=null;const Z=new FileReader;Z.readAsText(i),Z.onload=se=>{var te;z((te=se.target)==null?void 0:te.result)}}function z(e){try{let l=JSON.parse(e!=null?e:"");l.schemas||(l=Fe(l)),ue(o,l)}catch(l){console.error(l)}}function K(e){a.value=e;const l={pc:{},pad:{width:"800px"},mobile:{width:"420px"}};o.canvas=l[e]}return(e,l)=>($(),F(Y,null,[y("div",Ae,[y("div",Pe,[($(!0),F(Y,null,de(u.value,(i,Z)=>($(),F("div",{title:i.title,class:G(["action-item h-90% px-10px flex items-center hover:bg-gray-50 cursor-pointer",{disabled:i.disabled}]),key:Z,onClick:i.on},[B(r(ie),{name:i.icon},null,8,["name"])],10,We))),128))]),re(y("input",{type:"file",ref_key:"fileRef",ref:k,accept:".json,.txt",onChange:W},null,544),[[ce,!1]]),y("div",Ke,[($(),F(Y,null,de(_,i=>y("div",{title:i.title,class:G(["device-item h-90% px-10px flex items-center hover:bg-gray-50 cursor-pointer",{checked:i.key===a.value}]),key:i.key,onClick:Z=>K(i.key)},[B(r(ie),{name:i.icon},null,8,["name"])],10,Ge)),64))]),y("div",Qe,[r(d)?be("",!0):($(),F("div",Xe,[y("div",qe,[B(r(h),{value:t.value,"onUpdate:value":l[0]||(l[0]=i=>t.value=i),modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=i=>t.value=i),options:R,size:"small"},null,8,["value","modelValue"])]),y("div",Ye,[B(r(C),{min:.6,max:1.4,step:.01,tooltip:!1,value:r(m),"onUpdate:value":l[2]||(l[2]=i=>ge(m)?m.value=i:null),modelValue:r(m),"onUpdate:modelValue":l[3]||(l[3]=i=>ge(m)?m.value=i:null)},null,8,["value","modelValue"])])]))])]),B(Ze,{ref_key:"previewJson",ref:S},null,512)],64))}}),ll={class:"h-full flex flex-col relative"},tl=["draggable"],nl=P({__name:"editScreenContainer",setup(H){const C=D("pageSchema"),h=b(null),m=b(null),d=b(null),{pressSpace:a,disabledZoom:o}=me(),{handleElementDragStart:v,handleElementDrag:S,handleElementDragEnd:_}=Te(h),{width:n,height:c}=Be(h),{canvasScale:u,handleZoom:k}=je(m);let t=0,R=0;const V=b({}),O=b({}),j=b({}),I=Ie({width:0,height:0});A(()=>{var e,l;return{width:(e=C.canvas)==null?void 0:e.width,height:(l=C.canvas)==null?void 0:l.height}},W),A(j,()=>{fe(Q)}),ye(()=>{var e,l;W({width:(e=C.canvas)==null?void 0:e.width,height:(l=C.canvas)==null?void 0:l.height})});function Q(){const e=r(d);e&&(I.value={width:e.clientWidth,height:e.clientHeight})}function W({width:e,height:l}){j.value={width:e!=null?e:"0",height:l!=null?l:"0"}}De(n,z),A(I,z);function z(){if(o.value){O.value={width:t+"px",height:R+"px",transform:"translate(0px, 20px)"};return}let e=I.value.width||t,l=I.value.height||R;V.value={width:n.value+e+"px",height:c.value+l+"px"},O.value={width:e+"px",height:l+"px"},K()}function K(){fe(()=>{let e=I.value.width||t;const l=(I.value.height||R)/2,i=e/2;h.value.scrollTo(i,l)})}return ve(h,([{contentRect:e}])=>{if(t=e.width-60,R=e.height-80,!o.value)if(I.value.width===0)u.value=1;else{const l=(t-20)/I.value.width;u.value=l<1.2?l:u.value}z()}),(e,l)=>($(),F("div",ll,[B(el),y("div",{ref_key:"editScreenContainerRef",ref:h,class:G(["flex-1 overflow-auto overflow-y-hidden epic-edit-screen-container",{"cursor-grab":r(a)}]),draggable:r(a),onWheel:l[0]||(l[0]=(...i)=>r(k)&&r(k)(...i)),onDragstart:l[1]||(l[1]=(...i)=>r(v)&&r(v)(...i)),onDragend:l[2]||(l[2]=(...i)=>r(_)&&r(_)(...i)),onDrag:l[3]||(l[3]=(...i)=>r(S)&&r(S)(...i))},[y("div",{id:"canvasContainer",class:"flex items-center justify-center",style:oe(V.value)},[y("div",{ref_key:"draggableElRef",ref:m,class:"transition-all"},[y("div",{class:G({"pointer-events-none":r(a)}),style:oe(O.value)},[Ee(e.$slots,"default")],6)],512)],4)],42,tl),y("div",{ref_key:"sizeBoxRef",ref:d,class:"absolute op-0 pointer-events-none",style:oe(j.value)},null,4)]))}}),al={class:"epic-edit-canvas"},rl=P({__name:"index",setup(H){const C=b(null),h=b(null),m=D("pageSchema"),d=U(()=>m.schemas[0]),a=U(()=>({width:"100%",height:"100%"}));return ye(()=>{var o;(o=h.value)==null||o.handleInit(C.value)}),(o,v)=>($(),F("section",al,[B(nl,null,{default:le(()=>[y("div",{ref_key:"epicEditRangeRef",ref:C,class:"epic-edit-range rounded-md overflow-auto relative",style:oe(a.value)},[B(ke,{schema:d.value},null,8,["schema"]),B(Me,{ref_key:"ePreviewWidgetsRef",ref:h},null,512)],4)]),_:1})]))}});export{rl as default};
