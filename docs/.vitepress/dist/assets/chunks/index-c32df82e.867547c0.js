import{e as Q,k as j,f as W,o as E,c as H,d as U,s as te,b as N,v as se,r as R,w as G,l as xe,E as ie,F as ue,u,t as ye,n as Z,N as le,U as be,p as ke,D as Ce,V as we,x as ee,a4 as Ne,Y as re,G as fe,O as Se,g as $e,m as Ie,a5 as he}from"../app.c22c6c8c.js";import{p as ce,M as P,g as de,x as _e,a as Re,s as Ee,c as Be,i as De,d as Le,r as pe,t as Ve,I as O,n as oe}from"./index.0d7c8eb8.js";import{p as ne}from"./icon.vue_vue_type_script_setup_true_lang-cc078b52.fc49277e.js";import{R as Te}from"./vuedraggable.umd-6a5b6da9.404cbac1.js";import"./commonjsHelpers-c5d32002.490f5bf3.js";const Me={class:"action-item whitespace-nowrap"},Ae=Q({__name:"previewWidgets",setup(J){const i=j("pageManager",{}),k=j("pageSchema"),e=j("designer"),f=R(null),h=R(null),a=R(null),C=R(!1),B=R(!1),$=R(!0),t=R("top"),{canvasScale:d,disabledZoom:y}=ce();let o=null;const w=W(()=>{var F;var l,v,m,_,g;const p=i.componentInstances.value,S=(l=e.state.checkedNode)==null?void 0:l.id,b=(F=P.getComponentConfingByType((v=e.state.checkedNode)==null?void 0:v.type))!=null?F:null;if(!S||!(p!=null&&p[S]))return null;if(b!=null&&b.defaultSchema.input&&((m=e.state.checkedNode)==null?void 0:m.noFormItem)!==!0)return(_=p[S+"formItem"])==null?void 0:_.$el;const L=p[S];return((g=L==null?void 0:L.$el)==null?void 0:g.nodeName)==="#text"?null:L==null?void 0:L.$el}),D=W(()=>{var L;var l,v,m,_;const g=i.componentInstances.value,p=(l=e.state.hoverNode)==null?void 0:l.id,S=(L=P.getComponentConfingByType((v=e.state.hoverNode)==null?void 0:v.type))!=null?L:null;if(!p||!(g!=null&&g[p]))return null;if(S!=null&&S.defaultSchema.input&&((m=e.state.hoverNode)==null?void 0:m.noFormItem)!==!0)return(_=g[p+"formItem"])==null?void 0:_.$el;const b=g[p];return(b==null?void 0:b.$el.nodeName)==="#text"?null:b==null?void 0:b.$el}),{mutationObserver:V,observerConfig:T}=s(n),{startTimedQuery:M,stopTimedQuery:z}=Le(n);G(()=>w.value,l=>{if(l){C.value=!0,V.observe(l,T);const v=l.parentNode;v&&(v.ondragstart=()=>{$.value=!1,M()},v.ondragend=()=>{$.value=!0,z()}),n()}else C.value=!1});const{mutationObserver:x,observerConfig:c}=s(r);G(()=>D.value,l=>{l&&(x.observe(l,c),r())});let I=0;G(()=>{var l;return(l=e.state.hoverNode)==null?void 0:l.id},l=>{if(l){B.value=!0,clearTimeout(I);return}I=setTimeout(()=>{B.value=!1},300)});function n(){var K,X,q;const l=w.value;if(!l)return;const{top:v,left:m}=(K=o==null?void 0:o.getBoundingClientRect())!=null?K:{top:0,left:0},{top:_,left:g,width:p,height:S}=l.getBoundingClientRect(),b=y.value?1:d.value,L=_-v+((X=o==null?void 0:o.scrollTop)!=null?X:0)*b,F=g-m+((q=o==null?void 0:o.scrollLeft)!=null?q:0)*b,Y=S/b;f.value&&(f.value.style.width=`${p/b}px`,f.value.style.height=`${Y}px`,f.value.style.top=`${L/b}px`,f.value.style.left=`${F/b}px`),a.value&&(L<45&&Y<100?(a.value.style.top="",a.value.style.bottom="-30px",a.value.style["border-radius"]="0px 0px 4px 4px",t.value="bottom"):L<45?(a.value.style.top="0px",a.value.style["border-radius"]="0px 0px 4px 0",t.value="center"):(a.value.style.top="-30px",a.value.style["border-radius"]="4px 4px 0px 0px",t.value="top"))}function r(){var X,q,ve,me;var l,v;const m=D.value;if(!m)return;const{top:_,left:g}=(X=o==null?void 0:o.getBoundingClientRect())!=null?X:{top:0,left:0},{top:p,left:S,width:b,height:L}=(q=(l=m.getBoundingClientRect)==null?void 0:l.call(m))!=null?q:(v=m.nextElementSibling)==null?void 0:v.getBoundingClientRect(),F=y.value?1:d.value,Y=p-_+((ve=o==null?void 0:o.scrollTop)!=null?ve:0)*F,K=S-g+((me=o==null?void 0:o.scrollLeft)!=null?me:0)*F;h.value&&(h.value.style.width=`${b/F}px`,h.value.style.height=`${L/F}px`,h.value.style.top=`${Y/F}px`,h.value.style.left=`${K/F}px`)}function s(l){const v=window.MutationObserver,m={childList:!0,attributes:!0,subtree:!0};return{mutationObserver:new v(l),observerConfig:m}}function A(){var S;var l;const v=pe(k.schemas,(S=(l=e.state.checkedNode)==null?void 0:l.id)!=null?S:"root");if(!v)return!1;const{list:m,schema:_,index:g}=v,p=Ve(_);m.splice(g+1,0,p),e.setCheckedNode(p),O.push(k.schemas,"\u590D\u5236\u7EC4\u4EF6")}function ae(){var p;var l;const v=pe(k.schemas,(p=(l=e.state.checkedNode)==null?void 0:l.id)!=null?p:"root");if(!v)return!1;let{list:m,schema:_,index:g}=v;m.splice(g,1),g===m.length&&g--,e.setCheckedNode(m[g]),O.push(k.schemas,"\u5220\u9664\u7EC4\u4EF6")}return xe(()=>{o=document.querySelector(".epic-edit-range"),o==null||o.addEventListener("scroll",()=>{n()}),de(w,n),de(D,n)}),(l,v)=>{var b;var m,_,g,p,S;return E(),H(le,null,[ie(N("div",{ref_key:"selectorRef",ref:f,class:Z(["checked-widget absolute pointer-events-none z-20",t.value+" "+($.value?"transition-all":"")])},[N("div",{class:"action-box",ref_key:"actionBoxRef",ref:a},[N("div",Me,ye((_=u(P).getComponentConfingByType((b=(m=u(e).state.checkedNode)==null?void 0:m.type)!=null?b:""))==null?void 0:_.defaultSchema.label),1),N("div",{title:"\u590D\u5236",class:"action-item pointer-events-auto",onClick:A},[U(u(ne),{name:"icon-fuzhi3"})]),N("div",{title:"\u5220\u9664",class:"action-item pointer-events-auto",onClick:ae},[U(u(ne),{name:"icon-shanchu1"})])],512)],2),[[ue,C.value&&((g=u(e).state.checkedNode)==null?void 0:g.id)!=="root"]]),ie(N("div",{ref_key:"hoverWidgetRef",ref:h,class:"hover-widget absolute transition-all pointer-events-none z-998"},null,512),[[ue,B.value&&((p=u(e).state.checkedNode)==null?void 0:p.id)!==((S=u(e).state.hoverNode)==null?void 0:S.id)]])],64)}}}),Fe=Q({name:"EditNodeItem",__name:"editNodeItem",props:{schemas:{}},emits:["update:schemas"],setup(J,{emit:i}){const k=J,e=j("designer"),f=j("pageSchema"),h=W({get(){return k.schemas},set($){i("update:schemas",$)}});function a($){e.setCheckedNode(h.value[$]),e.setDisableHover(!0)}function C(){e.setDisableHover(),O.push(f.schemas,"\u62D6\u62FD\u7EC4\u4EF6")}function B(){O.push(f.schemas,"\u63D2\u5165\u7EC4\u4EF6")}return($,t)=>(E(),ee(u(Te),Ie({modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=d=>h.value=d),"item-key":"id","component-data":{type:"transition-group"},class:"draggable-range"},{animation:200,group:"edit-draggable",handle:".draggable-item",ghostClass:"moveing"},{onStart:t[1]||(t[1]=d=>a(d.oldIndex)),onEnd:t[2]||(t[2]=d=>C()),onAdd:t[3]||(t[3]=d=>{a(d.newIndex),B()})}),{item:te(({element:d,index:y})=>[(E(),H("div",{class:Z(["widget-box",{"draggable-item":!d.immovable}]),key:y},[U(ge,{schema:d},null,8,["schema"])],2))]),_:1},16,["modelValue"]))}}),ge=Q({name:"ENodeItem",__name:"nodeItem",props:{schema:{},name:{}},setup(J){const i=J,k=be(),e=j("designer"),f=j("pageManager",{}),h=R(null);ke("nodeAttrs",k);const a=W(()=>{var z;var t,d,y,o,w;const D=f.componentInstances.value,V=(t=i.schema)==null?void 0:t.id,T=(z=P.getComponentConfingByType((d=i.schema)==null?void 0:d.type))!=null?z:null;if(!V||!(D!=null&&D[V]))return null;if(T!=null&&T.defaultSchema.input&&((y=i.schema)==null?void 0:y.noFormItem)!==!0)return(o=D[V+"formItem"])==null?void 0:o.$el;const M=D[V];return((w=M==null?void 0:M.$el)==null?void 0:w.nodeName)==="#text"?null:M==null?void 0:M.$el});G(()=>a.value,t=>{t==null||t.addEventListener("click",C,!1),t==null||t.addEventListener("mouseover",B,!1),t==null||t.addEventListener("mouseout",$,!1)}),Ce(()=>{var t,d,y;(t=a.value)==null||t.removeEventListener("click",C,!1),(d=a.value)==null||d.removeEventListener("mouseover",B,!1),(y=a.value)==null||y.removeEventListener("mouseout",$,!1)});function C(t){t.stopPropagation(),e.setCheckedNode(i.schema)}function B(t){i.schema.type!=="page"&&(t.stopPropagation(),e.setHoverNode(i.schema))}function $(t){t.stopPropagation(),e.setHoverNode(null)}return(t,d)=>{var y;const o=we("ENodeItem");return E(),ee(u(_e),{ref_key:"nodeRef",ref:h,record:i.schema},Ne({_:2},[(y=i.schema)!=null&&y.childImmovable?{name:"edit-node",fn:te(()=>[(E(!0),H(le,null,re(i.schema.children,w=>(E(),ee(o,{key:w.id,schema:w},null,8,["schema"]))),128))]),key:"0"}:{name:"edit-node",fn:te(()=>[i.schema.children?(E(),ee(Fe,{key:0,schemas:i.schema.children,"onUpdate:schemas":d[0]||(d[0]=w=>i.schema.children=w)},null,8,["schemas"])):fe("",!0)]),key:"1"}]),1032,["record"])}}}),Ue={class:"edit-toolbar flex items-center justify-between px-4 mx-1"},je={class:"flex-1 h-full flex items-center"},He=["title","onClick"],We={class:"flex-1 h-full flex items-center justify-center"},ze=["title","onClick"],Oe={class:"flex-1 h-full flex items-center justify-end"},Je={key:0,class:"flex items-center ml-12px"},Pe={class:"pr-8px w-82px cursor-pointer"},Ze={class:"w-90px cursor-pointer"},Qe=Q({__name:"toolbar",setup(J){const i=P.getComponent("slider"),k=P.getComponent("select"),{canvasScale:e,disabledZoom:f}=ce(),h=R("pc"),a=j("pageSchema"),C=j("designer"),B=[{icon:"icon-a-diannaotoubu",title:"pc",key:"pc"},{icon:"icon-a-pingbantoubu",title:"\u5E73\u677F",key:"pad"},{icon:"icon-a-shoujitoubu",title:"\u624B\u673A",key:"mobile"}],$=O.recordList,t=O.undoList,d=W(()=>[{icon:"icon-daima1",title:"\u5BFC\u51FA\u6570\u636E",on:()=>M()},{icon:"icon-shangchuan1",title:"\u5BFC\u5165\u6570\u636E",on:z},{icon:"icon-shanchu1",title:"\u6E05\u7A7A",on:T},{icon:"icon-chexiao2x",title:"\u64A4\u9500",on:D,disabled:!$.value.length},{icon:"icon-fanhui2x",title:"\u91CD\u505A",on:V,disabled:!t.value.length}]),y=R(null),o=W({get(){return`${(e.value*100).toFixed(0)}%`},set(n){e.value=Number(n)}}),w=[{label:"60%",value:"0.6"},{label:"80%",value:"0.8"},{label:"100%",value:"1.0"},{label:"120%",value:"1.2"},{label:"140%",value:"1.4"}];function D(){const n=O.undo();n&&(oe(a.schemas,n),C.setCheckedNode(a.schemas[0]))}function V(){const n=O.redo();n&&(oe(a.schemas,n),C.setCheckedNode(a.schemas[0]))}function T(){C.reset()}function M(n="epic-page-data.json"){let r="data:text/json;charset=utf-8,";r+=JSON.stringify(a,null,2);var s=encodeURI(r),A=document.createElement("a");A.setAttribute("href",s),A.setAttribute("download",n),A.click()}function z(){var n;(n=y.value)==null||n.click()}function x(n){var r;const s=(r=n.target.files)==null?void 0:r[0];if(!s)return;n.target.value=null;const A=new FileReader;A.readAsText(s),A.onload=ae=>{var l;c((l=ae.target)==null?void 0:l.result)}}function c(n){try{const r=JSON.parse(n!=null?n:"");oe(a,r)}catch(r){console.error(r)}}function I(n){h.value=n;const r={pc:{},pad:{width:"800px"},mobile:{width:"420px"}};a.canvas=r[n]}return(n,r)=>(E(),H("div",Ue,[N("div",je,[(E(!0),H(le,null,re(d.value,(s,A)=>(E(),H("div",{title:s.title,class:Z(["action-item h-90% px-10px flex items-center hover:bg-gray-50 cursor-pointer",{disabled:s.disabled}]),key:A,onClick:s.on},[U(u(ne),{name:s.icon},null,8,["name"])],10,He))),128))]),ie(N("input",{type:"file",ref_key:"fileRef",ref:y,onChange:x},null,544),[[ue,!1]]),N("div",We,[(E(),H(le,null,re(B,s=>N("div",{title:s.title,class:Z(["device-item h-90% px-10px flex items-center hover:bg-gray-50 cursor-pointer",{checked:s.key===h.value}]),key:s.key,onClick:A=>I(s.key)},[U(u(ne),{name:s.icon},null,8,["name"])],10,ze)),64))]),N("div",Oe,[u(f)?fe("",!0):(E(),H("div",Je,[N("div",Pe,[U(u(k),{value:o.value,"onUpdate:value":r[0]||(r[0]=s=>o.value=s),modelValue:o.value,"onUpdate:modelValue":r[1]||(r[1]=s=>o.value=s),options:w,size:"small"},null,8,["value","modelValue"])]),N("div",Ze,[U(u(i),{min:.6,max:1.4,step:.01,tooltip:!1,value:u(e),"onUpdate:value":r[2]||(r[2]=s=>he(e)?e.value=s:null),modelValue:u(e),"onUpdate:modelValue":r[3]||(r[3]=s=>he(e)?e.value=s:null)},null,8,["value","modelValue"])])]))])]))}}),Xe={class:"h-full flex flex-col relative"},qe=["draggable"],Ge=Q({__name:"editScreenContainer",setup(J){const i=j("pageSchema"),k=R(null),e=R(null),{pressSpace:f,disabledZoom:h}=ce(),{handleElementDragStart:a,handleElementDrag:C,handleElementDragEnd:B}=Re(k),{width:$,height:t}=Ee(k),{canvasScale:d,handleZoom:y}=Be(e);let o=0,w=0;const D=R({}),V=R({}),T=W(()=>{var r,s;var x,c;const I=parseFloat((r=(x=i.canvas)==null?void 0:x.width)!=null?r:"0"),n=parseFloat((s=(c=i.canvas)==null?void 0:c.height)!=null?s:"0");return{width:I,height:n}});De($,M),G(()=>{var x;return(x=i.canvas)==null?void 0:x.width},M);function M(){if(h.value){V.value={width:o+"px",height:w+"px",transform:"translate(0px, 20px)"};return}let x=T.value.width||o,c=T.value.height||w;D.value={width:$.value+x+"px",height:t.value+c+"px"},V.value={width:x+"px",height:c+"px"},z()}function z(){Se(()=>{let x=T.value.width||o;const c=(T.value.height||w)/2,I=x/2;k.value.scrollTo(I,c)})}return de(k,([{contentRect:x}])=>{if(o=x.width-60,w=x.height-80,!h.value){const c=(x.width-20)/T.value.width;c<1.2&&(d.value=c)}M()}),(x,c)=>(E(),H("div",Xe,[U(Qe),N("div",{ref_key:"editScreenContainerRef",ref:k,class:Z(["flex-1 overflow-auto overflow-y-hidden epic-edit-screen-container",{"cursor-grab":u(f)}]),draggable:u(f),onWheel:c[0]||(c[0]=(...I)=>u(y)&&u(y)(...I)),onDragstart:c[1]||(c[1]=(...I)=>u(a)&&u(a)(...I)),onDragend:c[2]||(c[2]=(...I)=>u(B)&&u(B)(...I)),onDrag:c[3]||(c[3]=(...I)=>u(C)&&u(C)(...I))},[N("div",{id:"canvasContainer",class:"flex items-center justify-center",style:se(D.value)},[N("div",{ref_key:"draggableElRef",ref:e,class:"transition-all"},[N("div",{class:Z({"pointer-events-none":u(f)}),style:se(V.value)},[$e(x.$slots,"default")],6)],512)],4)],42,qe)]))}}),Ye={class:"epic-edit-canvas"},at=Q({__name:"index",setup(J){const i=j("pageSchema"),k=W(()=>i.schemas[0]),e=W(()=>{var a,C;var f,h;return{width:(a=(f=i.canvas)==null?void 0:f.width)!=null?a:"100%",height:(C=(h=i.canvas)==null?void 0:h.height)!=null?C:"100%"}});return(f,h)=>(E(),H("section",Ye,[U(Ge,null,{default:te(()=>[N("div",{class:"epic-edit-range rounded-md overflow-auto relative",style:se(e.value)},[U(ge,{schema:k.value},null,8,["schema"]),U(Ae)],4)]),_:1})]))}});export{at as default};
