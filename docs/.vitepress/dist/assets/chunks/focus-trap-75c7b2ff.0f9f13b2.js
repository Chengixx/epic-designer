import{B as g,x as Z,f as ne,m as oe}from"../guide_components_e-designer.md.ee402248.js";import{n as se}from"./isNil-8ef0e4b6.764aa3a4.js";import{B as x,C as I,r as k,h as re,p as ae,w as R,u as y,n as q,m as ue}from"../app.c181f4ec.js";let w;const ke=e=>{var n;if(!g)return 0;if(w!==void 0)return w;const t=document.createElement("div");t.className=`${e}-scrollbar__wrap`,t.style.visibility="hidden",t.style.width="100px",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);const s=t.offsetWidth;t.style.overflow="scroll";const u=document.createElement("div");u.style.width="100%",t.appendChild(u);const d=u.offsetWidth;return(n=t.parentNode)==null||n.removeChild(t),w=s-d,w};function Ce(e,n){if(!g)return;if(!n){e.scrollTop=0;return}const t=[];let s=n.offsetParent;for(;s!==null&&e!==s&&e.contains(s);)t.push(s),s=s.offsetParent;const u=n.offsetTop+t.reduce((v,S)=>v+S.offsetTop,0),d=u+n.offsetHeight,i=e.scrollTop,p=i+e.clientHeight;u<i?e.scrollTop=u:d>p&&(e.scrollTop=d-e.clientHeight)}let m=[];const M=e=>{const n=e;n.key===Z.esc&&m.forEach(t=>t(n))},ce=e=>{x(()=>{m.length===0&&document.addEventListener("keydown",M),g&&m.push(e)}),I(()=>{m=m.filter(n=>n!==e),m.length===0&&g&&document.removeEventListener("keydown",M)})},K="focus-trap.focus-after-trapped",_="focus-trap.focus-after-released",de="focus-trap.focusout-prevented",z={cancelable:!0,bubbles:!1},ie={cancelable:!0,bubbles:!1},G="focusAfterTrapped",J="focusAfterReleased",le=Symbol("elFocusTrap"),B=k(),C=k(0),H=k(0);let T=0;const $=e=>{const n=[],t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const u=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||u?NodeFilter.FILTER_SKIP:s.tabIndex>=0||s===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)n.push(t.currentNode);return n},Q=(e,n)=>{for(const t of e)if(!fe(t,n))return t},fe=(e,n)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(n&&e===n)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},pe=e=>{const n=$(e),t=Q(n,e),s=Q(n.reverse(),e);return[t,s]},me=e=>e instanceof HTMLInputElement&&"select"in e,f=(e,n)=>{if(e&&e.focus){const t=document.activeElement;e.focus({preventScroll:!0}),H.value=window.performance.now(),e!==t&&me(e)&&n&&e.select()}};function V(e,n){const t=[...e],s=e.indexOf(n);return s!==-1&&t.splice(s,1),t}const ve=()=>{let e=[];return{push:n=>{const t=e[0];t&&n!==t&&t.pause(),e=V(e,n),e.unshift(n)},remove:n=>{var t,s;e=V(e,n),(s=(t=e[0])==null?void 0:t.resume)==null||s.call(t)}}},Ee=(e,n=!1)=>{const t=document.activeElement;for(const s of e)if(f(s,n),document.activeElement!==t)return},X=ve(),he=()=>C.value>H.value,L=()=>{B.value="pointer",C.value=window.performance.now()},Y=()=>{B.value="keyboard",C.value=window.performance.now()},ye=()=>(x(()=>{T===0&&(document.addEventListener("mousedown",L),document.addEventListener("touchstart",L),document.addEventListener("keydown",Y)),T++}),I(()=>{T--,T<=0&&(document.removeEventListener("mousedown",L),document.removeEventListener("touchstart",L),document.removeEventListener("keydown",Y))}),{focusReason:B,lastUserFocusTimestamp:C,lastAutomatedFocusTimestamp:H}),b=e=>new CustomEvent(de,{...ie,detail:e}),we=re({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[G,J,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:n}){const t=k();let s,u;const{focusReason:d}=ye();ce(o=>{e.trapped&&!i.paused&&n("release-requested",o)});const i={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},p=o=>{if(!e.loop&&!e.trapped||i.paused)return;const{key:r,altKey:c,ctrlKey:a,metaKey:E,currentTarget:ee,shiftKey:U}=o,{loop:j}=e,te=r===Z.tab&&!c&&!a&&!E,h=document.activeElement;if(te&&h){const N=ee,[F,P]=pe(N);if(F&&P){if(!U&&h===P){const l=b({focusReason:d.value});n("focusout-prevented",l),l.defaultPrevented||(o.preventDefault(),j&&f(F,!0))}else if(U&&[F,N].includes(h)){const l=b({focusReason:d.value});n("focusout-prevented",l),l.defaultPrevented||(o.preventDefault(),j&&f(P,!0))}}else if(h===N){const l=b({focusReason:d.value});n("focusout-prevented",l),l.defaultPrevented||o.preventDefault()}}};ae(le,{focusTrapRef:t,onKeydown:p}),R(()=>e.focusTrapEl,o=>{o&&(t.value=o)},{immediate:!0}),R([t],([o],[r])=>{o&&(o.addEventListener("keydown",p),o.addEventListener("focusin",A),o.addEventListener("focusout",O)),r&&(r.removeEventListener("keydown",p),r.removeEventListener("focusin",A),r.removeEventListener("focusout",O))});const v=o=>{n(G,o)},S=o=>n(J,o),A=o=>{const r=y(t);if(!r)return;const c=o.target,a=o.relatedTarget,E=c&&r.contains(c);e.trapped||a&&r.contains(a)||(s=a),E&&n("focusin",o),!i.paused&&e.trapped&&(E?u=c:f(u,!0))},O=o=>{const r=y(t);if(!(i.paused||!r))if(e.trapped){const c=o.relatedTarget;!se(c)&&!r.contains(c)&&setTimeout(()=>{if(!i.paused&&e.trapped){const a=b({focusReason:d.value});n("focusout-prevented",a),a.defaultPrevented||f(u,!0)}},0)}else{const c=o.target;c&&r.contains(c)||n("focusout",o)}};async function W(){await q();const o=y(t);if(o){X.push(i);const r=o.contains(document.activeElement)?s:document.activeElement;if(s=r,!o.contains(r)){const c=new Event(K,z);o.addEventListener(K,v),o.dispatchEvent(c),c.defaultPrevented||q(()=>{let a=e.focusStartEl;ne(a)||(f(a),document.activeElement!==a&&(a="first")),a==="first"&&Ee($(o),!0),(document.activeElement===r||a==="container")&&f(o)})}}}function D(){const o=y(t);if(o){o.removeEventListener(K,v);const r=new CustomEvent(_,{...z,detail:{focusReason:d.value}});o.addEventListener(_,S),o.dispatchEvent(r),!r.defaultPrevented&&(d.value=="keyboard"||!he()||o.contains(document.activeElement))&&f(s!=null?s:document.body),o.removeEventListener(_,v),X.remove(i)}}return x(()=>{e.trapped&&W(),R(()=>e.trapped,o=>{o?W():D()})}),I(()=>{e.trapped&&D()}),{onKeydown:p}}});function Te(e,n,t,s,u,d){return ue(e.$slots,"default",{handleKeydown:e.onKeydown})}var Se=oe(we,[["render",Te],["__file","/home/runner/work/element-plus/element-plus/packages/components/focus-trap/src/focus-trap.vue"]]);export{Ce as C,ke as S,ce as a,Se as g,le as l};
