import{g as K,l as j,h as P,o as E,c as H,e as U,s as te,d as N,v as se,r as R,w as G,b as xe,E as ie,F as ue,u as r,P as ye,n as Z,N as le,U as be,p as ke,D as Ce,V as we,x as ee,a4 as Ne,Y as re,G as fe,O as Se,i as $e,m as _e,a5 as he}from"../app.db33cb3d.js";import{d as de,M as J,P as ce,E as Ie,a as Re,c as Ee,u as Be,p as Le,f as De,i as pe,l as Ve,V as z,e as oe,g as Te}from"./index.4abc0d1b.js";import{m as ne}from"./icon.vue_vue_type_script_setup_true_lang-eb196e28.b7e231b8.js";import{R as Me}from"./vuedraggable.umd-6a5b6da9.1ae79871.js";import"./commonjsHelpers-c5d32002.490f5bf3.js";const Ae={class:"action-item whitespace-nowrap"},Fe=K({__name:"previewWidgets",setup(O){const u=j("pageManager",{}),k=j("pageSchema"),e=j("designer"),f=R(null),h=R(null),a=R(null),C=R(!1),B=R(!1),$=R(!0),t=R("top"),{canvasScale:c,disabledZoom:y}=de();let o=null;const w=P(()=>{var F;var l,v,m,I,g;const p=u.componentInstances.value,S=(l=e.state.checkedNode)==null?void 0:l.id,b=(F=J.getComponentConfingByType((v=e.state.checkedNode)==null?void 0:v.type))!=null?F:null;if(!S||!(p!=null&&p[S]))return null;if(b!=null&&b.defaultSchema.input&&((m=e.state.checkedNode)==null?void 0:m.noFormItem)!==!0)return(I=p[S+"formItem"])==null?void 0:I.$el;const D=p[S];return((g=D==null?void 0:D.$el)==null?void 0:g.nodeName)==="#text"?null:D==null?void 0:D.$el}),L=P(()=>{var D;var l,v,m,I;const g=u.componentInstances.value,p=(l=e.state.hoverNode)==null?void 0:l.id,S=(D=J.getComponentConfingByType((v=e.state.hoverNode)==null?void 0:v.type))!=null?D:null;if(!p||!(g!=null&&g[p]))return null;if(S!=null&&S.defaultSchema.input&&((m=e.state.hoverNode)==null?void 0:m.noFormItem)!==!0)return(I=g[p+"formItem"])==null?void 0:I.$el;const b=g[p];return(b==null?void 0:b.$el.nodeName)==="#text"?null:b==null?void 0:b.$el}),{mutationObserver:V,observerConfig:T}=i(n),{startTimedQuery:M,stopTimedQuery:W}=De(n);G(()=>w.value,l=>{if(l){C.value=!0,V.observe(l,T);const v=l.parentNode;v&&(v.ondragstart=()=>{$.value=!1,M()},v.ondragend=()=>{$.value=!0,W()}),n()}else C.value=!1});const{mutationObserver:x,observerConfig:d}=i(s);G(()=>L.value,l=>{l&&(x.observe(l,d),s())});let _=0;G(()=>{var l;return(l=e.state.hoverNode)==null?void 0:l.id},l=>{if(l){B.value=!0,clearTimeout(_);return}_=setTimeout(()=>{B.value=!1},300)});function n(){var Y,Q,q;const l=w.value;if(!l)return;const{top:v,left:m}=(Y=o==null?void 0:o.getBoundingClientRect())!=null?Y:{top:0,left:0},{top:I,left:g,width:p,height:S}=l.getBoundingClientRect(),b=y.value?1:c.value,D=I-v+((Q=o==null?void 0:o.scrollTop)!=null?Q:0)*b,F=g-m+((q=o==null?void 0:o.scrollLeft)!=null?q:0)*b,X=S/b;f.value&&(f.value.style.width=`${p/b}px`,f.value.style.height=`${X}px`,f.value.style.top=`${D/b}px`,f.value.style.left=`${F/b}px`),a.value&&(D<45&&X<100?(a.value.style.top="",a.value.style.bottom="-30px",a.value.style["border-radius"]="0px 0px 4px 4px",t.value="bottom"):D<45?(a.value.style.top="0px",a.value.style["border-radius"]="0px 0px 4px 0",t.value="center"):(a.value.style.top="-30px",a.value.style["border-radius"]="4px 4px 0px 0px",t.value="top"))}function s(){var Q,q,ve,me;var l,v;const m=L.value;if(!m)return;const{top:I,left:g}=(Q=o==null?void 0:o.getBoundingClientRect())!=null?Q:{top:0,left:0},{top:p,left:S,width:b,height:D}=(q=(l=m.getBoundingClientRect)==null?void 0:l.call(m))!=null?q:(v=m.nextElementSibling)==null?void 0:v.getBoundingClientRect(),F=y.value?1:c.value,X=p-I+((ve=o==null?void 0:o.scrollTop)!=null?ve:0)*F,Y=S-g+((me=o==null?void 0:o.scrollLeft)!=null?me:0)*F;h.value&&(h.value.style.width=`${b/F}px`,h.value.style.height=`${D/F}px`,h.value.style.top=`${X/F}px`,h.value.style.left=`${Y/F}px`)}function i(l){const v=window.MutationObserver,m={childList:!0,attributes:!0,subtree:!0};return{mutationObserver:new v(l),observerConfig:m}}function A(){var S;var l;const v=pe(k.schemas,(S=(l=e.state.checkedNode)==null?void 0:l.id)!=null?S:"root");if(!v)return!1;const{list:m,schema:I,index:g}=v,p=Ve(I);m.splice(g+1,0,p),e.setCheckedNode(p),z.push(k.schemas,"\u590D\u5236\u7EC4\u4EF6")}function ae(){var p;var l;const v=pe(k.schemas,(p=(l=e.state.checkedNode)==null?void 0:l.id)!=null?p:"root");if(!v)return!1;let{list:m,schema:I,index:g}=v;m.splice(g,1),g===m.length&&g--,e.setCheckedNode(m[g]),z.push(k.schemas,"\u5220\u9664\u7EC4\u4EF6")}return xe(()=>{o=document.querySelector(".epic-edit-range"),o==null||o.addEventListener("scroll",()=>{n()}),ce(w,n),ce(L,n)}),(l,v)=>{var b;var m,I,g,p,S;return E(),H(le,null,[ie(N("div",{ref_key:"selectorRef",ref:f,class:Z(["checked-widget absolute pointer-events-none z-20",t.value+" "+($.value?"transition-all":"")])},[N("div",{class:"action-box",ref_key:"actionBoxRef",ref:a},[N("div",Ae,ye((I=r(J).getComponentConfingByType((b=(m=r(e).state.checkedNode)==null?void 0:m.type)!=null?b:""))==null?void 0:I.defaultSchema.label),1),N("div",{title:"\u590D\u5236",class:"action-item pointer-events-auto",onClick:A},[U(r(ne),{name:"icon-fuzhi3"})]),N("div",{title:"\u5220\u9664",class:"action-item pointer-events-auto",onClick:ae},[U(r(ne),{name:"icon-shanchu1"})])],512)],2),[[ue,C.value&&((g=r(e).state.checkedNode)==null?void 0:g.id)!=="root"]]),ie(N("div",{ref_key:"hoverWidgetRef",ref:h,class:"hover-widget absolute transition-all pointer-events-none z-998"},null,512),[[ue,B.value&&((p=r(e).state.checkedNode)==null?void 0:p.id)!==((S=r(e).state.hoverNode)==null?void 0:S.id)]])],64)}}}),Ue=K({name:"EditNodeItem",__name:"editNodeItem",props:{schemas:{}},emits:["update:schemas"],setup(O,{emit:u}){const k=O,e=j("designer"),f=j("pageSchema"),h=P({get(){return k.schemas},set($){u("update:schemas",$)}});function a($){e.setCheckedNode(h.value[$]),e.setDisableHover(!0)}function C(){e.setDisableHover(),z.push(f.schemas,"\u62D6\u62FD\u7EC4\u4EF6")}function B(){z.push(f.schemas,"\u63D2\u5165\u7EC4\u4EF6")}return($,t)=>(E(),ee(r(Me),_e({modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=c=>h.value=c),"item-key":"id","component-data":{type:"transition-group"},class:"draggable-range"},{animation:200,group:"edit-draggable",handle:".draggable-item",ghostClass:"moveing"},{onStart:t[1]||(t[1]=c=>a(c.oldIndex)),onEnd:t[2]||(t[2]=c=>C()),onAdd:t[3]||(t[3]=c=>{a(c.newIndex),B()})}),{item:te(({element:c,index:y})=>[(E(),H("div",{class:Z(["widget-box",{"draggable-item":!c.immovable}]),key:y},[U(ge,{schema:c},null,8,["schema"])],2))]),_:1},16,["modelValue"]))}}),ge=K({name:"ENodeItem",__name:"nodeItem",props:{schema:{},name:{}},setup(O){const u=O,k=be(),e=j("designer"),f=j("pageManager",{}),h=R(null);ke("nodeAttrs",k);const a=P(()=>{var W;var t,c,y,o,w;const L=f.componentInstances.value,V=(t=u.schema)==null?void 0:t.id,T=(W=J.getComponentConfingByType((c=u.schema)==null?void 0:c.type))!=null?W:null;if(!V||!(L!=null&&L[V]))return null;if(T!=null&&T.defaultSchema.input&&((y=u.schema)==null?void 0:y.noFormItem)!==!0)return(o=L[V+"formItem"])==null?void 0:o.$el;const M=L[V];return((w=M==null?void 0:M.$el)==null?void 0:w.nodeName)==="#text"?null:M==null?void 0:M.$el});G(()=>a.value,t=>{t==null||t.addEventListener("click",C,!1),t==null||t.addEventListener("mouseover",B,!1),t==null||t.addEventListener("mouseout",$,!1)}),Ce(()=>{var t,c,y;(t=a.value)==null||t.removeEventListener("click",C,!1),(c=a.value)==null||c.removeEventListener("mouseover",B,!1),(y=a.value)==null||y.removeEventListener("mouseout",$,!1)});function C(t){t.stopPropagation(),e.setCheckedNode(u.schema)}function B(t){u.schema.type!=="page"&&(t.stopPropagation(),e.setHoverNode(u.schema))}function $(t){t.stopPropagation(),e.setHoverNode(null)}return(t,c)=>{var y;const o=we("ENodeItem");return E(),ee(r(Ie),{ref_key:"nodeRef",ref:h,record:u.schema},Ne({_:2},[(y=u.schema)!=null&&y.childImmovable?{name:"edit-node",fn:te(()=>[(E(!0),H(le,null,re(u.schema.children,w=>(E(),ee(o,{key:w.id,schema:w},null,8,["schema"]))),128))]),key:"0"}:{name:"edit-node",fn:te(()=>[u.schema.children?(E(),ee(Ue,{key:0,schemas:u.schema.children,"onUpdate:schemas":c[0]||(c[0]=w=>u.schema.children=w)},null,8,["schemas"])):fe("",!0)]),key:"1"}]),1032,["record"])}}}),je={class:"edit-toolbar flex items-center justify-between px-4 mx-1"},He={class:"flex-1 h-full flex items-center"},Pe=["title","onClick"],We={class:"flex-1 h-full flex items-center justify-center"},ze=["title","onClick"],Oe={class:"flex-1 h-full flex items-center justify-end"},Je={key:0,class:"flex items-center ml-12px"},Ze={class:"pr-8px w-82px cursor-pointer"},Ke={class:"w-90px cursor-pointer"},Qe=K({__name:"toolbar",setup(O){const u=J.getComponent("slider"),k=J.getComponent("select"),{canvasScale:e,disabledZoom:f}=de(),h=R("pc"),a=j("pageSchema"),C=j("designer"),B=[{icon:"icon-a-diannaotoubu",title:"pc",key:"pc"},{icon:"icon-a-pingbantoubu",title:"\u5E73\u677F",key:"pad"},{icon:"icon-a-shoujitoubu",title:"\u624B\u673A",key:"mobile"}],$=z.recordList,t=z.undoList,c=P(()=>[{icon:"icon-daima1",title:"\u5BFC\u51FA\u6570\u636E",on:()=>M()},{icon:"icon-shangchuan1",title:"\u5BFC\u5165\u6570\u636E",on:W},{icon:"icon-shanchu1",title:"\u6E05\u7A7A",on:T},{icon:"icon-chexiao2x",title:"\u64A4\u9500",on:L,disabled:!$.value.length},{icon:"icon-fanhui2x",title:"\u91CD\u505A",on:V,disabled:!t.value.length}]),y=R(null),o=P({get(){return`${(e.value*100).toFixed(0)}%`},set(n){e.value=Number(n)}}),w=[{label:"60%",value:"0.6"},{label:"80%",value:"0.8"},{label:"100%",value:"1.0"},{label:"120%",value:"1.2"},{label:"140%",value:"1.4"}];function L(){const n=z.undo();n&&(oe(a.schemas,n),C.setCheckedNode(a.schemas[0]))}function V(){const n=z.redo();n&&(oe(a.schemas,n),C.setCheckedNode(a.schemas[0]))}function T(){C.reset()}function M(n="epic-data.json"){let s="data:text/json;charset=utf-8,";s+=JSON.stringify(a,null,2);var i=encodeURI(s),A=document.createElement("a");A.setAttribute("href",i),A.setAttribute("download",n),A.click()}function W(){var n;(n=y.value)==null||n.click()}function x(n){var s;const i=(s=n.target.files)==null?void 0:s[0];if(!i)return;n.target.value=null;const A=new FileReader;A.readAsText(i),A.onload=ae=>{var l;d((l=ae.target)==null?void 0:l.result)}}function d(n){try{let s=JSON.parse(n!=null?n:"");s.schemas||(s=Te(s)),oe(a,s)}catch(s){console.error(s)}}function _(n){h.value=n;const s={pc:{},pad:{width:"800px"},mobile:{width:"420px"}};a.canvas=s[n]}return(n,s)=>(E(),H("div",je,[N("div",He,[(E(!0),H(le,null,re(c.value,(i,A)=>(E(),H("div",{title:i.title,class:Z(["action-item h-90% px-10px flex items-center hover:bg-gray-50 cursor-pointer",{disabled:i.disabled}]),key:A,onClick:i.on},[U(r(ne),{name:i.icon},null,8,["name"])],10,Pe))),128))]),ie(N("input",{type:"file",ref_key:"fileRef",ref:y,onChange:x},null,544),[[ue,!1]]),N("div",We,[(E(),H(le,null,re(B,i=>N("div",{title:i.title,class:Z(["device-item h-90% px-10px flex items-center hover:bg-gray-50 cursor-pointer",{checked:i.key===h.value}]),key:i.key,onClick:A=>_(i.key)},[U(r(ne),{name:i.icon},null,8,["name"])],10,ze)),64))]),N("div",Oe,[r(f)?fe("",!0):(E(),H("div",Je,[N("div",Ze,[U(r(k),{value:o.value,"onUpdate:value":s[0]||(s[0]=i=>o.value=i),modelValue:o.value,"onUpdate:modelValue":s[1]||(s[1]=i=>o.value=i),options:w,size:"small"},null,8,["value","modelValue"])]),N("div",Ke,[U(r(u),{min:.6,max:1.4,step:.01,tooltip:!1,value:r(e),"onUpdate:value":s[2]||(s[2]=i=>he(e)?e.value=i:null),modelValue:r(e),"onUpdate:modelValue":s[3]||(s[3]=i=>he(e)?e.value=i:null)},null,8,["value","modelValue"])])]))])]))}}),qe={class:"h-full flex flex-col relative"},Ge=["draggable"],Xe=K({__name:"editScreenContainer",setup(O){const u=j("pageSchema"),k=R(null),e=R(null),{pressSpace:f,disabledZoom:h}=de(),{handleElementDragStart:a,handleElementDrag:C,handleElementDragEnd:B}=Re(k),{width:$,height:t}=Ee(k),{canvasScale:c,handleZoom:y}=Be(e);let o=0,w=0;const L=R({}),V=R({}),T=P(()=>{var s,i;var x,d;const _=parseFloat((s=(x=u.canvas)==null?void 0:x.width)!=null?s:"0"),n=parseFloat((i=(d=u.canvas)==null?void 0:d.height)!=null?i:"0");return{width:_,height:n}});Le($,M),G(()=>{var x;return(x=u.canvas)==null?void 0:x.width},M);function M(){if(h.value){V.value={width:o+"px",height:w+"px",transform:"translate(0px, 20px)"};return}let x=T.value.width||o,d=T.value.height||w;L.value={width:$.value+x+"px",height:t.value+d+"px"},V.value={width:x+"px",height:d+"px"},W()}function W(){Se(()=>{let x=T.value.width||o;const d=(T.value.height||w)/2,_=x/2;k.value.scrollTo(_,d)})}return ce(k,([{contentRect:x}])=>{if(o=x.width-60,w=x.height-80,!h.value){const d=(x.width-20)/T.value.width;d<1.2&&(c.value=d)}M()}),(x,d)=>(E(),H("div",qe,[U(Qe),N("div",{ref_key:"editScreenContainerRef",ref:k,class:Z(["flex-1 overflow-auto overflow-y-hidden epic-edit-screen-container",{"cursor-grab":r(f)}]),draggable:r(f),onWheel:d[0]||(d[0]=(..._)=>r(y)&&r(y)(..._)),onDragstart:d[1]||(d[1]=(..._)=>r(a)&&r(a)(..._)),onDragend:d[2]||(d[2]=(..._)=>r(B)&&r(B)(..._)),onDrag:d[3]||(d[3]=(..._)=>r(C)&&r(C)(..._))},[N("div",{id:"canvasContainer",class:"flex items-center justify-center",style:se(L.value)},[N("div",{ref_key:"draggableElRef",ref:e,class:"transition-all"},[N("div",{class:Z({"pointer-events-none":r(f)}),style:se(V.value)},[$e(x.$slots,"default")],6)],512)],4)],42,Ge)]))}}),Ye={class:"epic-edit-canvas"},ot=K({__name:"index",setup(O){const u=j("pageSchema"),k=P(()=>u.schemas[0]),e=P(()=>{var a,C;var f,h;return{width:(a=(f=u.canvas)==null?void 0:f.width)!=null?a:"100%",height:(C=(h=u.canvas)==null?void 0:h.height)!=null?C:"100%"}});return(f,h)=>(E(),H("section",Ye,[U(Xe,null,{default:te(()=>[N("div",{class:"epic-edit-range rounded-md overflow-auto relative",style:se(e.value)},[U(ge,{schema:k.value},null,8,["schema"]),U(Fe)],4)]),_:1})]))}});export{ot as default};
