import{bC as R,bw as A,bD as T}from"../guide_components_e-designer.md.ee402248.js";import{d as z}from"./vuedraggable.umd.dd4475b1.js";import{h as S,A as M,o as r,c as f,a1 as j,a as n,V as N,l as F,k as D,M as q,b as L,u as E,U as O,r as x,s as w,i as G,j as U,y as B,K as H,L as J,n as P,t as K,w as Q}from"../app.c181f4ec.js";import{_ as W}from"./tree.vue_vue_type_script_setup_true_lang.83b00509.js";const X={class:"event-info"},Y=["title"],Z={class:"event-btn"},ee=["onClick"],te={class:"epic-action-editor-main"},ne={class:"epic-editor-item"},oe=n("div",{class:"w-36px text-lg"},[n("span",{class:"iconfont icon-bianji2 mr-2 text-lg cursor-move handle"})],-1),le={class:"flex-1"},ae={key:0},se={key:1},ue={key:2},ie={class:"opr-box"},ce=["onClick"],de=n("span",{class:"iconfont icon-edit"},null,-1),pe=[de],re=["onClick"],ve=n("span",{class:"iconfont icon-shanchu"},null,-1),me=[ve],fe=S({__name:"EActionEditorItem",props:{itemEvents:{type:Array,default:()=>[]},allEvents:{type:Array,default:()=>[]},events:{type:Object,default:()=>({})}},emits:["add","edit"],setup(V,{emit:_}){const v=V,I=defineModel("modelValue"),m=M("pageSchema");function b(o){_("add",o)}function d(o){const{schema:e}=R(m.schemas,o);return e.label}function c(o,e){var p;const a=y(e);a[e]=v.events[e].filter((k,g)=>o!==g),(p=a[e])!=null&&p.length||delete a[e],I.value=a}function h(o,e,a){_("edit",o,e,a)}function y(o){const e={};return v.allEvents.forEach(a=>{if(!v.events[a.type].length||a.type===o)return!1;e[a.type]=v.events[a.type]}),e}return(o,e)=>(r(!0),f(O,null,j(V.itemEvents,a=>(r(),f("div",{key:a.type,class:"event-item"},[n("div",X,[n("div",{class:"event-label",title:a.describe},N(a.describe),9,Y),n("div",Z,[n("span",{class:"iconfont icon-tianjia1",onClick:p=>b(a.type)},null,8,ee)])]),n("div",te,[F(E(z),{modelValue:v.events[a.type],"onUpdate:modelValue":p=>v.events[a.type]=p,"item-key":"id","component-data":{type:"transition-group"},group:"option-list",handle:".handle",animation:200},{item:D(({element:p,index:k})=>[n("div",ne,[oe,n("div",le,[p.type==="component"?(r(),f("div",ae,N(d(p.componentId)),1)):p.type==="public"?(r(),f("div",se," \u516C\u5171\u51FD\u6570 ")):p.type==="custom"?(r(),f("div",ue," \u81EA\u5B9A\u4E49\u51FD\u6570 ")):q("",!0),L(" "+N(p.methodName),1)]),n("div",ie,[n("div",{class:"edit-btn",onClick:g=>h(k,a.type,p)},pe,8,ce),n("div",{class:"del-btn",onClick:g=>c(k,a.type)},me,8,re)])])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]))),128))}}),he={class:"h-full flex flex-col"},_e=n("div",{class:"pb-2"}," \u81EA\u5B9A\u4E49\u51FD\u6570\u7F16\u8F91 ",-1),ye=S({__name:"EScriptEdit",setup(V){const _=A.getComponent("monacoEditor"),v={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1}},I=x(null),m=M("pageSchema");return(b,d)=>(r(),f("div",he,[_e,F(E(_),{ref_key:"monacoEditorRef",ref:I,modelValue:E(m).script,"onUpdate:modelValue":d[0]||(d[0]=c=>E(m).script=c),class:"editor flex",config:v,language:"javascript"},null,8,["modelValue"])]))}}),Ee={class:"rounded bg-white epic-modal-action-main"},ge={class:"epic-modal-left-panel h-full flex flex-col"},Ce={class:"flex-1"},xe={class:"h-360px overflow-auto"},Ie={class:"epic-action-select h-240px flex flex-col"},be=n("div",{class:"mb-2"},"\u52A8\u4F5C\u9009\u62E9",-1),ke={class:"flex-1 overflow-auto"},Ve=["onClick"],$e={class:"text-center pt-42px text-gray-400"},Ae={class:"epic-modal-right-panel"},Fe={key:1,class:"text-center pt-42px text-gray-400"},Ne=S({__name:"EActionModal",emits:["add","edit"],setup(V,{expose:_,emit:v}){const I=A.getComponent("modal"),m=x(!0),b=M("pageSchema"),d=M("pageManager",{}),c=x(!1),h=x([]),y=x(null),o=w(()=>{var u;return e.actionItem.type==="component"?(u=A.getComponentConfings()[y.value.type].config.action)==null?void 0:u.map(i=>({label:i.describe,value:i.type})):e.actionItem.type==="custom"?Object.entries(d.funcs.value).filter(([i,$])=>typeof $=="function").map(([i])=>({label:i,value:i})):e.actionItem.type==="public"?Object.entries(A.publicMethods).map(([i])=>({label:i,value:i})):[]}),e=G({actionItem:{type:"public",methodName:"test",componentId:null}});function a(){var u;c.value=!0,m.value=!0,e.actionItem.type="public",e.actionItem.componentId=null,(u=o.value)!=null&&u.length&&l(o.value[0].value)}function p(u){c.value=!0,m.value=!1,u.componentId&&(h.value=[u.componentId]),P(()=>{e.actionItem.methodName=u.methodName,e.actionItem.componentId=u.componentId,e.actionItem.type=u.type,y.value=null})}function k(){if(!e.actionItem.methodName){alert("\u8BF7\u5148\u9009\u62E9\u52A8\u4F5C\u65B9\u6CD5");return}v(m.value?"add":"edit",T(K(e.actionItem))),g()}function g(){c.value=!1,h.value=[]}function s(u){var i;e.actionItem.componentId=null,e.actionItem.type=u,y.value=null,e.actionItem.methodName=null,h.value=[],(i=o.value)!=null&&i.length&&l(o.value[0].value)}function t(u){var i;e.actionItem.componentId=u.id,e.actionItem.type="component",e.actionItem.methodName=null,y.value=u.record,(i=o.value)!=null&&i.length&&l(o.value[0].value)}function l(u){e.actionItem.methodName=u}return _({handleOpen:a,handleOpenEdit:p}),(u,i)=>(r(),U(E(I),{modelValue:c.value,"onUpdate:modelValue":i[3]||(i[3]=$=>c.value=$),class:"w-1100px",width:"1100px",onClose:g,onOk:k,title:"\u52A8\u4F5C\u914D\u7F6E"},{default:D(()=>{var $;return[n("div",Ee,[n("div",ge,[n("div",Ce,[n("div",{class:B(["fun-btn",{checked:e.actionItem.type==="public"}]),onClick:i[0]||(i[0]=C=>s("public"))}," \u516C\u5171\u51FD\u6570 ",2),n("div",{class:B(["fun-btn",{checked:e.actionItem.type==="custom"}]),onClick:i[1]||(i[1]=C=>s("custom"))}," \u81EA\u5B9A\u4E49\u51FD\u6570 ",2),L(" \u7EC4\u4EF6 "),n("div",xe,[F(E(W),{selectedKeys:h.value,"onUpdate:selectedKeys":i[2]||(i[2]=C=>h.value=C),options:E(b).schemas,onNodeClick:t},null,8,["selectedKeys","options"])])]),n("div",Ie,[be,n("div",ke,[(r(!0),f(O,null,j(o.value,C=>(r(),f("div",{class:B([{checked:C.value===e.actionItem.methodName},"action-item"]),onClick:we=>l(C.value),key:C.value},[n("span",null,N(C.label),1)],10,Ve))),128)),H(n("div",$e,"\u5F53\u524D\u7EC4\u4EF6\u6682\u65E0\u52A8\u4F5C",512),[[J,!(($=o.value)!=null&&$.length)]])])])]),n("div",Ae,[e.actionItem.type==="custom"?(r(),U(ye,{key:0})):(r(),f("div",Fe,"\u6682\u65E0\u914D\u7F6E"))])])]}),_:1},8,["modelValue"]))}}),Be=S({__name:"index",props:{eventList:{type:Array,default:()=>[]}},setup(V){const _=V,v=A.getComponent("Collapse"),I=A.getComponent("CollapseItem"),m=x(null);let b=0;const d=defineModel("modelValue"),c=x(["\u7EC4\u4EF6\u4E8B\u4EF6"]),h=w(()=>_.eventList.filter(s=>s.events.length));Q(()=>h.value,s=>{s.length&&(c.value=s[0].title)},{immediate:!0});const y=w(()=>_.eventList.map(s=>s.events).flat()),o=x({});y.value.forEach(s=>{o.value[s.type]=w({get(){var t,l;return(l=(t=d.value)==null?void 0:t[s.type])!=null?l:[]},set(t){t&&t.length?d.value[s.type]=t.map(l=>K(l)):delete d.value[s.type]}})});let e="";function a(s){var t;(t=m.value)==null||t.handleOpen(),e=s}function p(s,t,l){var u;(u=m.value)==null||u.handleOpenEdit(l),b=s,e=t}function k(s){var t;o.value[e][b]=s,d.value[e]=[...(t=o.value[e])!=null?t:[]]}function g(s){var t,l;if(!d.value){d.value={[e]:[...(t=o.value[e])!=null?t:[],s]};return}d.value[e]=[...(l=o.value[e])!=null?l:[],s]}return(s,t)=>(r(),f(O,null,[F(E(v),{modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=l=>c.value=l),activeEey:c.value,"onUpdate:activeEey":t[2]||(t[2]=l=>c.value=l),"expanded-names":c.value,"onUpdate:expandedNames":t[3]||(t[3]=l=>c.value=l)},{default:D(()=>[(r(!0),f(O,null,j(h.value,l=>(r(),U(E(I),{key:l.title,title:l.title,header:l.title,name:l.title},{default:D(()=>[F(fe,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=u=>d.value=u),"item-events":l.events,"all-events":y.value,events:o.value,onAdd:a,onEdit:p},null,8,["modelValue","item-events","all-events","events"])]),_:2},1032,["title","header","name"]))),128))]),_:1},8,["modelValue","activeEey","expanded-names"]),F(Ne,{ref_key:"EActionModalRef",ref:m,onAdd:g,onEdit:k},null,512)],64))}});export{Be as default};
