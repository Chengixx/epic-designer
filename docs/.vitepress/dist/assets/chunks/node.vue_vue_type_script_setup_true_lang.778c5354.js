import{h as X,A as g,r as O,N as R,i as G,s as w,w as v,a5 as H,K as b,L as z,o as _,j as k,k as i,W as U,v as N,u as h,l as q,ak as x,al as J,m as K,M as Q,X as Y}from"../app.c181f4ec.js";import{bw as P,bz as Z}from"../guide_components_e-designer.md.ee402248.js";const re=X({name:"ENode",__name:"node",props:{record:{type:Object,required:!0,default:()=>({})},modelValue:{type:[Object,Array,String,Number,Boolean],default:void 0}},emits:["update:modelValue","change"],setup(V,{emit:E}){const e=V,t=g("formData",{}),C=g("slots",{}),l=g("pageManager",{}),L=P.getComponent("form-item"),u=O(),y=O(),c=R(null),m=R({}),S=G({}),I=w(()=>{var o,r,n,a;return(o=e.record.componentProps)!=null&&o.hidden?!1:typeof e.record.show=="boolean"?e.record.show:(a=(n=(r=e.record).show)==null?void 0:n.call(r,{values:t}))!=null?a:!0}),T=w(()=>{var r;const o=I.value&&((r=e.record.rules)==null?void 0:r.map(n=>({...n,validator:n.validator&&l.funcs.value[n.validator]})));return{...e.record,rules:o,rule:o}}),f=w(()=>{var o;return(o=P.getComponentConfingByType(e.record.type))!=null?o:null});e.record.field&&v(()=>e.modelValue,o=>{t[e.record.field]=o},{immediate:!0}),v(()=>u.value,()=>{D()});const M={mounted(){D()},unmounted(){var o;e.record.id&&(l.removeComponentInstance(e.record.id),((o=f.value)==null?void 0:o.defaultSchema.input)&&e.record.noFormItem!==!0&&l.removeComponentInstance(e.record.id+"formItem"))}};function D(){var o;e.record.id&&u.value&&(l.addComponentInstance(e.record.id,u.value),((o=f.value)==null?void 0:o.defaultSchema.input)&&e.record.noFormItem!==!0&&y.value&&l.addComponentInstance(e.record.id+"formItem",y.value))}async function W(){var a,s,$,A,B;if((a=e.record.componentProps)!=null&&a.defaultValue&&F((s=e.record.componentProps)==null?void 0:s.defaultValue),e.record.type==="slot"){const d=e.record.slotName;return d&&v(()=>t[e.record.field],()=>{var p;c.value=Y("div",null,(p=C[d])==null?void 0:p.call(C,{record:e.record,model:t}))},{immediate:!0}),!1}const o=P.getComponent(e.record.type);if(!o)return console.error(`\u7EC4\u4EF6${e.record.type}\u672A\u6CE8\u518C`),!1;const r=(A=($=f.value)==null?void 0:$.bindModel)!=null?A:"modelValue";if(typeof o=="function"){const d=await o();c.value=(B=d.default)!=null?B:d}else c.value=o;const n={};e.record.on&&Object.keys(e.record.on).forEach(d=>{n[`on${Z(d)}`]=(...p)=>l.doActions(e.record.on[d],...p)}),m.value={record:e.record,bindModel:r,[`onUpdate:${r}`]:F,...n}}function F(o){E("update:modelValue",o),E("change",o),e.record.field&&(t[e.record.field]=o)}let j=null;return v(()=>e.record,o=>{const r=JSON.stringify({...o,children:void 0});if(r===j)return!1;j=r,W()},{immediate:!0,deep:!0}),(o,r)=>{var a;const n=H("ENode");return e.record.noFormItem!==!0&&((a=f.value)==null?void 0:a.defaultSchema.input)&&c.value?b((_(),k(h(L),N({key:0,ref_key:"formItemRef",ref:y},T.value),{default:i(()=>[b((_(),k(U(c.value),N({ref_key:"componentInstance",ref:u},{...m.value,...e.record.componentProps,...S,[m.value.bindModel]:h(t)[e.record.field]}),{node:i(s=>[q(n,x(J(s)),null,16)]),"edit-node":i(()=>[K(o.$slots,"edit-node")]),_:3},16)),[[M]])]),_:3},16)),[[z,I.value]]):c.value?b((_(),k(U(c.value),N({key:1,ref_key:"componentInstance",ref:u,model:h(t)},{...m.value,...e.record.componentProps,...S,[m.value.bindModel]:h(t)[e.record.field]||V.modelValue}),{node:i(s=>[q(n,x(J(s)),null,16)]),"edit-node":i(()=>[K(o.$slots,"edit-node")]),_:3},16,["model"])),[[z,I.value],[M]]):Q("",!0)}}});export{re as _};
